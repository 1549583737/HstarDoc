<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>幻☆精灵的Blog</title>
  <meta name="description" content="幻☆精灵的Blog站点" />
  <meta name="keywords" content="幻精灵" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/blog/images/favicon.ico">
  <link rel="alternate" href="/blog/atom.xml" title="幻☆精灵的Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="幻☆精灵的Blog站点">
<meta property="og:type" content="website">
<meta property="og:title" content="幻☆精灵的Blog">
<meta property="og:url" content="http://hstarorg.github.io/blog/page/8/index.html">
<meta property="og:site_name" content="幻☆精灵的Blog">
<meta property="og:description" content="幻☆精灵的Blog站点">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="幻☆精灵的Blog">
<meta name="twitter:description" content="幻☆精灵的Blog站点">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/blog/style.css">
  
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
		<div class="wrapper container">
			<a class="logo flat-box" href='/blog/' >
				幻☆精灵的Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/blog/'>
								首页
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/blog/archives'>
								归档
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/blog/about'>
								关于我
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu"></span></a></li>
			</ul>
		</div>
		<aside class="menu-phone">
			<nav>
				
					<a href="/blog/" class="nav-home nav">
						首页
					</a>
				
					<a href="/blog/archives" class="nav-archives nav">
						归档
					</a>
				
					<a href="/blog/about" class="nav-about nav">
						关于我
					</a>
				
			</nav>
		</aside>
</header>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container'>
      <div class='l_main'>
        
  <section class="page-header category banner waves-image">
    <h1 id='hitokoto'></h1>
  </section>

<section class="post-list">
	
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/从零开始H5/HTML5探索一（那些新增的标签和属性）/">
        HTML5探索一（那些新增的标签和属性）
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <p>html5相比html4，添加了部分语义化的标签和属性，现在我们就从这些标签和属性开始，学习html5吧。</p>
<p>首先，认识下HTML5新的文档类型：</p>
<pre><code>&lt;!DOCTYPE html&gt;
</code></pre><h2 id="那些新标签"><a href="#那些新标签" class="headerlink" title="那些新标签"></a>那些新标签</h2><h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><ol>
<li>&lt;bdi&gt; 定义文本的文本方向，使其脱离其周围文本的方向设置</li>
<li>&lt;mark&gt; 定义有记号的文本</li>
<li>&lt;meter&gt; 定义预定义范围内的度量</li>
<li>&lt;progress&gt; 定义任何类型的任务的进度</li>
<li>&lt;rp&gt; 定义若浏览器不支持ruby元素显示的内容</li>
<li>&lt;rt&gt; 定义ruby注释的解释</li>
<li>&lt;ruby&gt; 定义ruby注释</li>
<li>&lt;time&gt; 定义日期/时间</li>
<li>&lt;wbr&gt; 强制定义换行点</li>
</ol>
<p>HTML：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;HTML5 Test Page 1&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div&gt;&lt;bdi&gt;BDI:在发布用户评论或其他您无法完全控制的内容时，该标签很有用 test&lt;/bdi&gt;&lt;/div&gt;
    &lt;hr /&gt;
    &lt;div&gt;&lt;mark&gt;Mark:定义带有记号的文本&lt;/mark&gt;&lt;/div&gt;
    &lt;hr /&gt;
    &lt;div style=&quot;width:200px;border:1px solid red;&quot;&gt;&lt;meter value=&quot;10&quot; /&gt;Meter&lt;/div&gt;
    &lt;hr /&gt;
    &lt;div&gt;&lt;progress value=&quot;10&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;Progress: 用于显示进度，结合JS一同使用&lt;/div&gt;
    &lt;hr /&gt;
    &lt;div&gt;我在 &lt;time datetime=&quot;2008-02-14&quot;&gt;情人节&lt;/time&gt; 有个约会
    &lt;mark&gt;该标签不会再在任何浏览器中呈现任何特殊效果，仅仅方便搜索引擎生成更智能的结果&lt;/mark&gt;
    &lt;/div&gt;
    &lt;hr /&gt;
    &lt;div&gt;
      &lt;p&gt;如果想学习 AJAX，那么您必须熟悉 XML&lt;wbr&gt;Http&lt;wbr&gt;Request 对象。&lt;/p&gt;
      &lt;mark&gt;wbr可强制设置换行点&lt;/mark&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h3><ol>
<li>&lt;datalist&gt; 定义下拉列表</li>
<li>&lt;keygen&gt; 定义生成密钥</li>
<li>&lt;output&gt; 定义输出的一些类型</li>
</ol>
<p>HTML：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;HTML5 Test Page 2&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;form method=&quot;post&quot;&gt;
      &lt;p&gt;datalist:和input元素配合，用于定义input可能的值&lt;/p&gt;
      &lt;input id=&quot;lang&quot; list=&quot;dl&quot; /&gt;
      &lt;datalist id=&quot;dl&quot;&gt;
        &lt;option value=&quot;C#&quot; /&gt;
        &lt;option value=&quot;Java&quot; /&gt;
        &lt;option value=&quot;PHP&quot; /&gt;
      &lt;/datalist&gt;
      &lt;hr /&gt;
      &lt;p&gt;keygen:提交密钥串到服务器&lt;/p&gt;
      Username: &lt;input type=&quot;text&quot; name=&quot;usr_name&quot; /&gt;
      Encryption: &lt;keygen name=&quot;security&quot; /&gt;
      &lt;input type=&quot;submit&quot; /&gt;
      &lt;hr /&gt;
    &lt;/form&gt;
    &lt;p&gt;output:定义不同类型的输出&lt;/p&gt;
    &lt;form oninput=&quot;x.value=parseInt(a.value)+parseInt(b.value)&quot;&gt;
      0
      &lt;input type=&quot;range&quot; id=&quot;a&quot; value=&quot;50&quot;&gt;100
      +&lt;input type=&quot;number&quot; id=&quot;b&quot; value=&quot;50&quot;&gt;
      =&lt;output name=&quot;x&quot; for=&quot;a&quot;&gt;&lt;/output&gt;
    &lt;/form&gt; 
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="图像"><a href="#图像" class="headerlink" title="图像"></a>图像</h3><ol>
<li>&lt;canvas&gt; 定义图形</li>
<li>&lt;figcaption&gt; 定义figure元素的标题</li>
<li>&lt;figure&gt; 定义媒介内容的分组，以及它们的标题</li>
</ol>
<p>HTML：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;HTML5 Test Page 3&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div&gt;
      &lt;p&gt;canvas:你懂的，画布，各种绚丽效果就靠它了。&lt;/p&gt;
      &lt;canvas id=&quot;c&quot;&gt;&lt;/canvas&gt;
      &lt;script&gt;
        var canvas=document.getElementById(&apos;c&apos;);
        var ctx=canvas.getContext(&apos;2d&apos;);
        ctx.fillStyle=&apos;#FF0000&apos;;
        ctx.fillRect(0,0,80,100);
      &lt;/script&gt;
    &lt;/div&gt;
    &lt;hr /&gt;
    &lt;div&gt;
      &lt;p&gt;
      figure: 规定独立的流内容（图像、图表、照片、代码等等），figure 元素的内容应该与主内容相关，但如果被删除，则不应对文档流产生影响。
      &lt;br /&gt;
      figcaption:定义 figure 元素的标题，语义化&lt;/p&gt;
      &lt;figure&gt;
        &lt;figcaption&gt;黄浦江上的的卢浦大桥&lt;/figcaption&gt;
        &lt;img src=&quot;https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcSehM_6Bfd79RwCCy1wNj_K6YGEkMsdt0Gekn10Dc6xJ8nxDcS7rg&quot; width=&quot;350&quot; height=&quot;234&quot; /&gt;
      &lt;/figure&gt;
    &lt;/div&gt;   
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="音频-视频"><a href="#音频-视频" class="headerlink" title="音频/视频"></a>音频/视频</h3><ol>
<li>&lt;audio&gt; 定义声音内容</li>
<li>&lt;source&gt; 定义媒介源</li>
<li>&lt;track&gt; 定义用在媒体播放器中的文本轨道</li>
<li>&lt;video&gt; 定义视频</li>
</ol>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><ol>
<li>&lt;nav&gt; 定义导航链接</li>
</ol>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><ol>
<li>&lt;command&gt; 定义命令按钮 –<strong>注：现在浏览器暂时都不支持</strong></li>
</ol>
<h3 id="样式-节-–-语义化标签"><a href="#样式-节-–-语义化标签" class="headerlink" title="样式/节 – 语义化标签"></a>样式/节 – 语义化标签</h3><ol>
<li>&lt;header&gt; 定义section或page的页眉</li>
<li>&lt;footer&gt; 定义section或page的页脚</li>
<li>&lt;section&gt; 定义section</li>
<li>&lt;article&gt; 定义文章</li>
<li>&lt;aside&gt; 定义页面内容之外的内容</li>
<li>&lt;details&gt; 定义元素细节</li>
<li>&lt;dialog&gt; 定义对话框或窗口</li>
<li>&lt;summary&gt; 为&lt;details&gt;元素定义可见的标题</li>
</ol>
<h3 id="编程"><a href="#编程" class="headerlink" title="编程"></a>编程</h3><p>&lt;embed&gt; 为外部应用程序（非HTML）定义容器</p>
<h2 id="那些新属性"><a href="#那些新属性" class="headerlink" title="那些新属性"></a>那些新属性</h2><ol>
<li>contenteditable 规定元素内容是否可编辑</li>
<li>contextmenu 规定元素的上下文菜单。上下文菜单在用户点击元素时显示</li>
<li>data-* 用于存储页面或应用程序的私有定制数据</li>
<li>draggable 规定元素是否可拖动</li>
<li>dropzone 规定在拖动被多动数据时是否进行复制、移动或链接</li>
<li>hidden 规定元素仍未或不再相关</li>
<li>spellcheck 规定是否对元素进行拼写和语法检查</li>
<li>translate 规定是否应该翻译元素内容</li>
</ol>
<p><strong>以上全局属性可用于任何HTML元素</strong></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="http://www.w3schools.com/tags/" target="_blank" rel="external">http://www.w3schools.com/tags/</a></li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular相关/Angular1.x升级指南/">
        Angular1.x升级指南
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、导言"><a href="#0、导言" class="headerlink" title="0、导言"></a>0、导言</h2><p>Angular从1.2.x到1.3.x是一个大的跳跃。在1.3.x之后，也有1.4.x，1.5.x这么两个大版本。</p>
<p>Newkit从1.2.x跳跃到1.3.x经历过一次大的变化，在之后的较大版本升级中，基本上没有大多大改动。但是其中的差异点，我们也需要去了解。</p>
<p>1.3.x以前的版本，我们就不去深究了，毕竟现在不是主流，我们就从1.3.x开始，来看看Angular到底有了哪些变化。</p>
<h2 id="1、从1-3-x到1-4-x"><a href="#1、从1-3-x到1-4-x" class="headerlink" title="1、从1.3.x到1.4.x"></a>1、从1.3.x到1.4.x</h2><p>从1.3到1.4，Angular的变化涉及到很多个方面，一一列举如下。</p>
<h3 id="1-1、动画"><a href="#1-1、动画" class="headerlink" title="1.1、动画"></a>1.1、动画</h3><p>在1.4中，动画功能进行了很大的重构，但是API基本保持一致。在新的版本中，我们通过注入 <code>$animationCss</code> 来实现用JS创建CSS动画。</p>
<p><strong>1.1.1、定义CSS动画如下：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'app'</span>, [<span class="string">'ngAnimate'</span>])</div><div class="line">  .animation(<span class="string">'.slide-animation'</span>, [<span class="string">'$animateCss'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$animateCss</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">enter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">element, doneFn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> animation =  $animateCss(element, &#123;</div><div class="line">          <span class="attr">from</span>: &#123; <span class="attr">background</span>: <span class="string">'black'</span> &#125;,</div><div class="line">          <span class="attr">to</span>: &#123; <span class="attr">background</span>: <span class="string">'blue'</span> &#125;,</div><div class="line">          <span class="attr">duration</span>: <span class="number">10</span> <span class="comment">// one second</span></div><div class="line">        &#125;);</div><div class="line">        animation.start().done(doneFn);</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">leave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">element, doneFn</span>)</span>&#123;</div><div class="line">         <span class="keyword">var</span> animation =  $animateCss(element, &#123;</div><div class="line">          <span class="attr">from</span>: &#123; <span class="attr">fontSize</span>: <span class="string">'12px'</span> &#125;,</div><div class="line">          <span class="attr">to</span>: &#123; <span class="attr">fontSize</span>: <span class="string">'25px'</span> &#125;,</div><div class="line">          <span class="attr">duration</span>: <span class="number">10</span> <span class="comment">// one second</span></div><div class="line">        &#125;);</div><div class="line">        animation.start().done(doneFn);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;]);</div></pre></td></tr></table></figure>
<p>如何使用？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test slide-animation"</span> <span class="attr">ng-if</span>=<span class="string">"vm.ck1"</span>&gt;</span> AAAAAAAAAAA<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>只需要在元素上设置一个class，然后当元素从隐藏到显示，则会执行 <code>enter</code> 动画，从显示到隐藏，则会执行 <code>leave</code> 动画。</p>
<p><strong>1.1.2、监听动画事件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt; 1.4</span></div><div class="line">element.on(<span class="string">'$animate:before'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (data.event === <span class="string">'enter'</span>) &#123; ... &#125;</div><div class="line">&#125;);</div><div class="line">element.off(<span class="string">'$animate:before'</span>, fn);</div><div class="line"></div><div class="line"><span class="comment">// 1.4+</span></div><div class="line">$animate.on(<span class="string">'enter'</span>, element, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line">&#125;);</div><div class="line">$animate.off(<span class="string">'enter'</span>, element, fn);</div></pre></td></tr></table></figure>
<p>在1.4版本之前，我们需要通过在element上去监听动画开始和结束，另外还必须要通过 <code>data.event</code> 来判断动画类型。</p>
<p>在1.4及以后，我们可以直接通过 <code>$animate</code> 来监控了。</p>
<p><strong>1.1.3、触发动画</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $el = $(<span class="string">'.slide-animation'</span>);</div><div class="line">$animate.enter($el, $el.parent()).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'enter'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>我们需要使用如上的方式，来手动启动动画，此时会触发元素的对应动画事件。</p>
<p><strong>注意：触发动画的回调中，如果要操作$scope,在&lt;1.4中会失败，需要借助$apply，但在1.4+，就不需要了。示例如下：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$animate.enter(element, elementParent).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $scope.explode = <span class="literal">true</span>;</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 1.4+</span></div><div class="line">$animate.enter(element, elementParent).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $scope.explode = <span class="literal">true</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>1.1.4、启用/禁用动画</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt; 1.4</span></div><div class="line">$animate.enabled(<span class="literal">false</span>, element);</div><div class="line"></div><div class="line"><span class="comment">// 1.4+</span></div><div class="line">$animate.enabled(element, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>实现该操作的方法参数1.4+刚好和小于1.4相反。</p>
<h3 id="1-2、表单"><a href="#1-2、表单" class="headerlink" title="1.2、表单"></a>1.2、表单</h3><p><strong>1.2.1、ngMessages</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;!-- AngularJS <span class="number">1.3</span>.x --&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages</span>=<span class="string">"model.$error"</span> <span class="attr">ng-messages-include</span>=<span class="string">"remote.html"</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"required"</span>&gt;</span>Your message is required<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">&lt;!-- AngularJS <span class="number">1.4</span>.x --&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages</span>=<span class="string">"model.$error"</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"required"</span>&gt;</span>Your message is required<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages-include</span>=<span class="string">"remote.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在1.3版本中，<code>ng-messages-include</code> 跟随在 <code>ng-messages</code> 元素上，这样并不灵活。</p>
<p>在1.4+中，<code>ng-messages-include</code> 不允许更随在 <code>ng-messages</code> 元素上，必须放在内部，这样使得使用远程模板非常灵活。</p>
<p>另外，当存在多个form时，我们在使用ng-messages获取指定form的方法也有变化，如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// &lt; 1.4</div><div class="line">&lt;div ng-messages="ctrl.form['field_&#123;&#123;$index&#125;&#125;'].$error"&gt;...&lt;/div&gt;</div><div class="line"></div><div class="line">// 1.4 + </div><div class="line">&lt;div ng-messages="ctrl.getMessages($index)"&gt;...&lt;/div&gt;</div><div class="line">ctrl.getMessages = function($index) &#123;</div><div class="line">  return ctrl.form['field_' + $index].$error;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>1.2.2、ngOptions</strong></p>
<p>ngOptions仅仅只是内部实现变化，在使用上并没有多大差异。其中当遍历Object时，之前的版本是用的 <code>for in</code>，导致输出的key是字符序的。新版本采用 <code>Object.keys</code>，输出的key是定义时候的顺序。</p>
<p>另外当ngOptions表达式执行之后，将不会再触发ngOptions了。</p>
<p><strong>1.2.3、select</strong></p>
<p>在 <strong>select</strong> 元素中，这是一个非常大的变更。简单理解，如下：在1.3中，ngModel和&lt;option&gt;的value比较仅仅是 <code>==</code>，所以 <code>200 == &#39;200&#39; //true</code>。在1.4+中，比较方式成了 <code>===</code>,所以 <code>200 === &#39;200&#39; //false</code>。</p>
<p>这个时候我们可以通过如下方式处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ngModelCtrl.$parsers.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">parseInt</span>(value, <span class="number">10</span>); <span class="comment">// Convert option value to number</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">ngModelCtrl.$formatters.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> value.toString(); <span class="comment">// Convert scope value to string</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>实现指令如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">'convertNumber'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">require</span>: <span class="string">'ngModel'</span>,</div><div class="line">    <span class="attr">link</span>: <span class="function"><span class="keyword">function</span>(<span class="params">scope, el, attr, ctrl</span>) </span>&#123;</div><div class="line">      ctrl.$parsers.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">parseInt</span>(value, <span class="number">10</span>);</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      ctrl.$formatters.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> value.toString();</div><div class="line">      &#125;);      </div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>当然，如果我们保证ngModel的值为string类型，那就没啥问题了（在不使用ng-value的情况下）。</p>
<p><strong>1.2.4、Form</strong></p>
<p>表单的变化，主要是name属性，在 &lt; 1.4 的版本中，我们可以设置name为 “my:form1”，在1.4+版本中，不在允许这种特殊的用法。</p>
<h3 id="1-3、模板相关"><a href="#1-3、模板相关" class="headerlink" title="1.3、模板相关"></a>1.3、模板相关</h3><p><strong>1.3.1、ngRepeat</strong></p>
<p>&lt; 1.4 版本中，ng-repeat的遍历顺序是字母序。</p>
<p>1.4+版本中，顺序是有浏览器的 <code>for in</code> 来返回的。</p>
<p><strong>1.3.2、ngInclude</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt; 1.4</span></div><div class="line"></div><div class="line">&lt;div ng-include=<span class="string">"findTemplate('https://example.com/templates/myTemplate.html')"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">$scope.findTemplate = <span class="function"><span class="keyword">function</span>(<span class="params">templateName</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> $sce.trustAsResourceUrl(templateName);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 1.4+</span></div><div class="line"><span class="keyword">var</span> templateCache = &#123;&#125;;</div><div class="line">$scope.findTemplate = <span class="function"><span class="keyword">function</span>(<span class="params">templateName</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!templateCache[templateName]) &#123;</div><div class="line">    templateCache[templateName] = $sce.trustAsResourceUrl(templateName);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> templateCache[templateName];</div><div class="line">&#125;;</div><div class="line"><span class="comment">// Or</span></div><div class="line">angular.module(<span class="string">'myApp'</span>, []).config(<span class="function"><span class="keyword">function</span>(<span class="params">$sceDelegateProvider</span>) </span>&#123;</div><div class="line">  $sceDelegateProvider.resourceUrlWhitelist([<span class="string">'self'</span>, <span class="string">'https://example.com/templates/**'</span>])</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="1-4、Cookie"><a href="#1-4、Cookie" class="headerlink" title="1.4、Cookie"></a>1.4、Cookie</h3><p>在1.4+中，cookie增加了新的API：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">get</div><div class="line">put</div><div class="line">getObject</div><div class="line">putObject</div><div class="line">getAll</div><div class="line">remove</div></pre></td></tr></table></figure>
<p>另外，<code>$cookieStore</code> 将不推荐使用。</p>
<h3 id="1-5、HTTP"><a href="#1-5、HTTP" class="headerlink" title="1.5、HTTP"></a>1.5、HTTP</h3><p>在1.4+中，$http的 <code>transformRequest</code> 将不允许修改请求header。但是我们可以使用如下方式进行动态的header设置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$http.get(url, &#123;</div><div class="line">  <span class="attr">headers</span>: &#123;</div><div class="line">    <span class="string">'X-MY_HEADER'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">'abcd'</span>; <span class="comment">//you've got access to a request config object to specify header value dynamically</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="1-6、Filter"><a href="#1-6、Filter" class="headerlink" title="1.6、Filter"></a>1.6、Filter</h3><p><code>fliter</code>如果作用在非数组上，将会抛出一个异常，之前则是返回一个空数组。</p>
<p><code>limitTo</code>作用在不合法的value上，现在将会原样返回，之前是返回空对象，空数组。</p>
<h2 id="2、从1-4-x到1-5-x"><a href="#2、从1-4-x到1-5-x" class="headerlink" title="2、从1.4.x到1.5.x"></a>2、从1.4.x到1.5.x</h2><p>从 1.4.x 到 1.5.x 是一个为升级ng2做准备的变更版本。</p>
<p>该版本主要是增加了一些功能，所以从1.4.x升级到1.5.x基本不需要太大的改动。</p>
<p>在 1.5.x 版本中，增加了一些接近ng2的新特性，如：</p>
<ol>
<li>angular.component() //一种偏向于angular2风格的组件（特殊的指令）</li>
<li>$onInit //生命周期钩子</li>
<li>ngAnimateSwap // ngAnimate中一个新的指令</li>
</ol>
<p>接着，我们来看下它的一些具体变更。</p>
<h3 id="2-1、Core"><a href="#2-1、Core" class="headerlink" title="2.1、Core"></a>2.1、Core</h3><p><strong>2.1.1、$parse</strong></p>
<p><code>$parse</code> 增加新特性，可以使用locals来覆盖原本的context。用法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> context = &#123; <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">'Jay'</span> &#125; &#125;;</div><div class="line"><span class="keyword">var</span> locals = &#123; <span class="attr">user</span>: &#123; <span class="attr">name1</span>: <span class="string">'Local Jay'</span> &#125; &#125;;</div><div class="line"><span class="keyword">var</span> getter = <span class="keyword">this</span>.$parse(<span class="string">'user.name'</span>);</div><div class="line"><span class="built_in">console</span>.log(getter(context)); <span class="comment">// 'Jay'</span></div><div class="line"><span class="built_in">console</span>.log(getter(context, locals)); <span class="comment">// 'Local Jay'</span></div></pre></td></tr></table></figure>
<p><strong>2.1.2、ngOptions</strong></p>
<p>如果元素上有 <code>ngOptions</code> 指令，那么 <code>ngModel</code> 指令也必须存在，否则就会抛出错误。</p>
<p>另外 <code>ngOptions</code> 接受假值（’’, 0, false, null）</p>
<p><strong>2.1.3、orderBy</strong></p>
<p>对 <code>undefined</code> 或者 <code>null</code> 进行 <code>orderBy</code> 将会抛出错误。</p>
<h3 id="2-2、ngAria"><a href="#2-2、ngAria" class="headerlink" title="2.2、ngAria"></a>2.2、ngAria</h3><p>取消了部分元素的可访问性设置。</p>
<h3 id="2-3-ngMessages"><a href="#2-3-ngMessages" class="headerlink" title="2.3 ngMessages"></a>2.3 ngMessages</h3><p>将 <code>ngMessages</code> 指令的优先级设置为1，如果有优先级低于1的指令有transclude功能，那么需要设置为更高的优先级。</p>
<h3 id="2-4、ngResource"><a href="#2-4、ngResource" class="headerlink" title="2.4、ngResource"></a>2.4、ngResource</h3><p><code>$resource</code> 增加了 <code>$cancelRequest()</code> 方法。</p>
<h3 id="2-5、ngRoute"><a href="#2-5、ngRoute" class="headerlink" title="2.5、ngRoute"></a>2.5、ngRoute</h3><p>增加了 <code>$resolveAs</code> 配置属性，允许对 <code>$resolve</code> 指定别名。</p>
<h3 id="2-6、ngTouch"><a href="#2-6、ngTouch" class="headerlink" title="2.6、ngTouch"></a>2.6、ngTouch</h3><p>默认禁用了 <code>ngClickOverrideEnabled</code>，在触摸屏上，可能还有300ms的延迟。</p>
<p>如果要启用，那么可以使用如下方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>).config(<span class="function"><span class="keyword">function</span>(<span class="params">$touchProvider</span>) </span>&#123;</div><div class="line">  $touchProvider.ngClickOverrideEnabled(<span class="literal">true</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>另外，建议使用FastClick来实现该功能。</p>
<p>需要注意，某些现代浏览器在某些场景下已经删除了300ms延迟：</p>
<p>Chrome 和 Firefox for Android 发现设置了 <code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</code> 将会删除300ms延迟。</p>
<p>IE当设置 <code>touch-action</code> 为 <code>none</code> 或者 <code>manipulation</code> 移除延迟。</p>
<p><strong>注意：这些变化并不影响ngSwipe指令</strong>。</p>
<h2 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h2><p>Angular1.x基本已经进入维护期了，很少会有新特性加入了。现在的重心在angular2，所以我们也可以优先对angular2做一些技术储备。</p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular相关/Angular从0到1：function（下）/">
        Angular从0到1：function（下）
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><h2 id="2、function（下）"><a href="#2、function（下）" class="headerlink" title="2、function（下）"></a>2、function（下）</h2><h3 id="2-13、angular-isArray-★★"><a href="#2-13、angular-isArray-★★" class="headerlink" title="2.13、angular.isArray(★★)"></a>2.13、angular.isArray(★★)</h3><p><code>angular.isArray</code>用于判断对象是不是数组，等价于<code>Array.isArray</code></p>
<pre><code>console.log(angular.isArray([])); // true
console.log(angular.isArray({0: &apos;1&apos;, 1: &apos;2&apos;, length: 2})); // false
</code></pre><h3 id="2-14、angular-isDate-★★"><a href="#2-14、angular-isDate-★★" class="headerlink" title="2.14、angular.isDate(★★)"></a>2.14、angular.isDate(★★)</h3><p>通过判断toString.call(value)是不是等于’[object Date]’ 来判断对象是个是一个Date对象.</p>
<pre><code>console.log(angular.isDate(new Date())); // true
console.log(angular.isDate(223)); // false
</code></pre><h3 id="2-15、angular-isDefined-★★"><a href="#2-15、angular-isDefined-★★" class="headerlink" title="2.15、angular.isDefined(★★)"></a>2.15、angular.isDefined(★★)</h3><p>判断对象或者属性是否定义</p>
<pre><code>var obj = {a: 1, b: null, c: undefined};
console.log(angular.isDefined(obj.a)); // true
console.log(angular.isDefined(obj.b)); // true
console.log(angular.isDefined(obj.c)); // false
console.log(angular.isDefined(obj.d)); // false
</code></pre><h3 id="2-16、angular-isElement-★★"><a href="#2-16、angular-isElement-★★" class="headerlink" title="2.16、angular.isElement(★★)"></a>2.16、angular.isElement(★★)</h3><p>此方法判断元素是不是一个元素（包含dom元素，或者jquery元素）</p>
<pre><code>console.log(angular.isElement(document.getElementsByTagName(&apos;body&apos;)[0])); // true
console.log(angular.isElement($(&apos;body&apos;))); // true
</code></pre><h3 id="2-17、angular-isFunction-★★"><a href="#2-17、angular-isFunction-★★" class="headerlink" title="2.17、angular.isFunction(★★)"></a>2.17、angular.isFunction(★★)</h3><p>此方法判断对象是不是一个function ，等价于 typeof fn === ‘function’</p>
<pre><code>console.log(angular.isFunction(new Function(&apos;a&apos;, &apos;return a&apos;))); // true
console.log(angular.isFunction(function(){})); // true
console.log(angular.isFunction({})); // false
</code></pre><h3 id="2-18、angular-isNumber-★★"><a href="#2-18、angular-isNumber-★★" class="headerlink" title="2.18、angular.isNumber(★★)"></a>2.18、angular.isNumber(★★)</h3><p>判断数字是否为number</p>
<pre><code>function isNumber(value) {
  return typeof value === &apos;number&apos;;
}
</code></pre><h3 id="2-19、angular-isObject-★★"><a href="#2-19、angular-isObject-★★" class="headerlink" title="2.19、angular.isObject(★★)"></a>2.19、angular.isObject(★★)</h3><pre><code>function isObject(value) {
  return value !== null &amp;&amp; typeof value === &apos;object&apos;;
}
</code></pre><h3 id="2-20、angular-isString-★★"><a href="#2-20、angular-isString-★★" class="headerlink" title="2.20、angular.isString(★★)"></a>2.20、angular.isString(★★)</h3><pre><code>function isString(value) {
    return typeof value === &apos;string&apos;;
}
</code></pre><h3 id="2-21、angular-isUndefined-★★"><a href="#2-21、angular-isUndefined-★★" class="headerlink" title="2.21、angular.isUndefined(★★)"></a>2.21、angular.isUndefined(★★)</h3><pre><code>function isUndefined(value) {
    return typeof value === &apos;undefined&apos;;
}
</code></pre><h3 id="2-22、angular-lowercase-★★"><a href="#2-22、angular-lowercase-★★" class="headerlink" title="2.22、angular.lowercase(★★)"></a>2.22、angular.lowercase(★★)</h3><p>转换字符串为小写模式，如果参数不是字符串，那么原样返回</p>
<pre><code>var lowercase = function(string) {
  return isString(string) ? string.toLowerCase() : string;
};

console.log(angular.lowercase(1)); // 1
console.log(angular.lowercase(&apos;ABCdef&apos;)); // &apos;abcdef&apos;
</code></pre><h3 id="2-23、angular-uppercase-★★"><a href="#2-23、angular-uppercase-★★" class="headerlink" title="2.23、angular.uppercase(★★)"></a>2.23、angular.uppercase(★★)</h3><p>转换字符串为大写模式，如果参数不是字符串，那么原样返回</p>
<pre><code>var uppercase = function(string) {
  return isString(string) ? string.toUpperCase() : string;
};

console.log(angular.uppercase(1)); // 1
console.log(angular.uppercase(&apos;ABCdef&apos;)); // &apos;ABCDEF&apos;
</code></pre><h3 id="2-24、angular-merge-★★"><a href="#2-24、angular-merge-★★" class="headerlink" title="2.24、angular.merge(★★)"></a>2.24、angular.merge(★★)</h3><p>将多个对象进行深度复制，与extend()不同，merge将会递归进行深度拷贝。该拷贝是完全深拷贝，就连对象引用也不一样。</p>
<pre><code>var o = {};
var obj1 = {a1: 1, a2: 2, a3: [1]};
var obj2 = {b1: [2], b2: /abc/};
var obj3 = [o];
var obj4 = {d: o};
var result = angular.merge({}, obj1, obj2, obj3);
console.log(result);
console.log(result[0] === o); // false
console.log(result.d === o); // false
</code></pre><h3 id="2-25、angular-noop-★★"><a href="#2-25、angular-noop-★★" class="headerlink" title="2.25、angular.noop(★★)"></a>2.25、angular.noop(★★)</h3><p>一个空函数，调试时非常有用。可以避免callback未定义引发的error。</p>
<pre><code>function foo(callback) {
  var result = calculateResult();
  (callback || angular.noop)(result);
}
</code></pre><h3 id="2-26、angular-reloadWithDebugInfo-★★"><a href="#2-26、angular-reloadWithDebugInfo-★★" class="headerlink" title="2.26、angular.reloadWithDebugInfo(★★)"></a>2.26、angular.reloadWithDebugInfo(★★)</h3><p>启用DebugInfo，该设置优先级高于<code>$compileProvider.debugInfoEnabled(false)</code></p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/jQuery拆解/Ajax/">
        Ajax
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、Ajax"><a href="#0、Ajax" class="headerlink" title="0、Ajax"></a>0、Ajax</h2><p><code>jQuery Ajax</code> 在 <code>jQuery</code> 中是一个非常重要的部分。</p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular2一路向前/02_Angular2组件生命周期/">
        02_Angular2组件生命周期
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、Angular2-组件"><a href="#0、Angular2-组件" class="headerlink" title="0、Angular2 组件"></a>0、Angular2 组件</h2><p>Angular1并不是围绕组件的概念来实现的。所以，我们需要controller、$scope，同时也需要封装自定义指令。</p>
<p>在Angular2中，把之前的这些东西都丢弃了，使用了一种更面向对象的组件模型。</p>
<p>一个组件控制着我们称之为View的显示部分。组件同时也是自描述的。</p>
<p><strong>在Angular2中，指令也是存在的，组件只是指令的一种。</strong></p>
<h2 id="1、定义一个组件"><a href="#1、定义一个组件" class="headerlink" title="1、定义一个组件"></a>1、定义一个组件</h2><p>最基本的组件只需要提供一个selector和template就足够了。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component&#125; <span class="keyword">from</span> <span class="string">'angular2/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'basic-info'</span>,</div><div class="line">  <span class="attr">template</span>: <span class="string">'&lt;h1&gt;Basic Info&lt;/h1&gt;'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AboutComponent</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line"></div><div class="line">要实现输入和输出呢？</div><div class="line"></div><div class="line">`<span class="string">``</span>javascript</div><div class="line"><span class="keyword">import</span> &#123;Component, Input, Output, EventEmitter&#125; <span class="keyword">from</span> <span class="string">'angular2/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'basic-info'</span>,</div><div class="line">  <span class="attr">template</span>: <span class="string">`</span></div><div class="line">  &lt;h1&gt;Basic Info, &#123;&#123;abc&#125;&#125;&lt;/h1&gt;</div><div class="line">  &lt;input type="text" [(ngModel)]="abc"&gt;</div><div class="line">  `</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicInfo</span></span>&#123;</div><div class="line">  @Input(<span class="string">'test'</span>) set value(val)&#123;</div><div class="line">    <span class="keyword">this</span>.abc = val;</div><div class="line">    <span class="keyword">this</span>.callback.next([val]);</div><div class="line">  &#125;</div><div class="line">  @Output(<span class="string">'callback'</span>) callback = <span class="keyword">new</span> EventEmitter();</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>.abc = <span class="string">'aaaa'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如何使用？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)] = <span class="string">"value"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">basic-info</span> [<span class="attr">test</span>]=<span class="string">"value"</span> (<span class="attr">callback</span>)=<span class="string">"innerCallback($event)"</span>&gt;</span><span class="tag">&lt;/<span class="name">basic-info</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2、组件生命周期"><a href="#2、组件生命周期" class="headerlink" title="2、组件生命周期"></a>2、组件生命周期</h2><p>Angular2会管理组件的整个生命周期，包括组件的创建、渲染、子组件的创建和渲染、数据绑定属性变化时的校验、从DOM移除之前的销毁等等。</p>
<p>那如果我们想在某个状态时，进行一些操作应该怎么办呢？Angular2提供了组件生命周期的钩子，供我们在这些时间点添加自定义的操作。</p>
<p>在<code>angular2/core</code>中提供了多个Lifecycle Hook接口，我们可以实现一个或多个接口，来设置自定义操作。每一个接口，都会有一个钩子方法，钩子方法的名称是接口的名称加上前缀ng。如OnInit的钩子方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component, Input, Output, EventEmitter&#125; <span class="keyword">from</span> <span class="string">'angular2/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'basic-info'</span>,</div><div class="line">  <span class="attr">template</span>: <span class="string">`</span></div><div class="line">  &lt;h1&gt;Basic Info, &#123;&#123;abc&#125;&#125;&lt;/h1&gt;</div><div class="line">  &lt;input type="text" [(ngModel)]="abc"&gt;</div><div class="line">  `</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicInfo</span></span>&#123;</div><div class="line">  @Input(<span class="string">'test'</span>) set value(val)&#123;</div><div class="line">    <span class="keyword">this</span>.abc = val;</div><div class="line">    <span class="keyword">this</span>.callback.next([val]);</div><div class="line">  &#125;</div><div class="line">  @Output(<span class="string">'callback'</span>) callback = <span class="keyword">new</span> EventEmitter();</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>.abc = <span class="string">'aaaa'</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 组件Init时创建</span></div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info init.'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>生命周期钩子（组件和指令都有的）</strong></p>
<ol>
<li>ngOnInit //组件初始化，在Angular初始化数据绑定输入属性之后</li>
<li>ngOnChanges // </li>
<li>ngDoCheck</li>
<li>ngOnDestroy</li>
</ol>
<p><strong>生命周期钩子（组件特有的）</strong></p>
<ol>
<li>ngAfterContentInit // Angular将外部内容放入视图后</li>
<li>ngAfterContentChecked // 在Angular检测放到视图内的外部内容的绑定后</li>
<li>ngAfterViewInit // Angular创建视图之后</li>
<li>ngAfterViewChecked //Angular检测了组件视图的绑定之后</li>
</ol>
<p><strong>执行顺序</strong></p>
<ol>
<li>ngOnChanges //绑定属性变化时</li>
<li>ngOnInit //在第一次ngOnChanges之后，初始化时</li>
<li>ngDoCheck //每次Angular变化检测时</li>
<li>ngAfterContentInit //组件内容初始化之后</li>
<li>ngAfterContentChecked //组件内容变化后</li>
<li>ngAfterViewInit //初始化组件视图和子视图之后</li>
<li>ngAfterViewChecked //在数组视图和子视图检查之后</li>
<li>ngOnDestroy</li>
</ol>
<p>我们将组件设定上钩子函数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component, Input, Output, EventEmitter&#125; <span class="keyword">from</span> <span class="string">'angular2/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'basic-info'</span>,</div><div class="line">  <span class="attr">template</span>: <span class="string">`</span></div><div class="line">  &lt;h1&gt;Basic Info, &#123;&#123;abc&#125;&#125;&lt;/h1&gt;</div><div class="line">  &lt;input type="text" [(ngModel)]="abc"&gt;</div><div class="line">  `</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicInfo</span></span>&#123;</div><div class="line">  @Input(<span class="string">'test'</span>) set value(val)&#123;</div><div class="line">    <span class="keyword">this</span>.abc = val;</div><div class="line">    <span class="keyword">this</span>.callback.next([val]);</div><div class="line">  &#125;</div><div class="line">  @Output(<span class="string">'callback'</span>) callback = <span class="keyword">new</span> EventEmitter();</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>.abc = <span class="string">'aaaa'</span>;</div><div class="line">  &#125;</div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info init.'</span>);</div><div class="line">  &#125;</div><div class="line">  ngDoCheck()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info do check.'</span>);</div><div class="line">  &#125;</div><div class="line">  ngOnChanges()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info changes.'</span>);</div><div class="line">  &#125;</div><div class="line">  ngOnDestroy()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info destroy'</span>);</div><div class="line">  &#125;</div><div class="line">  ngAfterContentInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info after content init'</span>);</div><div class="line">  &#125;</div><div class="line">  ngAfterContentChecked()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info after content checked'</span>);</div><div class="line">  &#125;</div><div class="line">  ngAfterViewInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info after view init'</span>);</div><div class="line">  &#125;</div><div class="line">  ngAfterViewChecked()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'basic info after view checked'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>控制台打印的结果是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">basic info changes.</div><div class="line">test.component.js:23 basic info init.</div><div class="line">test.component.js:26 basic info do check.</div><div class="line">test.component.js:35 basic info after content init</div><div class="line">test.component.js:38 basic info after content checked</div><div class="line">test.component.js:41 basic info after view init</div><div class="line">test.component.js:44 basic info after view checked</div><div class="line">test.component.js:26 basic info do check.</div><div class="line">test.component.js:38 basic info after content checked</div><div class="line">test.component.js:44 basic info after view checked</div><div class="line">test.component.js:26 basic info do check.</div><div class="line">test.component.js:38 basic info after content checked</div><div class="line">test.component.js:44 basic info after view checked</div><div class="line">test.component.js:26 basic info do check.</div><div class="line">test.component.js:38 basic info after content checked</div><div class="line">test.component.js:44 basic info after view checked</div></pre></td></tr></table></figure>

    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular相关/详解angular之$q/">
        详解angular之$q
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、什么的Promise"><a href="#0、什么的Promise" class="headerlink" title="0、什么的Promise"></a>0、什么的Promise</h2><p>Promise（承诺）是用于改善异步编程体验的一种编程模型，它提供了一些列的API的方法论，让你能更优雅的解决异步编程中出现的一些问题。</p>
<h2 id="1、Promise的核心竞争力"><a href="#1、Promise的核心竞争力" class="headerlink" title="1、Promise的核心竞争力"></a>1、Promise的核心竞争力</h2><p>在处理有依赖性的回调的时候，我们的代码是这样写的：</p>
<pre><code>step1(function (value1) {
    step2(value1, function(value2) {
        step3(value2, function(value3) {
            step4(value3, function(value4) {
                // Do something with value4
            });
        });
    });
});
</code></pre><p>这就是我们所谓的回调地狱。</p>
<p>如果用Promise的方式来实现，是怎么样呢？</p>
<pre><code>step1().then(step2).then(step3).then(step4)
</code></pre><p>代码更简单逻辑也清晰，异步的回调嵌套变成了同步写法，孰优孰劣相信大家都一目了然。</p>
<h2 id="2、Angular服务-q"><a href="#2、Angular服务-q" class="headerlink" title="2、Angular服务$q"></a>2、Angular服务$q</h2><p>在angular中，基于nodejs中流行的Q提供了一个简化版本的Q,对外的话提供一个service $q。</p>
<p>以下列举出angular中的$q提供的API</p>
<h4 id="1、Promise-then-将回调变成链式调用，then可以接两个参数，successCallback-errorCallback-示例如下："><a href="#1、Promise-then-将回调变成链式调用，then可以接两个参数，successCallback-errorCallback-示例如下：" class="headerlink" title="1、Promise.then() 将回调变成链式调用，then可以接两个参数，successCallback, errorCallback,示例如下："></a>1、Promise.then() 将回调变成链式调用，then可以接两个参数，successCallback, errorCallback,示例如下：</h4><pre><code>var deferred = $q.defer();
var promise = deferred.promise;
promise.then(successCallback, errorCallback);
</code></pre><h4 id="2、Promise-catch-捕获Promise异常，Promise-catch-errorCallback-等价于Promise-then-null-errorCallback"><a href="#2、Promise-catch-捕获Promise异常，Promise-catch-errorCallback-等价于Promise-then-null-errorCallback" class="headerlink" title="2、Promise.catch 捕获Promise异常，Promise.catch(errorCallback)等价于Promise.then(null, errorCallback)"></a>2、Promise.catch 捕获Promise异常，Promise.catch(errorCallback)等价于Promise.then(null, errorCallback)</h4><h4 id="3、Promise-finally-callback-notifyCallback-promise结束后要做的事情和接收通知信息"><a href="#3、Promise-finally-callback-notifyCallback-promise结束后要做的事情和接收通知信息" class="headerlink" title="3、Promise.finally(callback, notifyCallback) promise结束后要做的事情和接收通知信息"></a>3、Promise.finally(callback, notifyCallback) promise结束后要做的事情和接收通知信息</h4><h4 id="4、Deferred-resolve-val-通知promise请求处理完毕，并将处理结果传给回调函数（successCallback），示例如下："><a href="#4、Deferred-resolve-val-通知promise请求处理完毕，并将处理结果传给回调函数（successCallback），示例如下：" class="headerlink" title="4、Deferred.resolve(val) 通知promise请求处理完毕，并将处理结果传给回调函数（successCallback），示例如下："></a>4、Deferred.resolve(val) 通知promise请求处理完毕，并将处理结果传给回调函数（successCallback），示例如下：</h4><pre><code>var deferred = $q.defer();
setTimeout(function(){
    deferred.resolve(&apos;abc&apos;); //会将abc传递给successCallback
}, 1000);
var promise = deferred.promise;
promise.then(successCallback, errorCallback);
</code></pre><h4 id="5、Deferred-reject-msg-通知promise请求出现异常，将异常信息传给回调函数（errorCallback），示例如下："><a href="#5、Deferred-reject-msg-通知promise请求出现异常，将异常信息传给回调函数（errorCallback），示例如下：" class="headerlink" title="5、Deferred.reject(msg) 通知promise请求出现异常，将异常信息传给回调函数（errorCallback），示例如下："></a>5、Deferred.reject(msg) 通知promise请求出现异常，将异常信息传给回调函数（errorCallback），示例如下：</h4><pre><code>var deferred = $q.defer();
setTimeout(function(){
    deferred.reject(&apos;abc&apos;); //会将abc传递给errorCallback
}, 1000);
var promise = deferred.promise;
promise.then(successCallback, errorCallback);
</code></pre><h4 id="6、Deferred-notify-value-内部执行有变化时，对外发起通知。将会在Promise-finally中捕获到"><a href="#6、Deferred-notify-value-内部执行有变化时，对外发起通知。将会在Promise-finally中捕获到" class="headerlink" title="6、Deferred.notify(value) 内部执行有变化时，对外发起通知。将会在Promise.finally中捕获到"></a>6、Deferred.notify(value) 内部执行有变化时，对外发起通知。将会在Promise.finally中捕获到</h4><pre><code>var deferred = $q.defer();
setTimeout(function(){
    deferred.reject(&apos;abc&apos;); //会将abc传递给errorCallback
}, 1000);
var promise = deferred.promise;
promise.then(successCallback, errorCallback);
</code></pre><h4 id="7、-q-when-val-fn-将任意对象-函数包装成promise，返回包装好的promise。"><a href="#7、-q-when-val-fn-将任意对象-函数包装成promise，返回包装好的promise。" class="headerlink" title="7、$q.when(val/fn) 将任意对象/函数包装成promise，返回包装好的promise。"></a>7、$q.when(val/fn) 将任意对象/函数包装成promise，返回包装好的promise。</h4><h4 id="8、-q-all-promises-then-当所有的promise都成功解析后，流程才继续往下走。示例如下"><a href="#8、-q-all-promises-then-当所有的promise都成功解析后，流程才继续往下走。示例如下" class="headerlink" title="8、$q.all(promises).then() 当所有的promise都成功解析后，流程才继续往下走。示例如下:"></a>8、$q.all(promises).then() 当所有的promise都成功解析后，流程才继续往下走。示例如下:</h4><pre><code>$q.all($http.get(&apos;xxx&apos;), $http.post(&apos;xxx&apos;,{}))
.then(successCallback, errorCallback);
</code></pre><h2 id="3、-q的使用"><a href="#3、-q的使用" class="headerlink" title="3、$q的使用"></a>3、$q的使用</h2><p>常规使用</p>
<pre><code>//定义开关变量
var canSuccess = false;
//定义一个Promise
var buildPromise = ()=&gt;{
  var deferred = $q.defer();
  setTimeout(()=&gt;{
    if(canSuccess){
      deferred.resolve(&apos;promise执行成功！&apos;)
    }else{
      deferred.reject(&apos;promise执行失败！&apos;)
    }
  },5000);
  return deferred.promise;
};

//使用它
var promise = buildPromise();
promise.then(()=&gt;{
  console.log(&apos;执行成功啦！&apos;);
}, ()=&gt;{
  console.log(&apos;执行失败了！&apos;);
})
</code></pre><p>使用$q.all</p>
<pre><code>var p1 = $http.get(&apos;xxxx&apos;);
var p2 = $http.get(&apos;xxxx2&apos;);
$q.all(p1, p2).then(() =&gt;{
  console.log(&apos;两次请求都成功了！&apos;);
});
</code></pre><h2 id="4、-q源码分解"><a href="#4、-q源码分解" class="headerlink" title="4、$q源码分解"></a>4、$q源码分解</h2><pre><code>//Deferred定义
function Deferred() {
  this.promise = new Promise();
  //Necessary to support unbound execution :/
  this.resolve = simpleBind(this, this.resolve);
  this.reject = simpleBind(this, this.reject);
  this.notify = simpleBind(this, this.notify);
}

//函数柯里化
function simpleBind(context, fn) {
  return function(value) {
    fn.call(context, value);
  };
}
</code></pre><p>通过这种方式，就能将resolve，reject和promise关联起来了。既然我们最终要返回promise，那我们来看已看Promise的实现：</p>
<pre><code>function Promise() {
  this.$$state = { status: 0 };
}

extend(Promise.prototype, {
  then: function(onFulfilled, onRejected, progressBack) {
    if (isUndefined(onFulfilled) &amp;&amp; isUndefined(onRejected) &amp;&amp; isUndefined(progressBack)) {
      return this;
    }
    var result = new Deferred();

    this.$$state.pending = this.$$state.pending || [];
    this.$$state.pending.push([result, onFulfilled, onRejected, progressBack]);
    if (this.$$state.status &gt; 0) scheduleProcessQueue(this.$$state);

    return result.promise;
  },

  &quot;catch&quot;: function(callback) {
    return this.then(null, callback);
  },

  &quot;finally&quot;: function(callback, progressBack) {
    return this.then(function(value) {
      return handleCallback(value, true, callback);
    }, function(error) {
      return handleCallback(error, false, callback);
    }, progressBack);
  }
});
</code></pre><p>从这里很明显可以看出，catch就是一个语法糖，调用的还是then。finally也是一个语法糖，就是不关成功，还是失败，都会调用callback。那这个时候，我们主要关注的方法就放到then这个方法的实现上。</p>
<p>为了实现链式调用，在then方法内部，又实例化了Deferred对象，并返回Defferrd.promise。</p>
<p>接下来就来看处理过程：</p>
<pre><code>this.$$state.pending = this.$$state.pending || [];
this.$$state.pending.push([result, onFulfilled, onRejected, progressBack]);
if (this.$$state.status &gt; 0) scheduleProcessQueue(this.$$state);

extend(Deferred.prototype, {
  resolve: function(val) {
    if (this.promise.$$state.status) return;
    if (val === this.promise) {
      this.$$reject($qMinErr(
        &apos;qcycle&apos;,
        &quot;Expected promise to be resolved with value other than itself &apos;{0}&apos;&quot;,
        val));
    } else {
      this.$$resolve(val);
    }

  },

  $$resolve: function(val) {
    var then, fns;

    fns = callOnce(this, this.$$resolve, this.$$reject);
    try {
      if ((isObject(val) || isFunction(val))) then = val &amp;&amp; val.then;
      if (isFunction(then)) {
        this.promise.$$state.status = -1;
        then.call(val, fns[0], fns[1], this.notify);
      } else {
        this.promise.$$state.value = val;
        this.promise.$$state.status = 1;
        scheduleProcessQueue(this.promise.$$state);
      }
    } catch (e) {
      fns[1](e);
      exceptionHandler(e);
    }
  },

  reject: function(reason) {
    if (this.promise.$$state.status) return;
    this.$$reject(reason);
  },

  $$reject: function(reason) {
    this.promise.$$state.value = reason;
    this.promise.$$state.status = 2;
    scheduleProcessQueue(this.promise.$$state);
  },

  notify: function(progress) {
    var callbacks = this.promise.$$state.pending;

    if ((this.promise.$$state.status &lt;= 0) &amp;&amp; callbacks &amp;&amp; callbacks.length) {
      nextTick(function() {
        var callback, result;
        for (var i = 0, ii = callbacks.length; i &lt; ii; i++) {
          result = callbacks[i][0];
          callback = callbacks[i][3];
          try {
            result.notify(isFunction(callback) ? callback(progress) : progress);
          } catch (e) {
            exceptionHandler(e);
          }
        }
      });
    }
  }
});
</code></pre><p>在调用then的时候，就将锅中回调写到$$state的pending数组中，让defferred.resolve的时候就会调用Deferred的内部方法，调用我们传递的回调函数。</p>
<p><strong>源码分解实在是说不明白，后期再发一篇如何实现一个简易的Promise，希望能更简洁易懂</strong></p>
<h2 id="5、-了解更多"><a href="#5、-了解更多" class="headerlink" title="5、 了解更多"></a>5、 了解更多</h2><p><a href="http://liubin.github.io/promises-book/" target="_blank" rel="external">JavaScript Promise迷你书（中文版）</a></p>
<p><a href="https://docs.angularjs.org/api/ng/service/$q" target="_blank" rel="external">Angular $q api</a></p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular2一路向前/01_Angular2初体验/">
        01_Angular2初体验
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、关于Angular2"><a href="#0、关于Angular2" class="headerlink" title="0、关于Angular2"></a>0、关于Angular2</h2><p>Angualr2是前端最流行的MV*框架AngularJS的革命性更新版本，官网：<a href="https://angular.io/" target="_blank" rel="external">https://angular.io/</a>，号称一个框架统一移动版和桌面。</p>
<h2 id="1、背景"><a href="#1、背景" class="headerlink" title="1、背景"></a>1、背景</h2><p>将AngularJS升级为Angular2，是大势所趋。在之前，我们就必须要对Angular2有足够的了解。所以这一系列文章，希望从各个点将angular2分而破之。</p>
<p>另外，由于Angular2当前处于Beta阶段，所以代码的时效性不高。所以每篇都会注明相关版本。</p>
<p>Angular2推荐的开发语言是TypeScript <a href="http://www.typescriptlang.org/" target="_blank" rel="external">http://www.typescriptlang.org/</a>，所以我们这一系列文章也使用TypeScript开发（实际是使用JavaScript，半天没弄成功，丧气ing…）。</p>
<p>不要害怕TypeScript，因为TypeScript是ES6的超集，我们完全可以使用ES6的方式来编写TypeScript代码。对我们来说，仅仅是文件名后缀变化了。</p>
<h2 id="2、Angular2-Hello-World"><a href="#2、Angular2-Hello-World" class="headerlink" title="2、Angular2 Hello-World"></a>2、Angular2 Hello-World</h2><p>Angular2并不仅仅只有一个JS文件，要想成功运行Angular2，需要包含如下内容：</p>
<ol>
<li>systemjs –模块加载器</li>
<li>Rxjs   –对Js的扩展，至今不知道它是做什么的</li>
<li>angular2</li>
</ol>
<p>如果要支持IE，那么还需要</p>
<ol>
<li>es6-shim</li>
<li>systemjs 中的system-polyfills.js文件</li>
<li>angular2中的shims_for_IE.js文件</li>
</ol>
<p>接着就直接创建项目吧，结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;root folder&gt;</div><div class="line">  components/</div><div class="line">    hello_world.html</div><div class="line">    hello_world.ts</div><div class="line">  bootstrap.ts</div><div class="line">  index.html</div><div class="line">  package.json</div></pre></td></tr></table></figure>
<p>首先第一步，我们要通过npm安装我们的依赖项：<br><code>npm install angular2 rxjs systemjs es6-shim typescript --save</code></p>
<p>接着，实现我们的<code>index.html</code>内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Angular2 Hello World<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="comment">&lt;!-- Angular2组件标记 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">hello_world</span>&gt;</span><span class="tag">&lt;/<span class="name">hello_world</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="comment">&lt;!-- IE required polyfills --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/es6-shim/es6-shim.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/systemjs/dist/system-polyfills.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/angular2/es6/dev/src/testing/shims_for_IE.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- Compile TypeScript --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/typescript/lib/typescript.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- Angular2 required --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/systemjs/dist/system.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/angular2/bundles/angular2-polyfills.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/rxjs/bundles/Rx.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/angular2/bundles/angular2.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- startup app --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    System.config(&#123;</div><div class="line">      <span class="attr">transpiler</span>: <span class="string">'typescript'</span>,</div><div class="line">      <span class="attr">typescriptOptions</span>: &#123; <span class="attr">emitDecoratorMetadata</span>: <span class="literal">true</span> &#125;,</div><div class="line">      <span class="attr">packages</span>: &#123;<span class="string">'components'</span>: &#123;<span class="attr">defaultExtension</span>: <span class="string">'ts'</span>&#125;&#125; <span class="comment">//配置components目录下的请求，默认格式为ts</span></div><div class="line">    &#125;);</div><div class="line">    <span class="comment">//注意：此处import的时候，必须要指明后缀，因为我们是把bootstrap.ts放在index平级的，在System的config中没有配置默认扩展名</span></div><div class="line">    System.import(<span class="string">'bootstrap.ts'</span>).then(<span class="literal">null</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>));</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后是我们的<code>hello_world.html</code>和<code>hello_world.ts</code>，内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Angular2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line">My name is: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"username"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">Angular2: <span class="tag">&lt;<span class="name">span</span> *<span class="attr">ngIf</span>=<span class="string">"username"</span>&gt;</span>Hello, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component&#125; <span class="keyword">from</span> <span class="string">'angular2/core'</span>;</div><div class="line"></div><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'hello_world'</span>, <span class="comment">//此处指明了组件的标记，我们就可以使用&lt;hello_world&gt;&lt;/hello_world&gt;来使用这个组件了。</span></div><div class="line">  templateUrl: <span class="string">'components/hello_world.html'</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">//export的意思是导出这个组件，在使用的地方，就可以使用import &#123;xx&#125; from 'xxx'来获取到了。</span></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldComponent</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，是我们的<code>bootstrap.ts</code>入口JS：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;bootstrap&#125; <span class="keyword">from</span> <span class="string">'angular2/platform/browser'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;HelloWorldComponent&#125; <span class="keyword">from</span> <span class="string">'components/hello_world'</span>;</div><div class="line">bootstrap(HelloWorldComponent);</div></pre></td></tr></table></figure>
<p>通过<code>anywhere</code>启动静态服务器，就可以看到我们的页面了。</p>
<p><strong>But，理想很丰满，现实很骨感，为嘛不兼容IE11？？？</strong></p>
<p>错误提示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;&apos;Symbol&apos; is undefined&quot;</div></pre></td></tr></table></figure>
<p><strong>坑你没商量*！最终发现是Rx的版本必须用angular2提供的那个版本</strong></p>
<p>地址是：<a href="https://code.angularjs.org/2.0.0-beta.12/Rx.js" target="_blank" rel="external">https://code.angularjs.org/2.0.0-beta.12/Rx.js</a></p>
<p>所以把Rx.js文件替换下，就可以在IE11中跑起来了。</p>
<p><strong>另外，经测试，Angular2可兼容IE9及以上版本。</strong></p>
<h2 id="3、结尾"><a href="#3、结尾" class="headerlink" title="3、结尾"></a>3、结尾</h2><p><a href="https://github.com/hstarorg/HstarDemoProject/tree/master/angular2_demo/04" target="_blank" rel="external">Demo源码</a></p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular2一路向前/04_Angular2指令简析/">
        04_Angular2指令简析
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、Angular2指令"><a href="#0、Angular2指令" class="headerlink" title="0、Angular2指令"></a>0、Angular2指令</h2><p>在Angular1中，就已经有了指令的概念。Angular1中的指令用于实现可复用UI部件，也用于操作dom元素。</p>
<p>那么在Angular2中的指令是一样的东西么？</p>
<p>Angular2中有组件的概念，指令这个东西就变得更加纯粹。</p>
<p>Angular2的指令有三种：</p>
<ul>
<li>组件 </li>
<li>属性指令</li>
<li>结构指令</li>
</ul>
<p>组件是有模板的指令，是指令的中一个另类，因为它使用@Component来装饰，而不是@Directive。</p>
<p>属性指令用于改变现有元素的展现和行为，使用的时候它们看起来像是正常的HTML属性，所以称之为属性指令。如ngModel指令。</p>
<p>结构指令通过添加、删除和替换DOM树中的元素来改变布局，由于可以更改DOM结构，所以称之为结构指令。如ngIf，ngSwitch。</p>
<p>由于Angular2的API好不够稳定，书写该文时，采用的是Angular2 rc1（@angular rc.1）版本，其他版本请自行测试。</p>
<h2 id="1、属性指令"><a href="#1、属性指令" class="headerlink" title="1、属性指令"></a>1、属性指令</h2><p>接着，我们就一步步来实现一个属性指令 dynamicColor 。</p>
<p>首先，我们需要创建一个ts文件，然后把指令的骨架搭建起来。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码中，我们创建了一个dynamicColor指令。</p>
<p>接下来，我们来实现具体的功能，可以设置元素的背景色和前景色，并能实现事件通知。</p>
<p>要实现动态背景色和前景色，那我们需要额外附加两个属性bgColor和color。</p>
<p>要想在指令中获取这两个属性值，那么我们可以通过@Input方式或者是inputs属性，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  </div><div class="line">  <span class="meta">@Input</span>()</div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="meta">@Input</span>()</div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>或者是：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  <span class="comment">//注意，在之前的版本中，使用properties属性，而且，当前还可以使用。</span></div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么html中又应该如何传递值给指令呢？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>注意：在html元素的属性上，我们可以有两种写法。一种是直接书写属性，此时会把属性值原样传递给指令。第二种是使用[属性]，此时属性值应该是表达式（可以使用变量，判断等语句），传递给指令的是表达式的结果。</strong></p>
<p>我们又如何在后端查看这两个值呢？</p>
<p>直接在constructor中console？明确的说是不行的，因为constructor的代码会先于绑定执行。</p>
<p>这个时候，我们就需要借助指令的生命周期钩子。</p>
<p>指令的生命周期钩子有如下几个：</p>
<ol>
<li>ngOnInit –初始化时</li>
<li>ngOnChanges – 属性绑定之时（会有一次inputs属性绑定先于初始化）</li>
<li>ngDoCheck – 执行属性检查时</li>
<li>ngOnDestroy – 指令释放时</li>
</ol>
<p>了解了生命周期钩子，我们就可以通过ngOnInit来查看绑定好的属性值了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, OnInit&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit&#123;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，我们需要设置元素的background color和color样式，那么我们必须要拿到这个而元素的引用, 并在初始化之后进行绑定。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, OnInit, ElementRef&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>)&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span>&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当从元素上绑定的属性变化时，又应该从哪里获取到变更呢？这就需要借助生命周期里面的OnChanges函数，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, ElementRef, OnInit, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit, OnChanges&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>)&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span>&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnChanges()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor-change'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color-change'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于每次变化都会触发OnChanges，那么为了提高性能，我们可以在这里加入一个节流函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span> &#123;</div><div class="line">  clearTimeout(<span class="keyword">this</span>.timeoutId);</div><div class="line">  <span class="keyword">this</span>.timeoutId = setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;, <span class="number">500</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有了节流函数，我们就不太确定到底执行了几次更新操作了。这个时候，我们可以加入事件通知。这就涉及到指令的@Output了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Output</span>()</div><div class="line"><span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div></pre></td></tr></table></figure>
<p>也等同于：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">outputs: [</div><div class="line">  <span class="string">'updated: updated'</span></div><div class="line">]</div><div class="line"><span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div></pre></td></tr></table></figure>
<p><strong>注意：在之前的版本中，也可以用events属性来替代outputs，现在也还可以使用</strong></p>
<p>要对外发出通知，只需要使用如下代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.updated.emit(<span class="string">'updated'</span>);</div><div class="line"><span class="keyword">this</span>.updated.next(<span class="string">'updated2'</span>);</div></pre></td></tr></table></figure>
<p>HTML标签使用时，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span> (<span class="attr">updated</span>)=<span class="string">"notify($event)"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>至此，我们这个指令就已经完成了，所有代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//dynamicColor.directive.ts</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;Directive, Input, Output, ElementRef, EventEmitter, OnInit, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ],</div><div class="line">  outputs: [</div><div class="line">    <span class="string">'updated: updated'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit, OnChanges &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> timeoutId: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Output()</span></div><div class="line">  <span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter(); </div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>) &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span> &#123;</div><div class="line">    clearTimeout(<span class="keyword">this</span>.timeoutId); <span class="comment">//先清除已有的timeout</span></div><div class="line">    <span class="comment">//保证只执行最后一次。</span></div><div class="line">    <span class="keyword">this</span>.timeoutId = setTimeout(() =&gt; &#123;</div><div class="line">      <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">      <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">      <span class="keyword">this</span>.updated.emit(<span class="string">'updated'</span>);</div><div class="line">      <span class="keyword">this</span>.updated.next(<span class="string">'updated2'</span>);</div><div class="line">    &#125;, <span class="number">500</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnInit() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnChanges() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor-change'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color-change'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//test.html</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Dynamic Color Directive<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"testBgColor"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span> (<span class="attr">updated</span>)=<span class="string">"notify($event)"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test.component.ts</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TestComponent&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> testBgColor: <span class="built_in">string</span> = <span class="string">'blue'</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> testColor: <span class="built_in">string</span> = <span class="string">'red'</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> test(data)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'data'</span>, <span class="string">'my'</span>, data);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> notify(data)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'notify = '</span>, data);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>思考一下？我们还有没有更简单的方式实现以上的效果呢？</em></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, EventEmitter&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ],</div><div class="line">  outputs: [</div><div class="line">    <span class="string">'updated: updated'</span></div><div class="line">  ],</div><div class="line">  host: &#123;</div><div class="line">    <span class="string">'[style.backgroundColor]'</span>: <span class="string">'bgColor'</span>,</div><div class="line">    <span class="string">'[style.color]'</span>: <span class="string">'color'</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter(); </div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过host直接在元素上添加绑定。</p>
<h2 id="2、结构指令"><a href="#2、结构指令" class="headerlink" title="2、结构指令"></a>2、结构指令</h2><p>结构指令帮助我们修改dom结构，我们就简单实现一个templateInclude指令。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, Output, ElementRef, EventEmitter, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"><span class="keyword">import</span> &#123;Http&#125; from <span class="string">'@angular/http'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[templateInclude]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TemplateIncludeDirective <span class="keyword">implements</span> OnChanges &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="meta">@Input</span>(<span class="string">'templateInclude'</span>)</div><div class="line">  <span class="keyword">private</span> templateUrl: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="meta">@Output</span>()</div><div class="line">  <span class="keyword">private</span> loaded: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef, <span class="keyword">private</span> http: Http</span>) &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> _setTemplate() &#123;</div><div class="line">    <span class="keyword">this</span>.http.get(<span class="keyword">this</span>.templateUrl)</div><div class="line">      .subscribe(res =&gt; &#123;</div><div class="line">        <span class="keyword">this</span>.nativeElement.innerHTML = res.text();</div><div class="line">        <span class="keyword">this</span>.loaded.next(<span class="string">`<span class="subst">$&#123;this.templateUrl&#125;</span> loaded`</span>);</div><div class="line">      &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnChanges() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.templateUrl);</div><div class="line">    <span class="keyword">this</span>._setTemplate();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h2><p><strong>1、指令的元数据有很多属性可以使用</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">class</span> DirectiveMetadata &#123;</div><div class="line">  selector : <span class="built_in">string</span> <span class="comment">//指令使用的标记（选择器）</span></div><div class="line">  inputs : <span class="built_in">string</span>[] <span class="comment">//输入参数绑定</span></div><div class="line">  properties : <span class="built_in">string</span>[] <span class="comment">//属性绑定（过期，请使用inputs）</span></div><div class="line">  outputs : <span class="built_in">string</span>[] <span class="comment">//输出参数绑定</span></div><div class="line">  events : <span class="built_in">string</span>[] <span class="comment">//事件绑定（过期，请使用outputs）</span></div><div class="line">  host : &#123;[key: <span class="built_in">string</span>]: <span class="built_in">string</span>&#125; <span class="comment">//宿主元素属性设置</span></div><div class="line">  providers : <span class="built_in">any</span>[] <span class="comment">//服务绑定</span></div><div class="line">  bindings : <span class="built_in">any</span>[] <span class="comment">//服务绑定（过期，请使用providers）</span></div><div class="line">  exportAs : <span class="built_in">string</span> <span class="comment">//导出名称</span></div><div class="line">  queries : &#123;[key: <span class="built_in">string</span>]: <span class="built_in">any</span>&#125; <span class="comment">//用于指令依赖关系</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2、在使用指令（不仅仅是指令）进行绑定的时候，[]表示输入属性，()表示输出属性和事件</strong></p>
<p><strong>3、尽量使用统一的做法，用装饰器优于在属性上做绑定</strong></p>
<p><strong>4、在编写指令（不仅限于指令）时，将class中内容按照特定顺序进行排列，推荐顺序如下（个人建议，仅供参考）：</strong></p>
<ol>
<li>私有变量</li>
<li>共有变量</li>
<li>@Input变量</li>
<li>@Output变量</li>
<li>构造函数</li>
<li>私有方法（建议下划线开头）</li>
<li>公有方法</li>
<li>生命周期钩子方法</li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular2一路向前/05_Angular2组件简析/">
        05_Angular2组件简析
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、Angular2组件"><a href="#0、Angular2组件" class="headerlink" title="0、Angular2组件"></a>0、Angular2组件</h2><p><strong>注：由于Angular2的API好不够稳定，书写该文时，采用的是Angular2 rc1（@angular rc.1）版本，其他版本请自行测试。</strong></p>
<p>在上篇中，我们已经讲到了指令，这篇呢，我们一起来看看Angular2组件是怎么一回事。</p>
<p>首先，组件也是指令，组件是一种有模板（内嵌视图）的特殊指令。</p>
<p>从元数据<a href="https://github.com/angular/angular/blob/2.0.0-rc.1/modules/%40angular/core/src/metadata/directives.ts" target="_blank" rel="external">指令源代码</a>中也可以看出组件与指令的关系：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> ComponentMetadata extends DirectiveMetadata &#123;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>相比 <code>Directive</code>, <code>Component</code> 新增了一些属性，如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  changeDetection : ChangeDetectionStrategy; 定义变化检测类型</div><div class="line">  viewProviders: <span class="built_in">any</span>[]; 用于在组件中注入特定的<span class="keyword">class</span>。一般是实体类</div><div class="line">  moduleId: <span class="built_in">string</span>; 定义主键的ID</div><div class="line">  templateUrl: <span class="built_in">string</span>; 如ng1，外部模板地址</div><div class="line">  template: <span class="built_in">string</span>; 如ng1，内嵌模板内容</div><div class="line">  styleUrls: <span class="built_in">string</span>[]; 外部样式表文件</div><div class="line">  styles: <span class="built_in">string</span>[]; 内嵌样式</div><div class="line">  directives: <span class="built_in">Array</span>&lt;Type | <span class="built_in">any</span>[]&gt;; 使用到的指令</div><div class="line">  pipes: <span class="built_in">Array</span>&lt;Type | <span class="built_in">any</span>[]&gt;; 使用到的管道</div><div class="line">  encapsulation: ViewEncapsulation  封装视图的类型</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1、组件生命周期"><a href="#1、组件生命周期" class="headerlink" title="1、组件生命周期"></a>1、组件生命周期</h2><p>既然组件也是指令，那么指令所拥有的四大阶段组件也同样拥有。</p>
<p>而且，由于组件带有视图，还多了几个和视图相关的生命周期阶段。如下：</p>
<ol>
<li>ngAfterContentInit 组件内容渲染到页面之后触发</li>
<li>ngAfterContentChecked 检查组件内容绑定数据后触发</li>
<li>ngAfterViewInit 创建组件视图之后触发</li>
<li>ngAfterViewChecked 检查组件视图绑定数据后触发</li>
</ol>
<p>它们的执行顺序也和以上顺序一致。</p>
<h2 id="2、整一个组件试试？"><a href="#2、整一个组件试试？" class="headerlink" title="2、整一个组件试试？"></a>2、整一个组件试试？</h2><p>接下来，我们就简单实现一个组件 <code>TodoList</code> 来实验一下以上的知识点。</p>
<p>首先，搭建好一个简单的架子，如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Component</span>(&#123;</div><div class="line">  selector: <span class="string">'todo-list'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TodoListComponent&#123;</div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用组件装饰器 <code>Component</code> 来定义一个组件，注意其中 <code>selector</code> 属性和 <code>Directive</code> 中的写法不一样了。</p>
<p>组件必须以标签的方式存在，所以 selector 属性值仅仅只需要写标签名就可以了，不再需要其他特别的符号了。 </p>
<p>组件和指令最大的差别就在于模板，所以我们接下来添加上模板代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Component&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Component</span>(&#123;</div><div class="line">  selector: <span class="string">'todo-list'</span>,</div><div class="line">  template: <span class="string">`</span></div><div class="line">&lt;div class="todo-list"&gt;</div><div class="line">  &lt;h1&gt;Todo List&lt;/li&gt;</div><div class="line">  &lt;ul&gt;</div><div class="line">    &lt;li&gt;&lt;/li&gt;</div><div class="line">  &lt;/ul&gt;</div><div class="line">&lt;/div&gt; </div><div class="line">  `</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TodoListComponent&#123;</div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上，一个简单的模板就搞好了。这里需要注意 <code>templateUrl</code> 和 <code>template</code> 是互斥的两个属性。一般来说只选择一个赋值，如果两者都存在，那么会采用 <code>tempalte</code> 的值。</p>
<p>模板有了，我们就来点业务逻辑：</p>
<p>先假设Todo有三个状态：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> TodoStatus &#123;</div><div class="line">  Open,</div><div class="line">  Processing,</div><div class="line">  Closed</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在来定义Todo的实体类：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Todo &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> name: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> description: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> status: TodoStatus;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, status: TodoStatus, description?: <span class="built_in">string</span></span>) &#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.status = status;</div><div class="line">    <span class="keyword">this</span>.description = description || <span class="string">''</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接着来实现一个组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(&#123;</div><div class="line">  selector: <span class="string">'todo-list'</span>,</div><div class="line">  template: <span class="built_in">require</span>(<span class="string">'./todo-list.component.html'</span>)</div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TodoList &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> todos: <span class="built_in">Array</span>&lt;Todo&gt;;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> todo: &#123; name: <span class="built_in">string</span>, desc: <span class="built_in">string</span> &#125; = &#123; name: <span class="string">''</span>, desc: <span class="string">''</span> &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</div><div class="line">    <span class="keyword">this</span>.todos = [];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  addTodo() &#123;</div><div class="line">    <span class="keyword">this</span>.todos.push(<span class="keyword">new</span> Todo(<span class="keyword">this</span>.todo.name, TodoStatus.Open, <span class="keyword">this</span>.todo.desc));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个时候，HTML页面内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">"todos.length === 0"</span>&gt;</span>No todos.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"todo-list"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let todo of todos"</span>&gt;</span></div><div class="line">    &#123;&#123;todo.name&#125;&#125; - &#123;&#123;todo.description&#125;&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"todo-edit"</span>&gt;</span></div><div class="line">  Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"todo.name"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  Description: <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"3"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"todo.desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">"addTodo()"</span>&gt;</span>Add Todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>功能做好了，我们得给它来点样式美化。</p>
<p>此时我们仅仅需要实现一点样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.todo-list</span>&#123;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.todo-list</span> <span class="selector-tag">li</span>&#123;</div><div class="line">  <span class="attribute">list-style</span>: none;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在组件装饰器中申明就可以了：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(&#123;</div><div class="line">  selector: <span class="string">'todo-list'</span>,</div><div class="line">  template: <span class="built_in">require</span>(<span class="string">'./todo-list.component.html'</span>),</div><div class="line">  styles : [<span class="built_in">require</span>(<span class="string">'./todo-list.component.css'</span>)]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>至此，一个简单的可以添加todo的todo-list就已经完成了。</p>
<p><strong>注意：注入@Input，@Output之类的和Directive都是一样的，此处就不再演示了。</strong></p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Angular2一路向前/03_Angular2的那些Decorator/">
        03_Angular2的那些Decorator
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、Decorator"><a href="#0、Decorator" class="headerlink" title="0、Decorator"></a>0、Decorator</h2><p><code>Decorator</code> 是ECMAScript中建议的标准，使得我们可以在设计时对类和属性进行注解和修改。</p>
<h2 id="1、Angular2的Decorator"><a href="#1、Angular2的Decorator" class="headerlink" title="1、Angular2的Decorator"></a>1、Angular2的Decorator</h2><p>在Angular2的早期版本（使用AtScript）中，我们是使用Annotation（注解），它以一个声明的方式将元数据添加到代码中。</p>
<p>在后来迁移到TypeScript的时候，我们可以使用 Decorator 和 Annotation 。作为使用者来说，使用 Decorator 和 Annotation 几乎是一样的，唯一的区别是我们没有去控制 Annotation 如何将元数据添加到我们的代码中，而 Decorator 是对 这些 Annotation 的最终实现。</p>
<p>从长远看，我们更应该多关注 Decorator ，因为它才是真正的标准建议。</p>
<h2 id="2、Angular2的那些Decorator"><a href="#2、Angular2的那些Decorator" class="headerlink" title="2、Angular2的那些Decorator"></a>2、Angular2的那些Decorator</h2><h3 id="2-1、In-angular2-core"><a href="#2-1、In-angular2-core" class="headerlink" title="2.1、In angular2/core"></a>2.1、In angular2/core</h3><h4 id="2-1-1、Component"><a href="#2-1-1、Component" class="headerlink" title="2.1.1、Component"></a>2.1.1、Component</h4><p><code>Component</code> 用于声明可重用的UI构建模块（组件），每个 Angular component都要求有一个 <code>@Component</code> 注解，它指定了组件何时被实例化，哪些属性和 hostListeners 被绑定。</p>
<p>当组件实现（implements）了一些生命周期钩子（lifecycle-hooks），那么将在特定的时间点访问这些钩子的回调函数。</p>
<p><strong>如何使用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@Component(&#123;</div><div class="line">  <span class="attr">selector</span>: <span class="string">'demo'</span>, <span class="comment">// 配置选择器</span></div><div class="line">  inputs: [],</div><div class="line">  <span class="attr">outputs</span>: [],</div><div class="line">  <span class="attr">properties</span>: [],</div><div class="line">  <span class="attr">events</span>: [],</div><div class="line">  <span class="attr">host</span>: &#123;&#125;,</div><div class="line">  <span class="attr">providers</span>: [], <span class="comment">// 设定所依赖的Providers（ng1中的service，provider，factory）</span></div><div class="line">  exportAs: <span class="string">''</span>,</div><div class="line">  <span class="attr">moduleId</span>: <span class="string">''</span>,  <span class="comment">//设定模块ID</span></div><div class="line">  viewProviders: [],</div><div class="line">  <span class="attr">queries</span>: &#123;&#125;,</div><div class="line">  <span class="comment">//changeDetection</span></div><div class="line">  templateUrl : <span class="string">''</span>, <span class="comment">// 指定模板文件URL，和template冲突</span></div><div class="line">  template: <span class="string">'Hello &#123;&#123;name&#125;&#125;!'</span>, <span class="comment">//指定模板内容，和templateUrl冲突</span></div><div class="line">  styleUrls: [], <span class="comment">// 设定组件依赖的样式表文件</span></div><div class="line">  styles : [],  <span class="comment">//设定组件依赖的样式</span></div><div class="line">  directives: [], <span class="comment">//设定所依赖的Directives（ng1中的directives）</span></div><div class="line">  pipes: [] <span class="comment">//设定所依赖的Pipes（ng1中的filter）</span></div><div class="line">  <span class="comment">//encapsulation</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</div><div class="line">  private name: string = <span class="string">'World'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注：从继承关系来看，Component extends Directive。</strong></p>
<h4 id="2-1-2、Directive"><a href="#2-1-2、Directive" class="headerlink" title="2.1.2、Directive"></a>2.1.2、Directive</h4><p><code>Directive</code> 允许你在DOM元素上附加行为。如果指令带有内嵌视图，那么就成为了组件。</p>
<p>指令同样也有生命周期钩子。使用方式和 Component 雷同。</p>
<p>指令允许多种注入方式来实例化：</p>
<p>1、无注入 – 该指令没有外部依赖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 空构造，无注入</span></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2、组件级别的注入 – 该指令依赖一些外部服务</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;User&#125; <span class="keyword">from</span> <span class="string">'xxx'</span>;</div><div class="line"></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(user: User) &#123; <span class="comment">//依赖外部服务</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3、注入当前元素的其它指令 –该指令依赖当前元素上的其他指令，搭配其他指令一起使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;User&#125; <span class="keyword">from</span> <span class="string">'xxx'</span>;</div><div class="line"></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(depDirective: DepDirective) &#123; <span class="comment">//依赖当前元素上的其他指令</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-directive</span> <span class="attr">dep-directive</span>&gt;</span></div><div class="line">  </div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>4、注入当前元素、父元素、更上层的父元素上的指令 –该指令依赖上层元素的指令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;User&#125; <span class="keyword">from</span> <span class="string">'xxx'</span>;</div><div class="line"></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="comment">//要使用 @Host()</span></div><div class="line">  <span class="keyword">constructor</span>(@Host() depDirective: DepDirective) &#123; <span class="comment">//可以依赖父辈元素上的指令</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dep-directive</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">my-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>5、注入直接子集集合元素的的指令 –该指令依赖直接子元素的指令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;User&#125; <span class="keyword">from</span> <span class="string">'xxx'</span>;</div><div class="line"></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="comment">//使用 @Query&lt;Type&gt; ，依赖直接子元素上的指令</span></div><div class="line">  <span class="keyword">constructor</span>(@Query(DepDirective) depDirective: QueryList&lt;DepDirective&gt;) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-directive</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">dep-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">dep-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>6、注入后代集合元素的指令 –该指令依赖后代元素的指令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;User&#125; <span class="keyword">from</span> <span class="string">'xxx'</span>;</div><div class="line"></div><div class="line">@Directive(&#123; <span class="attr">selector</span>: <span class="string">'[my-directive]'</span> &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDirective</span> </span>&#123;</div><div class="line">  <span class="comment">//使用 @Query&lt;Type&gt; ，依赖直接子元素上的指令</span></div><div class="line">  <span class="keyword">constructor</span>(@Query(DepDirective, &#123;descendants: <span class="literal">true</span>&#125;) depDirective: QueryList&lt;DepDirective&gt;) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-directive</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">dep-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">dep-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>7、可选注入 –该指令的依赖是可选的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@Directive(&#123; selector: &apos;[my-directive]&apos; &#125;)</div><div class="line">class MyDirective &#123;</div><div class="line">  // 使用 @Optional 标记，依赖是可选的。 </div><div class="line">  constructor(@Optional() depDirective:DepDirective) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注：以上多种注入方式也适用于 Component 。</strong></p>
<h4 id="2-1-3、Injectable"><a href="#2-1-3、Injectable" class="headerlink" title="2.1.3、Injectable"></a>2.1.3、Injectable</h4><p><code>Injectable</code> 允许使用注入。在编写组件/指令时，如果有注入，那么就需要将指令/组件标记为可注入的。</p>
<h4 id="2-1-4、Pipe"><a href="#2-1-4、Pipe" class="headerlink" title="2.1.4、Pipe"></a>2.1.4、Pipe</h4><p><code>Pipe</code> 允许我们定义管道方法，实现ng1中filter类似的功能。</p>
<p>如何编写一个Pipe？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Pipe(&#123;<span class="attr">name</span>: <span class="string">'lowercase'</span>&#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lowercase</span> </span>&#123;</div><div class="line">  transform(v: string, <span class="attr">args</span>: any[]) &#123; <span class="keyword">return</span> v.toLowerCase(); &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-2、In-angular2-router"><a href="#2-2、In-angular2-router" class="headerlink" title="2.2、In angular2/router"></a>2.2、In angular2/router</h3><h4 id="2-2-1、CanActivate"><a href="#2-2-1、CanActivate" class="headerlink" title="2.2.1、CanActivate"></a>2.2.1、CanActivate</h4><p><code>CanActivate</code> 允许我们在使用路由时，检查组件的权限，来确定是否可以使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Component(&#123;<span class="attr">selector</span>: <span class="string">'control-panel-cmp'</span>, <span class="attr">template</span>: <span class="string">`&lt;div&gt;Settings: ...&lt;/div&gt;`</span>&#125;)</div><div class="line">@CanActivate(checkIfWeHavePermission)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ControlPanelCmp</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-2、RouteConfig"><a href="#2-2-2、RouteConfig" class="headerlink" title="2.2.2、RouteConfig"></a>2.2.2、RouteConfig</h4><p><code>RouteConfig</code> 用于我们配置路由。</p>
<p>使用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Component(&#123;</div><div class="line">  selector: &apos;dojo-app&apos;,</div><div class="line">  moduleId: module.id,</div><div class="line">  templateUrl: &apos;app.html&apos;,</div><div class="line">  styleUrls: [&apos;app.css&apos;],</div><div class="line">  directives: [ROUTER_DIRECTIVES, HeaderComponent]</div><div class="line">&#125;)</div><div class="line"></div><div class="line">@RouteConfig([</div><div class="line">  &#123;path: &apos;/&apos;, name: &apos;Home&apos;, component: HomeComponent&#125;,</div><div class="line">  &#123;path: &apos;/about&apos;, name: &apos;About&apos;, component: AboutComponent&#125;</div><div class="line">])</div><div class="line"></div><div class="line">export class AppComponent&#123;</div><div class="line">  constructor() &#123;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、参考"><a href="#3、参考" class="headerlink" title="3、参考"></a>3、参考</h2><ol>
<li><a href="https://angular.io/docs/ts/latest/api/index.html#!?apiType=Decorator" target="_blank" rel="external">https://angular.io/docs/ts/latest/api/index.html#!?apiType=Decorator</a></li>
<li><a href="https://angular.io/docs/ts/latest/api/index.html#!?apiFilter=metadata" target="_blank" rel="external">https://angular.io/docs/ts/latest/api/index.html#!?apiFilter=metadata</a></li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
</section>


  <nav id="page-nav">
    
    <a class="prev" rel="prev" href="/blog/page/7/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/blog/page/9/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>
  

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='https://avatars1.githubusercontent.com/u/4043284?v=3&amp;s=460' />

<div class='header'>Jay.M.Hu</div>
<div class='content'>
<div></div>
</div>
</section>

  <section class='m_widget friendly-links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://humin.cnblogs.com/">
            <div class='name'>幻天芒 - 博客园</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
</div>
</section>

  


      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/hstarorg" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/blog/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/blog/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/blog/js/search.js"></script>
<script src="/blog/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
