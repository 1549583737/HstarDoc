<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>04_Angular2指令简析 | 幻☆精灵的Blog</title>
  <meta name="description" content="幻☆精灵的Blog站点" />
  <meta name="keywords" content="幻精灵" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/blog/images/favicon.ico">
  <link rel="alternate" href="/blog/atom.xml" title="幻☆精灵的Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0、Angular2指令在Angular1中，就已经有了指令的概念。Angular1中的指令用于实现可复用UI部件，也用于操作dom元素。
那么在Angular2中的指令是一样的东西么？
Angular2中有组件的概念，指令这个东西就变得更加纯粹。
Angular2的指令有三种：

组件 
属性指令
结构指令

组件是有模板的指令，是指令的中一个另类，因为它使用@Component来装饰，而不是@">
<meta property="og:type" content="article">
<meta property="og:title" content="04_Angular2指令简析">
<meta property="og:url" content="http://hstarorg.github.io/blog/2017/02/21/Angular2一路向前/04_Angular2指令简析/index.html">
<meta property="og:site_name" content="幻☆精灵的Blog">
<meta property="og:description" content="0、Angular2指令在Angular1中，就已经有了指令的概念。Angular1中的指令用于实现可复用UI部件，也用于操作dom元素。
那么在Angular2中的指令是一样的东西么？
Angular2中有组件的概念，指令这个东西就变得更加纯粹。
Angular2的指令有三种：

组件 
属性指令
结构指令

组件是有模板的指令，是指令的中一个另类，因为它使用@Component来装饰，而不是@">
<meta property="og:updated_time" content="2017-02-21T07:07:31.734Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="04_Angular2指令简析">
<meta name="twitter:description" content="0、Angular2指令在Angular1中，就已经有了指令的概念。Angular1中的指令用于实现可复用UI部件，也用于操作dom元素。
那么在Angular2中的指令是一样的东西么？
Angular2中有组件的概念，指令这个东西就变得更加纯粹。
Angular2的指令有三种：

组件 
属性指令
结构指令

组件是有模板的指令，是指令的中一个另类，因为它使用@Component来装饰，而不是@">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/blog/style.css">
  
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
		<div class="wrapper container">
			<a class="logo flat-box" href='/blog/' >
				幻☆精灵的Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/blog/'>
								首页
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/blog/archives'>
								归档
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/blog/about'>
								关于我
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu"></span></a></li>
			</ul>
		</div>
		<aside class="menu-phone">
			<nav>
				
					<a href="/blog/" class="nav-home nav">
						首页
					</a>
				
					<a href="/blog/archives" class="nav-archives nav">
						归档
					</a>
				
					<a href="/blog/about" class="nav-about nav">
						关于我
					</a>
				
			</nav>
		</aside>
</header>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container'>
      <div class='l_main'>
        <article id="post-Angular2一路向前/04_Angular2指令简析"
  class="post white-box article-type-post"
  itemscope itemprop="blogPost">
	<section class='meta'>
	<h2 class="title">
  	<a href="/blog/2017/02/21/Angular2一路向前/04_Angular2指令简析/">
    	04_Angular2指令简析
    </a>
  </h2>
	<time>
	  Feb 21, 2017
	</time>
	
	</section>
	
		<section class="tog"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0、Angular2指令"><span class="toc-number">1.</span> <span class="toc-text">0、Angular2指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、属性指令"><span class="toc-number">2.</span> <span class="toc-text">1、属性指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、结构指令"><span class="toc-number">3.</span> <span class="toc-text">2、结构指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、总结"><span class="toc-number">4.</span> <span class="toc-text">3、总结</span></a></li></ol></section>
	
	<section class="article typo">
  	<div class="article-entry" itemprop="articleBody">
    	<h2 id="0、Angular2指令"><a href="#0、Angular2指令" class="headerlink" title="0、Angular2指令"></a>0、Angular2指令</h2><p>在Angular1中，就已经有了指令的概念。Angular1中的指令用于实现可复用UI部件，也用于操作dom元素。</p>
<p>那么在Angular2中的指令是一样的东西么？</p>
<p>Angular2中有组件的概念，指令这个东西就变得更加纯粹。</p>
<p>Angular2的指令有三种：</p>
<ul>
<li>组件 </li>
<li>属性指令</li>
<li>结构指令</li>
</ul>
<p>组件是有模板的指令，是指令的中一个另类，因为它使用@Component来装饰，而不是@Directive。</p>
<p>属性指令用于改变现有元素的展现和行为，使用的时候它们看起来像是正常的HTML属性，所以称之为属性指令。如ngModel指令。</p>
<p>结构指令通过添加、删除和替换DOM树中的元素来改变布局，由于可以更改DOM结构，所以称之为结构指令。如ngIf，ngSwitch。</p>
<p>由于Angular2的API好不够稳定，书写该文时，采用的是Angular2 rc1（@angular rc.1）版本，其他版本请自行测试。</p>
<h2 id="1、属性指令"><a href="#1、属性指令" class="headerlink" title="1、属性指令"></a>1、属性指令</h2><p>接着，我们就一步步来实现一个属性指令 dynamicColor 。</p>
<p>首先，我们需要创建一个ts文件，然后把指令的骨架搭建起来。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码中，我们创建了一个dynamicColor指令。</p>
<p>接下来，我们来实现具体的功能，可以设置元素的背景色和前景色，并能实现事件通知。</p>
<p>要实现动态背景色和前景色，那我们需要额外附加两个属性bgColor和color。</p>
<p>要想在指令中获取这两个属性值，那么我们可以通过@Input方式或者是inputs属性，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  </div><div class="line">  <span class="meta">@Input</span>()</div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="meta">@Input</span>()</div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>或者是：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  <span class="comment">//注意，在之前的版本中，使用properties属性，而且，当前还可以使用。</span></div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective&#123;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么html中又应该如何传递值给指令呢？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>注意：在html元素的属性上，我们可以有两种写法。一种是直接书写属性，此时会把属性值原样传递给指令。第二种是使用[属性]，此时属性值应该是表达式（可以使用变量，判断等语句），传递给指令的是表达式的结果。</strong></p>
<p>我们又如何在后端查看这两个值呢？</p>
<p>直接在constructor中console？明确的说是不行的，因为constructor的代码会先于绑定执行。</p>
<p>这个时候，我们就需要借助指令的生命周期钩子。</p>
<p>指令的生命周期钩子有如下几个：</p>
<ol>
<li>ngOnInit –初始化时</li>
<li>ngOnChanges – 属性绑定之时（会有一次inputs属性绑定先于初始化）</li>
<li>ngDoCheck – 执行属性检查时</li>
<li>ngOnDestroy – 指令释放时</li>
</ol>
<p>了解了生命周期钩子，我们就可以通过ngOnInit来查看绑定好的属性值了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, OnInit&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit&#123;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，我们需要设置元素的background color和color样式，那么我们必须要拿到这个而元素的引用, 并在初始化之后进行绑定。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, OnInit, ElementRef&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>)&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span>&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当从元素上绑定的属性变化时，又应该从哪里获取到变更呢？这就需要借助生命周期里面的OnChanges函数，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, ElementRef, OnInit, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit, OnChanges&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>)&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span>&#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnInit()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  ngOnChanges()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor-change'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color-change'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于每次变化都会触发OnChanges，那么为了提高性能，我们可以在这里加入一个节流函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span> &#123;</div><div class="line">  clearTimeout(<span class="keyword">this</span>.timeoutId);</div><div class="line">  <span class="keyword">this</span>.timeoutId = setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">    <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">  &#125;, <span class="number">500</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有了节流函数，我们就不太确定到底执行了几次更新操作了。这个时候，我们可以加入事件通知。这就涉及到指令的@Output了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Output</span>()</div><div class="line"><span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div></pre></td></tr></table></figure>
<p>也等同于：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">outputs: [</div><div class="line">  <span class="string">'updated: updated'</span></div><div class="line">]</div><div class="line"><span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div></pre></td></tr></table></figure>
<p><strong>注意：在之前的版本中，也可以用events属性来替代outputs，现在也还可以使用</strong></p>
<p>要对外发出通知，只需要使用如下代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.updated.emit(<span class="string">'updated'</span>);</div><div class="line"><span class="keyword">this</span>.updated.next(<span class="string">'updated2'</span>);</div></pre></td></tr></table></figure>
<p>HTML标签使用时，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span> (<span class="attr">updated</span>)=<span class="string">"notify($event)"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>至此，我们这个指令就已经完成了，所有代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//dynamicColor.directive.ts</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;Directive, Input, Output, ElementRef, EventEmitter, OnInit, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ],</div><div class="line">  outputs: [</div><div class="line">    <span class="string">'updated: updated'</span></div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective <span class="keyword">implements</span> OnInit, OnChanges &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> timeoutId: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="comment">// @Input()</span></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// @Output()</span></div><div class="line">  <span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter(); </div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef</span>) &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> _setElementStyle(): <span class="built_in">void</span> &#123;</div><div class="line">    clearTimeout(<span class="keyword">this</span>.timeoutId); <span class="comment">//先清除已有的timeout</span></div><div class="line">    <span class="comment">//保证只执行最后一次。</span></div><div class="line">    <span class="keyword">this</span>.timeoutId = setTimeout(() =&gt; &#123;</div><div class="line">      <span class="keyword">this</span>.nativeElement.style.backgroundColor = <span class="keyword">this</span>.bgColor;</div><div class="line">      <span class="keyword">this</span>.nativeElement.style.color = <span class="keyword">this</span>.color;</div><div class="line">      <span class="keyword">this</span>.updated.emit(<span class="string">'updated'</span>);</div><div class="line">      <span class="keyword">this</span>.updated.next(<span class="string">'updated2'</span>);</div><div class="line">    &#125;, <span class="number">500</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnInit() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnChanges() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bgColor-change'</span>, <span class="keyword">this</span>.bgColor);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'color-change'</span>, <span class="keyword">this</span>.color);</div><div class="line">    <span class="keyword">this</span>._setElementStyle();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//test.html</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Dynamic Color Directive<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"testBgColor"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span> <span class="attr">dynamicColor</span> [<span class="attr">bgColor</span>]=<span class="string">"testBgColor"</span> [<span class="attr">color</span>]=<span class="string">"testColor"</span> (<span class="attr">updated</span>)=<span class="string">"notify($event)"</span>&gt;</span></div><div class="line">  Hi!</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test.component.ts</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TestComponent&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> testBgColor: <span class="built_in">string</span> = <span class="string">'blue'</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> testColor: <span class="built_in">string</span> = <span class="string">'red'</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>)&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> test(data)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'data'</span>, <span class="string">'my'</span>, data);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> notify(data)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'notify = '</span>, data);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>思考一下？我们还有没有更简单的方式实现以上的效果呢？</em></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, EventEmitter&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[dynamicColor]'</span>,</div><div class="line">  inputs: [</div><div class="line">    <span class="string">'bgColor: bgColor'</span>, <span class="comment">//字符串以冒号隔开，前者是DynamicColorDirective的属性，后者的html元素的属性</span></div><div class="line">    <span class="string">'color: color'</span></div><div class="line">  ],</div><div class="line">  outputs: [</div><div class="line">    <span class="string">'updated: updated'</span></div><div class="line">  ],</div><div class="line">  host: &#123;</div><div class="line">    <span class="string">'[style.backgroundColor]'</span>: <span class="string">'bgColor'</span>,</div><div class="line">    <span class="string">'[style.color]'</span>: <span class="string">'color'</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> DynamicColorDirective &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> bgColor: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> color: <span class="built_in">string</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">private</span> updated: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter(); </div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过host直接在元素上添加绑定。</p>
<h2 id="2、结构指令"><a href="#2、结构指令" class="headerlink" title="2、结构指令"></a>2、结构指令</h2><p>结构指令帮助我们修改dom结构，我们就简单实现一个templateInclude指令。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;Directive, Input, Output, ElementRef, EventEmitter, OnChanges&#125; from <span class="string">'@angular/core'</span>;</div><div class="line"><span class="keyword">import</span> &#123;Http&#125; from <span class="string">'@angular/http'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Directive</span>(&#123;</div><div class="line">  selector: <span class="string">'[templateInclude]'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> TemplateIncludeDirective <span class="keyword">implements</span> OnChanges &#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> nativeElement: <span class="built_in">any</span>;</div><div class="line"></div><div class="line">  <span class="meta">@Input</span>(<span class="string">'templateInclude'</span>)</div><div class="line">  <span class="keyword">private</span> templateUrl: <span class="built_in">string</span>;</div><div class="line"></div><div class="line">  <span class="meta">@Output</span>()</div><div class="line">  <span class="keyword">private</span> loaded: EventEmitter&lt;<span class="built_in">any</span>&gt; = <span class="keyword">new</span> EventEmitter();</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params">el: ElementRef, <span class="keyword">private</span> http: Http</span>) &#123;</div><div class="line">    <span class="keyword">this</span>.nativeElement = el.nativeElement;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> _setTemplate() &#123;</div><div class="line">    <span class="keyword">this</span>.http.get(<span class="keyword">this</span>.templateUrl)</div><div class="line">      .subscribe(res =&gt; &#123;</div><div class="line">        <span class="keyword">this</span>.nativeElement.innerHTML = res.text();</div><div class="line">        <span class="keyword">this</span>.loaded.next(<span class="string">`<span class="subst">$&#123;this.templateUrl&#125;</span> loaded`</span>);</div><div class="line">      &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ngOnChanges() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.templateUrl);</div><div class="line">    <span class="keyword">this</span>._setTemplate();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h2><p><strong>1、指令的元数据有很多属性可以使用</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">class</span> DirectiveMetadata &#123;</div><div class="line">  selector : <span class="built_in">string</span> <span class="comment">//指令使用的标记（选择器）</span></div><div class="line">  inputs : <span class="built_in">string</span>[] <span class="comment">//输入参数绑定</span></div><div class="line">  properties : <span class="built_in">string</span>[] <span class="comment">//属性绑定（过期，请使用inputs）</span></div><div class="line">  outputs : <span class="built_in">string</span>[] <span class="comment">//输出参数绑定</span></div><div class="line">  events : <span class="built_in">string</span>[] <span class="comment">//事件绑定（过期，请使用outputs）</span></div><div class="line">  host : &#123;[key: <span class="built_in">string</span>]: <span class="built_in">string</span>&#125; <span class="comment">//宿主元素属性设置</span></div><div class="line">  providers : <span class="built_in">any</span>[] <span class="comment">//服务绑定</span></div><div class="line">  bindings : <span class="built_in">any</span>[] <span class="comment">//服务绑定（过期，请使用providers）</span></div><div class="line">  exportAs : <span class="built_in">string</span> <span class="comment">//导出名称</span></div><div class="line">  queries : &#123;[key: <span class="built_in">string</span>]: <span class="built_in">any</span>&#125; <span class="comment">//用于指令依赖关系</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2、在使用指令（不仅仅是指令）进行绑定的时候，[]表示输入属性，()表示输出属性和事件</strong></p>
<p><strong>3、尽量使用统一的做法，用装饰器优于在属性上做绑定</strong></p>
<p><strong>4、在编写指令（不仅限于指令）时，将class中内容按照特定顺序进行排列，推荐顺序如下（个人建议，仅供参考）：</strong></p>
<ol>
<li>私有变量</li>
<li>共有变量</li>
<li>@Input变量</li>
<li>@Output变量</li>
<li>构造函数</li>
<li>私有方法（建议下划线开头）</li>
<li>公有方法</li>
<li>生命周期钩子方法</li>
</ol>

  	</div>
	  
	</section>
	
</article>

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='https://avatars1.githubusercontent.com/u/4043284?v=3&amp;s=460' />

<div class='header'>Jay.M.Hu</div>
<div class='content'>
<div></div>
</div>
</section>

  <section class='m_widget friendly-links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://humin.cnblogs.com/">
            <div class='name'>幻天芒 - 博客园</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
</div>
</section>

  


      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/hstarorg" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/blog/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/blog/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/blog/js/search.js"></script>
<script src="/blog/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
