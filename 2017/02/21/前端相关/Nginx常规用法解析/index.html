<!DOCTYPE html><html class="han-init" lang="zh-Hant"><head><meta name="author" content="Jay.M.Hu"><meta name="description" itemprop="description" content="0、Nginx简介Nginx 是时下最流行的静态Web服务器之一，使用它能快速的托管一个web站点。
当然，它的功能并不仅限于此，负载均衡，反向代理，它都非常拿手。
然而，要使用它，就不得不提到它的配置文件。本文就大致来了解下 Nginx 常规配置。
注意：由于环境因素，该文所有测试均在Win10上"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Nginx常规用法解析 · Love life, love coding~</title><link rel="stylesheet" type="text/css" href="/blog/font/fantasque_sans_mono/stylesheet.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/webicons/2.0.0/webicons.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/Han/3.3.0/han.min.css"><link rel="stylesheet" type="text/css" href="/blog/styles/screen.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/highlight.js/9.9.0/styles/gruvbox-dark.min.css"></head><body><header><a href="/blog/"><img class="logo" src="https://avatars1.githubusercontent.com/u/4043284?v=3&amp;s=460" alt="幻☆精灵的Blog" title="幻☆精灵的Blog"></a><h1><a href="/blog/" alt="幻☆精灵的Blog" title="幻☆精灵的Blog">幻☆精灵的Blog</a></h1><p>Love life, love coding~</p><nav><ul><li><a href="/" alt="首页" title="首页">首页</a></li><li><a href="pigeonhole" alt="归档" title="归档">归档</a></li><li><a href="links" alt="链接" title="链接">链接</a></li><li><a href="about" alt="关于" title="关于">关于</a></li></ul><div class="xnews-icon"><a target="_blank" href="https://github.com/hstarorg" style="position: relative; top: -2px;">&#xe735;</a><a target="_blank" href="https://twitter.com/Hstar19">&#xe71f;</a><a target="_blank" href="https://www.facebook.com/100015363883648">&#xe60b;</a><a target="_blank" href="https://www.zhihu.com/people/hstar">&#xe63f;</a><a target="_blank" href="https://weibo.com/hstarorg" style="position: relative; top: -2px;">&#xe603;</a></div></nav><div class="space"></div></header><main><article class="full"><h1>Nginx常规用法解析</h1><span class="post-meta">写于<time> 2017 年 02 月 21 日 14 时 47 分</time><br>更新于<time> 2017 年 02 月 21 日 14 时 47 分</time></span><div class="article-toc"><strong>大纲</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0、Nginx简介"><span class="toc-number">1.</span> <span class="toc-text">0、Nginx简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、如何开始？"><span class="toc-number">2.</span> <span class="toc-text">1、如何开始？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1、安装"><span class="toc-number">2.1.</span> <span class="toc-text">1.1、安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2、启动"><span class="toc-number">2.2.</span> <span class="toc-text">1.2、启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3、重新载入配置"><span class="toc-number">2.3.</span> <span class="toc-text">1.3、重新载入配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4、停止服务"><span class="toc-number">2.4.</span> <span class="toc-text">1.4、停止服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、托管静态目录"><span class="toc-number">3.</span> <span class="toc-text">2、托管静态目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1、托管多个站点"><span class="toc-number">3.1.</span> <span class="toc-text">2.1、托管多个站点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2、有条件查找（复杂实例）"><span class="toc-number">3.2.</span> <span class="toc-text">2.2、有条件查找（复杂实例）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、反向代理"><span class="toc-number">4.</span> <span class="toc-text">3、反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1、利用反向代理，处理跨域"><span class="toc-number">4.1.</span> <span class="toc-text">3.1、利用反向代理，处理跨域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、负载均衡"><span class="toc-number">5.</span> <span class="toc-text">4、负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、更多配置"><span class="toc-number">6.</span> <span class="toc-text">5、更多配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、其他"><span class="toc-number">7.</span> <span class="toc-text">6、其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1、测试使用的完整Nginx配置文件"><span class="toc-number">7.1.</span> <span class="toc-text">6.1、测试使用的完整Nginx配置文件</span></a></li></ol></li></ol></div><h2 id="0、Nginx简介"><a href="#0、Nginx简介" class="headerlink" title="0、Nginx简介"></a>0、Nginx简介</h2><p><code>Nginx</code> 是时下最流行的静态Web服务器之一，使用它能快速的托管一个web站点。</p>
<p>当然，它的功能并不仅限于此，负载均衡，反向代理，它都非常拿手。</p>
<p>然而，要使用它，就不得不提到它的配置文件。本文就大致来了解下 <code>Nginx</code> 常规配置。</p>
<p><strong>注意：由于环境因素，该文所有测试均在Win10上使用 <code>nginx-1.11.5</code> 测试通过。</strong></p>
<h2 id="1、如何开始？"><a href="#1、如何开始？" class="headerlink" title="1、如何开始？"></a>1、如何开始？</h2><h3 id="1-1、安装"><a href="#1-1、安装" class="headerlink" title="1.1、安装"></a>1.1、安装</h3><p><strong>注意：该安装是指在Windows上安装 </strong></p>
<p>首先，我们进入 <code>Nginx</code> 的下载地址：<a href="https://nginx.org/en/download.html" target="_blank" rel="external">https://nginx.org/en/download.html</a>（书写该文时，<code>nginx</code> 最新版本是 <code>1.11.5</code>）。</p>
<p>然后，找到nginx的Windows压缩包并下载，然后解压到指定目录即可。</p>
<p><strong>提示：Linux下安装也是同样的思路，下载压缩包，解压缩。</strong></p>
<h3 id="1-2、启动"><a href="#1-2、启动" class="headerlink" title="1.2、启动"></a>1.2、启动</h3><p>解压好之后，进入解压目录，我们会看到一个 <code>nginx.exe</code>，它就是 <code>nginx</code> 的启动文件。</p>
<p>进入该目录的cmd环境，执行 <code>nginx</code> 即可启动 <code>nginx</code>，此时我们打开的是一个阻塞的控制台。当我们关闭控制台之后，<code>nginx</code> 服务也相应的关闭了。</p>
<p>大部分时候，我们需要它能在后台执行，此时我们可以使用 <code>start nginx</code> 来启动一个后台运行的 <code>nginx</code> 实例。</p>
<p>如果是线上环境，可能还要求它能够开机启动，此时我们可以采用把 <code>nginx</code> 作为Windows服务的方式来实现开机启动，具体做法请参考： <a href="http://www.spkevin.com/?p=946" target="_blank" rel="external">http://www.spkevin.com/?p=946</a>。</p>
<h3 id="1-3、重新载入配置"><a href="#1-3、重新载入配置" class="headerlink" title="1.3、重新载入配置"></a>1.3、重新载入配置</h3><p>当我们后台启动 <code>nginx</code> 之后，如果修改了配置文件，想重新载入配置怎么办呢？当然，我们可以停止，然后再启动。实际上，还有更简单的方法，执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 重新载入配置文件</span></div><div class="line">$ nginx <span class="_">-s</span> reload</div><div class="line"></div><div class="line"><span class="comment"># 重新打开日志文件</span></div><div class="line">$ nginx <span class="_">-s</span> reopen</div></pre></td></tr></table></figure>
<h3 id="1-4、停止服务"><a href="#1-4、停止服务" class="headerlink" title="1.4、停止服务"></a>1.4、停止服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 停止（快速停止，不保存相关信息，快）</span></div><div class="line">$ nginx <span class="_">-s</span> stop</div><div class="line"></div><div class="line"><span class="comment"># 退出（完整有序的停止，保存相关信息，慢）</span></div><div class="line">$ nginx <span class="_">-s</span> quit</div></pre></td></tr></table></figure>
<h2 id="2、托管静态目录"><a href="#2、托管静态目录" class="headerlink" title="2、托管静态目录"></a>2、托管静态目录</h2><p>托管静态目录是 <code>Nginx</code> 最常用的功能之一，该功能是将一个目录部署为一个静态的Web站点。</p>
<p>先使用 <code>start nginx</code> 启动 <code>nginx</code>（默认绑定的是80端口，可能会有冲突，需要修改下端口绑定）。</p>
<p><strong>修改端口绑定：在 <code>nginx/conf</code> 的目录下，打开 <code>nginx.conf</code> 配置文件，找到80，修改为另外一个端口号即可。</strong></p>
<p>启动之后，我们直接输入 <code>http://localhost:&lt;port&gt;</code> 即可查看到Nginx的欢迎页面。</p>
<p>先来分析下它的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">  ...</div><div class="line">  server &#123;</div><div class="line">    listen 7777;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">      root html;  <span class="comment"># 从html相对目录查找内容</span></div><div class="line">      index index.html index.htm; <span class="comment"># 默认首页查找顺序</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>什么意思呢？我们主要需要关注 <code>server/location</code> 节点，其中 <code>root属性</code> 表示去哪个目录查找文件，<code>index属性</code> 表示默认首页查找顺序。</p>
<h3 id="2-1、托管多个站点"><a href="#2-1、托管多个站点" class="headerlink" title="2.1、托管多个站点"></a>2.1、托管多个站点</h3><p>当我们要托管多个站点的时候，我们可以以同样的方式，创建多个 <code>server</code> 节点，这样就能监听不同的端口，也能托管不同的目录。</p>
<h3 id="2-2、有条件查找（复杂实例）"><a href="#2-2、有条件查找（复杂实例）" class="headerlink" title="2.2、有条件查找（复杂实例）"></a>2.2、有条件查找（复杂实例）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  listen 8101; <span class="comment"># 监听8101端口</span></div><div class="line">  server_name newegg-central-2.0; <span class="comment"># 设置server_name，类似iis的主机头 </span></div><div class="line">  root /dist;</div><div class="line">  index index.html; </div><div class="line"></div><div class="line">  location ~* \.(eot|ttf|woff|woff2)$ &#123; <span class="comment"># 针对字体请求做特殊处理</span></div><div class="line">    add_header x-nc2-server <span class="variable">$server_addr</span>;</div><div class="line">    add_header Access-Control-Allow-Origin <span class="string">'*'</span>; <span class="comment"># 允许字体跨域</span></div><div class="line">  &#125; </div><div class="line"></div><div class="line">  location ~* \.[a-zA-Z0-9]+$ &#123; <span class="comment"># 针对有后缀名的请求特殊处理，直接返回</span></div><div class="line">    add_header x-nc2-server <span class="variable">$server_addr</span>; </div><div class="line">  &#125;</div><div class="line"></div><div class="line">  location / &#123; <span class="comment"># 针对不满足上述条件的请求做处理</span></div><div class="line">    add_header x-nc2-server <span class="variable">$server_addr</span>;</div><div class="line">    access_log off;</div><div class="line">    error_page 404 = /index.html;  <span class="comment"># 如果遇到了404，则返回首页（为浏览器history api做的特殊处理，客户端路由）</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、反向代理"><a href="#3、反向代理" class="headerlink" title="3、反向代理"></a>3、反向代理</h2><p>反向代理是根据客户端的请求，从后端的服务器上获取资源，然后再将这些资源返回给客户端。所以我们需要一个后端，此处随便找一个站点来测试，如 “www.newegg.com”，让如何实现我们访问 localhost:7778，就能返回 <code>newegg</code>的数据呢？</p>
<p>配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  listen 7778; <span class="comment"># 监听7778端口</span></div><div class="line">  location / &#123;</div><div class="line">    proxy_pass http://www.newegg.com; <span class="comment">#根据客户端请求返回newegg的数据</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-1、利用反向代理，处理跨域"><a href="#3-1、利用反向代理，处理跨域" class="headerlink" title="3.1、利用反向代理，处理跨域"></a>3.1、利用反向代理，处理跨域</h3><p>跨域是前后端分离项目中，比较容易遇到的一个问题，在这里演示下，如何利用Nginx来避免跨域问题。</p>
<p>该方法的原理是，将API通过反向代理，让它看起来和站点是在同一个域，避免发起跨域请求。</p>
<p>先在7777端口托管的index.html中添加如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  xhr.open(<span class="string">'GET'</span>, <span class="string">'http://localhost:7779'</span>, <span class="literal">true</span>);</div><div class="line">  xhr.send();</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>访问 <code>http://localhost:7777</code>，可以明显的看到有跨域请求，接下来，我们来解决该问题，</p>
<p>首先，修改请求域名为： <code>http://localhost:7777/api</code> 这样就变成了同域，然后配置 <code>nginx</code>，把 <code>/api</code>的请求转发到真实的后端api上。</p>
<p>配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">  root html;</div><div class="line">  index index.html index.htm;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /api &#123; <span class="comment"># 把所有已/api 开头的请求，转发到7779端口</span></div><div class="line">  proxy_pass http://localhost:7779;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4、负载均衡"><a href="#4、负载均衡" class="headerlink" title="4、负载均衡"></a>4、负载均衡</h2><p>负载均衡是将应用部署到多个地方，然后用统一入口访问，解决单点故障问题。</p>
<p>先用 <code>Node</code> 创建两个 <code>Web server</code>，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Server 1</span></div><div class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  res.write(<span class="string">'Server 1, port: 7801'</span>);</div><div class="line">  res.end();</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">7801</span>, err =&gt; &#123;</div><div class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server 1 started.port: 7801'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>为了方便查看效果，我们将 <code>Server 2</code> 的端口修改为 <code>7802</code>，输出的文字也稍微变下。</p>
<p>接下来我们来进行负载均衡的配置，在 <code>nginx</code> 中，负载均衡有几种方式：</p>
<ol>
<li>轮询（默认方式）</li>
<li>加权轮询（轮询升级版，可以指定权重）</li>
<li>ip_hash（通过ip计算hash，然后跳转到指定服务器）</li>
<li>fair（第三方，根据后台服务器的响应时间来分配请求，响应时间短，优先分配，适应性较强）</li>
<li>upstream_hash（ip hash升级版，可以指定hash因子）</li>
</ol>
<p>这里我们就简单测试下前两种方式，实现配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">  ...</div><div class="line">  upstream test_server &#123;</div><div class="line">    server localhost:7801; <span class="comment"># 后端服务器1,</span></div><div class="line">    server localhost:7802; <span class="comment"># 后端服务器2</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  server &#123;</div><div class="line">    listen 7779;</div><div class="line">    location / &#123;</div><div class="line">      proxy_pass http://test_server; <span class="comment"># 负载均衡 </span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时，访问 <code>http://localhost:7779</code>，会发现 Server1 和 Server2 循环命中，这就是默认的轮询方式负载。</p>
<p>接着，测试带权重的负载，修改配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">  ...</div><div class="line">  upstream test_server &#123;</div><div class="line">    server localhost:7801 weight=2; <span class="comment"># 后端服务器1，权重2</span></div><div class="line">    server localhost:7802 weight=1; <span class="comment"># 后端服务器2，权重1</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  server &#123;</div><div class="line">    listen 7779;</div><div class="line">    location / &#123;</div><div class="line">      proxy_pass http://test_server; <span class="comment"># 负载均衡 </span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时，再多次请求 <code>http://localhost:7779</code>，会发现 Server1 出现两次，Server2 出现一次交替命中。</p>
<h2 id="5、更多配置"><a href="#5、更多配置" class="headerlink" title="5、更多配置"></a>5、更多配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">  ...</div><div class="line">  gzip on; <span class="comment"># 开启Gzip</span></div><div class="line"></div><div class="line">  server &#123;</div><div class="line">    ...</div><div class="line">    location / &#123;</div><div class="line">      add_header &lt;field&gt; value [always]; <span class="comment"># 返回时追加Header</span></div><div class="line">      proxy_set_header &lt;field&gt; &lt;value&gt;; <span class="comment"># 反向代理时，发送Header </span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>更多指令，请查询：<a href="https://nginx.org/en/docs/dirindex.html" target="_blank" rel="external">https://nginx.org/en/docs/dirindex.html</a></p>
<p>想了解完整配置，请查阅：<a href="https://nginx.org/en/docs/" target="_blank" rel="external">https://nginx.org/en/docs/</a></p>
<h2 id="6、其他"><a href="#6、其他" class="headerlink" title="6、其他"></a>6、其他</h2><h3 id="6-1、测试使用的完整Nginx配置文件"><a href="#6-1、测试使用的完整Nginx配置文件" class="headerlink" title="6.1、测试使用的完整Nginx配置文件"></a>6.1、测试使用的完整Nginx配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#user  nobody;</span></div><div class="line">worker_processes  1;</div><div class="line"></div><div class="line"><span class="comment">#error_log  logs/error.log;</span></div><div class="line"><span class="comment">#error_log  logs/error.log  notice;</span></div><div class="line"><span class="comment">#error_log  logs/error.log  info;</span></div><div class="line"></div><div class="line"><span class="comment">#pid        logs/nginx.pid;</span></div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    <span class="comment"># 定制日志格式</span></div><div class="line">    <span class="comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span></div><div class="line">    <span class="comment">#                  '$status $body_bytes_sent "$http_referer" '</span></div><div class="line">    <span class="comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span></div><div class="line"></div><div class="line">    <span class="comment">#access_log  logs/access.log  main;</span></div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    <span class="comment">#tcp_nopush     on;</span></div><div class="line"></div><div class="line">    <span class="comment"># 定制保持连接超时时间</span></div><div class="line">    <span class="comment">#keepalive_timeout  0;</span></div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    <span class="comment"># 是否启用gzip</span></div><div class="line">    <span class="comment">#gzip  on;</span></div><div class="line"></div><div class="line">    upstream test_server &#123;</div><div class="line">      server localhost:7801 weight=2; </div><div class="line">      server localhost:7802 weight=1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       7777;</div><div class="line">        server_name  localhost;</div><div class="line"></div><div class="line">        <span class="comment"># 设置编码格式</span></div><div class="line">        <span class="comment">#charset koi8-r;</span></div><div class="line"></div><div class="line">        <span class="comment"># 是否开启访问日志</span></div><div class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        location /api &#123;</div><div class="line">          proxy_pass http://localhost:7779;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment"># 指定错误页面</span></div><div class="line">        <span class="comment">#error_page  404              /404.html;</span></div><div class="line"></div><div class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></div><div class="line">        <span class="comment">#</span></div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></div><div class="line">        <span class="comment">#</span></div><div class="line">        <span class="comment">#location ~ \.php$ &#123;</span></div><div class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></div><div class="line">        <span class="comment">#&#125;</span></div><div class="line"></div><div class="line">        <span class="comment"># 托管PHP的相关配置</span></div><div class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></div><div class="line">        <span class="comment">#</span></div><div class="line">        <span class="comment">#location ~ \.php$ &#123;</span></div><div class="line">        <span class="comment">#    root           html;</span></div><div class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></div><div class="line">        <span class="comment">#    fastcgi_index  index.php;</span></div><div class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></div><div class="line">        <span class="comment">#    include        fastcgi_params;</span></div><div class="line">        <span class="comment">#&#125;</span></div><div class="line"></div><div class="line">        <span class="comment"># deny access to .htaccess files, if Apache's document root</span></div><div class="line">        <span class="comment"># concurs with nginx's one</span></div><div class="line">        <span class="comment">#</span></div><div class="line">        <span class="comment">#location ~ /\.ht &#123;</span></div><div class="line">        <span class="comment">#    deny  all;</span></div><div class="line">        <span class="comment">#&#125;</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">      listen 7778;</div><div class="line">      location / &#123;</div><div class="line">        proxy_pass http://www.newegg.com;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">      listen 7779;</div><div class="line">      location / &#123;</div><div class="line">        proxy_pass http://test_server;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment">#server &#123;</span></div><div class="line">    <span class="comment">#    listen       8000;</span></div><div class="line">    <span class="comment">#    listen       somename:8080;</span></div><div class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></div><div class="line"></div><div class="line">    <span class="comment">#    location / &#123;</span></div><div class="line">    <span class="comment">#        root   html;</span></div><div class="line">    <span class="comment">#        index  index.html index.htm;</span></div><div class="line">    <span class="comment">#    &#125;</span></div><div class="line">    <span class="comment">#&#125;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment"># 托管HTTPS</span></div><div class="line">    <span class="comment"># HTTPS server</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment">#server &#123;</span></div><div class="line">    <span class="comment">#    listen       443 ssl;</span></div><div class="line">    <span class="comment">#    server_name  localhost;</span></div><div class="line"></div><div class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></div><div class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></div><div class="line"></div><div class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></div><div class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></div><div class="line"></div><div class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></div><div class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></div><div class="line"></div><div class="line">    <span class="comment">#    location / &#123;</span></div><div class="line">    <span class="comment">#        root   html;</span></div><div class="line">    <span class="comment">#        index  index.html index.htm;</span></div><div class="line">    <span class="comment">#    &#125;</span></div><div class="line">    <span class="comment">#&#125;</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr><section class="comment"><div class="ds-thread" data-thread-key="/blog/2017/02/21/前端相关/Nginx常规用法解析/" data-title="Nginx常规用法解析" data-url="http://hstarorg.github.io/blog/blog/2017/02/21/前端相关/Nginx常规用法解析/"></div></section><script>var _shortName = "6389370154370729000";</script><script>var duoshuoQuery = {};
duoshuoQuery["short_name"] = _shortName;
(function() {
    var ds = document.createElement("script");
    ds.type = "text/javascript";
    ds.async = true;
    ds.src = (document.location.protocol === "https:" ? "https:" : "http:") + "//static.duoshuo.com/embed.js";
    ds.charset = "utf-8";
    (document.getElementsByTagName("head")[0] ||
        document.getElementsByTagName("body")[0]).appendChild(ds);
})();</script><footer><section class="copyright">&copy; 2016 - 2017<a href="/blog/">Jay.M.Hu</a></section><section class="intro">由<a href="https://hexo.io/">Hexo</a>驱动&middot;挂载<a href="https://github.com/xadillax/hexo-xnew">X'new</a>主题</section></footer></article></main><script src="//cdn.bootcss.com/Han/3.3.0/han.min.js"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><script src="//cdn.bootcss.com/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script><script src="/blog/scripts/highlight.pack.js"></script><script>$(function() {
    $("header").backstretch("/images/header.jpeg");

    $("figure.highlight").each(function(i, block) {
        $(block).removeClass("highlight");
        $("<pre><code class='__tobehl " + ($(block).attr("class") === "plain" ? "" : ("lang-" + $(block).attr("class"))) + "'></code></pre>").insertAfter($(block));
        $(block).next().find("code").text((block.innerText || block.textContent));
        $(block).remove();
    });
    $(".__tobehl").each(function(i, block) {
        hljs.highlightBlock(block);
    });

    $("article.full img").each(function() {
        $(this).parent().css("text-align", "center");
    });

    if($(".article-toc").children().length < 2) {
        $(".article-toc").css("display", "none");
    }
});</script></body></html>