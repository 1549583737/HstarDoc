<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Archives: 2017 | 幻☆精灵的Blog</title>
  <meta name="description" content="幻☆精灵的Blog站点" />
  <meta name="keywords" content="幻精灵" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/blog/images/favicon.ico">
  <link rel="alternate" href="/blog/atom.xml" title="幻☆精灵的Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="幻☆精灵的Blog站点">
<meta property="og:type" content="website">
<meta property="og:title" content="幻☆精灵的Blog">
<meta property="og:url" content="http://hstarorg.github.io/blog/archives/2017/page/11/index.html">
<meta property="og:site_name" content="幻☆精灵的Blog">
<meta property="og:description" content="幻☆精灵的Blog站点">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="幻☆精灵的Blog">
<meta name="twitter:description" content="幻☆精灵的Blog站点">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/blog/style.css">
  
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
		<div class="wrapper container">
			<a class="logo flat-box" href='/blog/' >
				幻☆精灵的Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/blog/'>
								首页
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/blog/archives'>
								归档
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/blog/about'>
								关于我
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu"></span></a></li>
			</ul>
		</div>
		<aside class="menu-phone">
			<nav>
				
					<a href="/blog/" class="nav-home nav">
						首页
					</a>
				
					<a href="/blog/archives" class="nav-archives nav">
						归档
					</a>
				
					<a href="/blog/about" class="nav-about nav">
						关于我
					</a>
				
			</nav>
		</aside>
</header>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container'>
      <div class='l_main'>
        
	
	<section class="page-header archive banner waves-image">
    <h1>Year : <span>2017</span></h1>
  </section>

<section class="post-list">
	
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/JS札记/ES6 Class如何管理私有数据/">
        ES6 Class如何管理私有数据
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、前言"><a href="#0、前言" class="headerlink" title="0、前言"></a>0、前言</h2><p>在ES5时代，要模拟对象的私有变量，是比较容易的，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> _age = <span class="number">20</span>; <span class="comment">//定义一个私有变量，外部无法访问。</span></div><div class="line">  <span class="keyword">this</span>.setAge = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">    _age = value;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">this</span>.getAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> _age;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在ES6中，虽然可以在 <code>Class</code> 的 <code>constructor</code> 中实现类似function的私有方法，但是实际上，ES6中并不推荐这种做法。这样极大的加重了对象的实例。</p>
<p>那我们就来看看在ES6中有多少方法可以实现私有数据管理。</p>
<h2 id="1、在构造函数中存储私有数据"><a href="#1、在构造函数中存储私有数据" class="headerlink" title="1、在构造函数中存储私有数据"></a>1、在构造函数中存储私有数据</h2><p>该方式，和在ES5中，没有什么区别。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">var</span> _age = <span class="number">20</span>;</div><div class="line">    <span class="keyword">this</span>.setAge = <span class="function"><span class="params">value</span> =&gt;</span> _age = value;</div><div class="line">    <span class="keyword">this</span>.getAge = <span class="function"><span class="params">_</span> =&gt;</span> _age;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方式有一个变种，就是利用构造参数来存储，减少重新定义变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(age)&#123;</div><div class="line">    <span class="keyword">this</span>.setAge = <span class="function"><span class="params">value</span> =&gt;</span> age = value;</div><div class="line">    <span class="keyword">this</span>.getAge = <span class="function"><span class="params">_</span> =&gt;</span> age;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<ol>
<li>数据绝对安全，外部无法直接通过属性访问到。</li>
<li>不会与其他私有属性有任何冲突。如 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> Person(); </div><div class="line">p.age = <span class="number">10</span>; </div><div class="line">p.getAge(); <span class="comment">//20</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>代码不怎么优雅，需要把方法设置为实例方法，才能访问到私有数据。</li>
<li>实例方法，比较浪费内存（每个实例都会拷贝一份）。</li>
</ol>
<h2 id="2、通过命名约定来使用私有数据"><a href="#2、通过命名约定来使用私有数据" class="headerlink" title="2、通过命名约定来使用私有数据"></a>2、通过命名约定来使用私有数据</h2><p>该方式是在ES6 Class 中，我个人比较推荐的一个方式，实现代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>._age = <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  setAge(value)&#123;</div><div class="line">    <span class="keyword">this</span>._age = value;</div><div class="line">  &#125;</div><div class="line">  getAge()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._age;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<ol>
<li>代码看起来非常不错，简单易懂。</li>
<li>能否在原型方法中访问。</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li><p>并不安全，如果不遵守约定，直接操作_age，也是可行的，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> Person();</div><div class="line">p._age = <span class="number">555</span>;</div><div class="line">p.getAge(); <span class="comment">// 555</span></div></pre></td></tr></table></figure>
</li>
<li><p>如果在对象上设置同名属性，会覆盖掉原本是私有属性。</p>
</li>
</ol>
<h2 id="3、利用WeakMap来存储私有数据"><a href="#3、利用WeakMap来存储私有数据" class="headerlink" title="3、利用WeakMap来存储私有数据"></a>3、利用WeakMap来存储私有数据</h2><p>该方式是利用WeakMap可以用Object来做key的特点，把this当做key来存储具体的私有属性。具体实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dataStore = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    dataStore.set(<span class="keyword">this</span>, &#123;<span class="attr">age</span>: <span class="number">20</span>&#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  setAge(value)&#123;</div><div class="line">    <span class="keyword">let</span> oldObj = dataStore.get(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">let</span> newObj = <span class="built_in">Object</span>.assign(oldObj, &#123;<span class="attr">age</span>: value&#125;);</div><div class="line">    dataStore.set(<span class="keyword">this</span>, newObj);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  getAge()&#123;</div><div class="line">    <span class="keyword">return</span> dataStore.get(<span class="keyword">this</span>).age;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如何使用？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> Person();</div><div class="line">p1.getAge(); <span class="comment">// 20</span></div><div class="line">p1.setAge(<span class="number">25</span>);</div><div class="line">p1.getAge(); <span class="comment">// 25</span></div></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<ol>
<li>能够使用原型方法，内存占用小；</li>
<li>比命名约定属性名称安全性更高；</li>
<li>不会有命名冲突（允许同名实例属性）；</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>代码没有命名约定方式（方式2）优雅；</li>
<li>依赖外部对象；</li>
</ol>
<h2 id="4、利用Symbol来生成私有属性key。"><a href="#4、利用Symbol来生成私有属性key。" class="headerlink" title="4、利用Symbol来生成私有属性key。"></a>4、利用Symbol来生成私有属性key。</h2><p>该方式和命名约定方式没有本质区别，只是用 <code>Symbol</code> 来生成key，提高了key的安全性。具体实现代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> keyForAge = <span class="built_in">Symbol</span>(<span class="string">'age'</span>); </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>[keyForAge] = <span class="number">20</span>;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  setAge(value)&#123;</div><div class="line">    <span class="keyword">this</span>[keyForAge] = value;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  getAge()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[keyForAge];</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<ol>
<li>能够使用原型方法，内存占用小；</li>
<li><p>比命名约定属性名称安全性更高，但也并不安全；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> Person();</div><div class="line"><span class="built_in">Object</span>.keys(p1); <span class="comment">// []，无法直接访问到属性名</span></div><div class="line">p1[keyForAge] = <span class="number">30</span>;</div><div class="line">p1.getAge(); <span class="comment">// 30</span></div><div class="line"><span class="built_in">Reflect</span>.ownKeys(p1); <span class="comment">// [Symbol(age)]，通过能方式能遍历Key</span></div></pre></td></tr></table></figure>
</li>
<li><p>不会有命名冲突（允许同名实例属性）；</p>
</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>代码没有命名约定方式（方式2）优雅；</li>
<li>依赖外部对象；</li>
<li>不是绝对安全；</li>
</ol>
<h2 id="5、Other"><a href="#5、Other" class="headerlink" title="5、Other"></a>5、Other</h2><p>能够达到的目的的方式有很多，也没有那个有绝对优势，根据实际的需求，来选择合适的方式才是最佳的方式。</p>
<p><strong>参考资料</strong></p>
<ol>
<li><a href="http://www.2ality.com/2016/01/private-data-classes.html" target="_blank" rel="external">http://www.2ality.com/2016/01/private-data-classes.html</a></li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/JS札记/JavaScript之毒瘤/">
        JavaScript之毒瘤
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、导言"><a href="#0、导言" class="headerlink" title="0、导言"></a>0、导言</h2><p>JavaScript中有许多难以避免的问题特性。接下来就一一揭示。</p>
<h2 id="1、全局变量"><a href="#1、全局变量" class="headerlink" title="1、全局变量"></a>1、全局变量</h2><p>在所有JavaScript的糟糕特性中，最为糟糕的就是全局变量的依赖。全局变量使得在同一个程序中运行独立的子程序变得更难。</p>
<h2 id="2、作用域"><a href="#2、作用域" class="headerlink" title="2、作用域"></a>2、作用域</h2><p>JavaScript是类C的语法，但是却没有提供类C的块级作用域。</p>
<h2 id="3、自动插入分号"><a href="#3、自动插入分号" class="headerlink" title="3、自动插入分号"></a>3、自动插入分号</h2><p>JavaScript有一个自动修复机制，会试图通过自动插入分号来修正有缺损的程序，但是它有可能掩盖更为严重的错误。</p>
<h2 id="4、保留字"><a href="#4、保留字" class="headerlink" title="4、保留字"></a>4、保留字</h2><p>有太多的单词在JavaScript中被保留，它们不能用来命名变量或者函数（在大部分执行环境下，部分关键字是可用的）。</p>
<h2 id="5、Unicode字符"><a href="#5、Unicode字符" class="headerlink" title="5、Unicode字符"></a>5、Unicode字符</h2><p>JavaScript设计之初，Unicode预计只会有65536个字符。实际上，到现在Unicode有多大百万个字符。这也就导致了JavaScript会认为一对字符是两个不同的字符（Unicode把一对字符视为一个单一的字符）</p>
<h2 id="6、typeof"><a href="#6、typeof" class="headerlink" title="6、typeof"></a>6、typeof</h2><p>不要指望typeof返回的类型。比如null或者是检测对象，另外检测正则可能会返回function或者是object。</p>
<h2 id="7、parseInt"><a href="#7、parseInt" class="headerlink" title="7、parseInt"></a>7、parseInt</h2><p>parseInt把一个字符串转换为整数，会在遇到非数字时停止解析。另外如果第一个字符是0，还会按照8进制来取值。</p>
<h2 id="8、运算符（-）"><a href="#8、运算符（-）" class="headerlink" title="8、运算符（+）"></a>8、运算符（+）</h2><p>+运算符可以用于加法运算或者是字符串连接，究竟如何执行会取决于其参数类型。</p>
<h2 id="9、-浮点数"><a href="#9、-浮点数" class="headerlink" title="9、 浮点数"></a>9、 浮点数</h2><p>二进制浮点数不能正确的处理十进制小数，因此0.1+0.2 不等于0.3。</p>
<h2 id="10、NaN"><a href="#10、NaN" class="headerlink" title="10、NaN"></a>10、NaN</h2><p>NaN是一个特殊的数量值，它表示不是一个数字。也是唯一一个不等于自身的JavaScript数值。</p>
<h2 id="11、伪数组"><a href="#11、伪数组" class="headerlink" title="11、伪数组"></a>11、伪数组</h2><p>JavaScript没有真正的数组，就连Array也是通过object来模拟的，如果完全达不到真正的数组的地步。同时typeof运算符也不能辨别数组和对象。</p>
<h2 id="12、假值"><a href="#12、假值" class="headerlink" title="12、假值"></a>12、假值</h2><p>JavaScript中包含诸多的假值，如: 0, NaN, ‘’, false, null, undefined</p>
<h2 id="13、hasOwnProperty"><a href="#13、hasOwnProperty" class="headerlink" title="13、hasOwnProperty"></a>13、hasOwnProperty</h2><p>hasOwnProperty方法被用做一个过滤器来避开for..in语句的隐患，但hasOwnProperty是一个普通的方法，所以是可以被重写的。</p>
<h2 id="14、对象"><a href="#14、对象" class="headerlink" title="14、对象"></a>14、对象</h2><p>JavaScript的对象，永远不会是真的空对象，因为可以从原形链取得成员属性。</p>


    
    
    
  </section>
</article>
    </div>
  
</section>


  <nav id="page-nav">
    
    <a class="prev" rel="prev" href="/blog/archives/2017/page/10/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
  </nav>
  


      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='https://avatars1.githubusercontent.com/u/4043284?v=3&amp;s=460' />

<div class='header'>Jay.M.Hu</div>
<div class='content'>
<div></div>
</div>
</section>

  <section class='m_widget friendly-links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://humin.cnblogs.com/">
            <div class='name'>幻天芒 - 博客园</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
</div>
</section>

  


      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/hstarorg" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/blog/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/blog/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/blog/js/search.js"></script>
<script src="/blog/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
