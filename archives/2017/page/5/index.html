<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Archives: 2017 | 幻☆精灵的Blog</title>
  <meta name="description" content="幻☆精灵的Blog站点" />
  <meta name="keywords" content="幻精灵" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/blog/images/favicon.ico">
  <link rel="alternate" href="/blog/atom.xml" title="幻☆精灵的Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="幻☆精灵的Blog站点">
<meta property="og:type" content="website">
<meta property="og:title" content="幻☆精灵的Blog">
<meta property="og:url" content="http://hstarorg.github.io/blog/archives/2017/page/5/index.html">
<meta property="og:site_name" content="幻☆精灵的Blog">
<meta property="og:description" content="幻☆精灵的Blog站点">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="幻☆精灵的Blog">
<meta name="twitter:description" content="幻☆精灵的Blog站点">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/blog/style.css">
  
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
		<div class="wrapper container">
			<a class="logo flat-box" href='/blog/' >
				幻☆精灵的Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/blog/'>
								首页
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/blog/archives'>
								归档
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/blog/about'>
								关于我
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu"></span></a></li>
			</ul>
		</div>
		<aside class="menu-phone">
			<nav>
				
					<a href="/blog/" class="nav-home nav">
						首页
					</a>
				
					<a href="/blog/archives" class="nav-archives nav">
						归档
					</a>
				
					<a href="/blog/about" class="nav-about nav">
						关于我
					</a>
				
			</nav>
		</aside>
</header>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container'>
      <div class='l_main'>
        
	
	<section class="page-header archive banner waves-image">
    <h1>Year : <span>2017</span></h1>
  </section>

<section class="post-list">
	
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/ES6入门/ES6入门系列四（测试题分析）/">
        ES6入门系列四（测试题分析）
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、导言"><a href="#0、导言" class="headerlink" title="0、导言"></a>0、导言</h2><p>ES6中新增了不少的新特性，来点测试题热热身。具体题目来源请看：<a href="http://perfectionkills.com/javascript-quiz-es6/" target="_blank" rel="external">http://perfectionkills.com/javascript-quiz-es6/</a>。</p>
<p>以下将一题一题来解析what和why。</p>
<h2 id="1、题目一"><a href="#1、题目一" class="headerlink" title="1、题目一"></a>1、题目一</h2><pre><code>(function(x, f = () =&gt; x) {
  var x;
  var y = x;
  x = 2;
  return [x, y, f()];
})(1)

A、 [2, 1, 1]
B、 [2, undefined, 1]
C、 [2, 1, 2]
D、 [2, undefined, 2]
</code></pre><p><strong>解析：</strong>本题主要考察的知识点是1、参数值与函数体内定义的重名变量的优先级；2、ES6的默认参数；3、箭头函数。<br>在本题中，先执行x的定义，然后函数参数x=1，接着是y = x = 1,接着再x = 2，第三个是执行f函数，箭头函数如果只是表达式，那么等价于return 表达式，由于箭头函数的作用域等于定义时的作用域，那么函数定义时x=1，所以最后的return x 等价于 return 1</p>
<h2 id="2、题目二"><a href="#2、题目二" class="headerlink" title="2、题目二"></a>2、题目二</h2><pre><code>(function() {
  return [
    (() =&gt; this.x).bind({ x: &apos;inner&apos; })(),
    (() =&gt; this.x)()
  ]
}).call({ x: &apos;outer&apos; });

A、 [&apos;inner&apos;, &apos;outer&apos;]
B、 [&apos;outer&apos;, &apos;outer&apos;]
C、 [undefined, undefined]
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察的是箭头函数的作用域问题，箭头函数的作用域等于定义时的作用域，所以通过bind设置的this是无效的。那么结果就显而易见了。</p>
<h2 id="3、题目三"><a href="#3、题目三" class="headerlink" title="3、题目三"></a>3、题目三</h2><pre><code>let x, { x: y = 1 } = { x }; y;

A、 undefined
B、 1
C、 { x: 1 }
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察的是对象赋值，先定义x，然后在赋值的时候会执行一次y=1，最后返回y的值。</p>
<h2 id="4、题目四"><a href="#4、题目四" class="headerlink" title="4、题目四"></a>4、题目四</h2><pre><code>(function() {
  let f = this ? class g { } : class h { };
  return [
    typeof f,
    typeof h
  ];
})();

A、 [&quot;function&quot;, &quot;undefined&quot;]
B、 [&quot;function&quot;, &quot;function&quot;]
C、 [&quot;undefined&quot;, &quot;undefined&quot;]
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察定义函数变量时，命名函数的名称作用域问题。在定义函数变量时，函数名称只能在函数体中生效。</p>
<h2 id="5、题目五"><a href="#5、题目五" class="headerlink" title="5、题目五"></a>5、题目五</h2><pre><code>(typeof (new (class { class () {} })))

A、 &quot;function&quot;
B、 &quot;object&quot;
C、 &quot;undefined&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察对象的类型，和原型方法。该提可以分解如下：</p>
<pre><code>// 定义包含class原型方法的类。
var Test = class{
  class(){}
};
var test = new Test(); //定义类的实例
typeof test; //出结果
</code></pre><h2 id="6、题目六"><a href="#6、题目六" class="headerlink" title="6、题目六"></a>6、题目六</h2><pre><code>typeof (new (class F extends (String, Array) { })).substring

A、 &quot;function&quot;
B、 &quot;object&quot;
C、 &quot;undefined&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察ES6中class的继承，以及表达式的返回值和undefined的类型。题目其实可以按照如下方式分解：</p>
<pre><code>//由于JS的class没有多继承的概念，所以括号被当做表达式来看
(String, Array) //Array,返回最后一个值
(class F extends Array); //class F继承成Array
(new (class F extends Array)); //创建一个F的实例
(new (class F extends (String, Array) { })).substring; //取实例的substring方法，由于没有继承String，Array没有substring方法，那么返回值为undefined
typeof (new (class F extends (String, Array) { })).substring; //对undefined取typeof
</code></pre><h2 id="7、题目七"><a href="#7、题目七" class="headerlink" title="7、题目七"></a>7、题目七</h2><pre><code>[...[...&apos;...&apos;]].length

A、 1
B、 3
C、 6
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察的是扩展运算符…的作用。扩展运算符是将后面的对象转换为数组，具体用法是：</p>
<pre><code>[...&lt;数据&gt;] 比如 [...&apos;abc&apos;]等价于[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]
</code></pre><h2 id="8、题目八"><a href="#8、题目八" class="headerlink" title="8、题目八"></a>8、题目八</h2><pre><code>typeof (function* f() { yield f })().next().next()

A、 &quot;function&quot;
B、 &quot;generator&quot;
C、 &quot;object&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察ES6的生成器。题目可以如下分解：</p>
<pre><code>function* f() { yield f }; //定义一个生成器
var g = f(); //执行生成器
var temp = g.next(); //返回第一次yield的值
console.log(temp); //测试，查看temp，其实是一个object
temp.next()；//对对象调用next方法，无效
</code></pre><h2 id="9、题目九"><a href="#9、题目九" class="headerlink" title="9、题目九"></a>9、题目九</h2><pre><code>typeof (new class f() { [f]() { }, f: { } })[`${f}`]

A、 &quot;function&quot;
B、 &quot;undefined&quot;
C、 &quot;object&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察ES6的class，以及动态属性和模板字符串等。 实际上这个题动态属性和模板字符串都是烟雾弹，在执行new class f()的时候，就已经有语法错误了。</p>
<h2 id="10、题目十"><a href="#10、题目十" class="headerlink" title="10、题目十"></a>10、题目十</h2><pre><code>typeof `${{Object}}`.prototype

A、 &quot;function&quot;
B、 &quot;undefined&quot;
C、 &quot;object&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题考察的知识点相对单一，就是模板字符串。分解如下：</p>
<pre><code>var o = {Object},
  str = `${o}`;
typeof str.prototype; 
</code></pre><h2 id="11、题目十一"><a href="#11、题目十一" class="headerlink" title="11、题目十一"></a>11、题目十一</h2><pre><code>((...x, xs)=&gt;x)(1,2,3)

A、 1
B、 3
C、 [1,2,3]
D、 Error
</code></pre><p><strong>解析：</strong>本题主要考察的是Rest参数的用法，在ES6中，Rest参数只能放在末尾，所以该用法的错误的。</p>
<h2 id="12、题目十二"><a href="#12、题目十二" class="headerlink" title="12、题目十二"></a>12、题目十二</h2><pre><code>let arr = [ ];
for (let { x = 2, y } of [{ x: 1 }, 2, { y }]) { 
  arr.push(x, y);
}
arr;

A、 [2, { x: 1 }, 2, 2, 2, { y }]
B、 [{ x: 1 }, 2, { y }]
C、 [1, undefined, 2, undefined, 2, undefined]
D、 Error
</code></pre><p><strong>解析：</strong>本题看起来是考察let的作用域和of迭代的用法。实则是考察let的语法，let之后是一个参数名称。所以，语法错误</p>
<h2 id="13、题目十三"><a href="#13、题目十三" class="headerlink" title="13、题目十三"></a>13、题目十三</h2><pre><code>(function() {
  if (false) {
    let f = { g() =&gt; 1 };
  }
  return typeof f;
})()

A、 &quot;function&quot;
B、 &quot;undefined&quot;
C、 &quot;object&quot;
D、 Error
</code></pre><p><strong>解析：</strong>本题非常有迷惑性，看似考察的let的作用域问题，实则考察了箭头函数的语法问题。</p>
<h2 id="14、题目答案"><a href="#14、题目答案" class="headerlink" title="14、题目答案"></a>14、题目答案</h2><p>相信大家看过题目的解析，对题目答案已经了然。为了完善本文，还是在最后贴出所有题目的答案：</p>
<p>ABBAB CBDDB DDD</p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/jQuery拆解/03-基础结构/">
        03-基础结构
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、jQuery-与-new-jQuery"><a href="#0、jQuery-与-new-jQuery" class="headerlink" title="0、jQuery() 与 new jQuery();"></a>0、jQuery() 与 new jQuery();</h2><p>在 <code>jQuery</code> 中,我们一般都是用 <code>$(&#39;body&#39;)</code>，实际上 <code>new $(&#39;body&#39;)</code> 也是可以用的。这是如何实现的呢？</p>
<p>要能使用 <code>new</code>，那 <code>jQuery</code> 一定是一个 <code>function</code>，又要让直接调用也返回一个实例，那我们就可以考虑返回另外一个全新 <code>function</code> 的实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span> (<span class="params">selector, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>通过以上这段代码，不管是用 <code>new jQuery()</code> 还是 <code>jQuery()</code> 返回的都是 <code>init</code> 方法的实例。</p>
<p>在定义 <code>jQuery</code> 这个方法的时候，实际上 <code>fn</code> 和 <code>init</code> 都还不存在。</p>
<h2 id="1、jQuery-fn-jQuery-prototype"><a href="#1、jQuery-fn-jQuery-prototype" class="headerlink" title="1、jQuery.fn = jQuery.prototype"></a>1、jQuery.fn = jQuery.prototype</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">jQuery.fn = jQuery.prototype = &#123;</div><div class="line">  <span class="comment">// The current version of jQuery being used</span></div><div class="line">  jquery: version,</div><div class="line">  <span class="attr">constructor</span>: jQuery,</div><div class="line">  <span class="comment">// The default length of a jQuery object is 0</span></div><div class="line">  length: <span class="number">0</span>,</div><div class="line">  <span class="attr">toArray</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> slice.call(<span class="keyword">this</span>);</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// Get the Nth element in the matched element set OR</span></div><div class="line">  <span class="comment">// Get the whole matched element set as a clean array</span></div><div class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="comment">// Return all the elements in a clean array</span></div><div class="line">    <span class="keyword">if</span> (num == <span class="literal">null</span>) &#123;</div><div class="line">      <span class="keyword">return</span> slice.call(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Return just the one element from the set</span></div><div class="line">    <span class="keyword">return</span> num &lt; <span class="number">0</span> ? <span class="keyword">this</span>[num + <span class="keyword">this</span>.length] : <span class="keyword">this</span>[num];</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// Take an array of elements and push it onto the stack</span></div><div class="line">  <span class="comment">// (returning the new matched element set)</span></div><div class="line">  pushStack: <span class="function"><span class="keyword">function</span> (<span class="params">elems</span>) </span>&#123;</div><div class="line">    <span class="comment">// Build a new jQuery matched element set</span></div><div class="line">    <span class="keyword">var</span> ret = jQuery.merge(<span class="keyword">this</span>.constructor(), elems);</div><div class="line">    <span class="comment">// Add the old object onto the stack (as a reference)</span></div><div class="line">    ret.prevObject = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">// Return the newly-formed element set</span></div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// Execute a callback for every element in the matched set.</span></div><div class="line">  each: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> jQuery.each(<span class="keyword">this</span>, callback);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">map</span>: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">elem, i</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> callback.call(elem, i, elem);</div><div class="line">    &#125;));</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">slice</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">first</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq(<span class="number">0</span>);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">last</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq(<span class="number">-1</span>);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">eq</span>: <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> len = <span class="keyword">this</span>.length,</div><div class="line">      j = +i + (i &lt; <span class="number">0</span> ? len : <span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [<span class="keyword">this</span>[j]] : []);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">end</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prevObject || <span class="keyword">this</span>.constructor();</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// For internal use only.</span></div><div class="line">  <span class="comment">// Behaves like an Array's method, not like a jQuery method.</span></div><div class="line">  push: push, <span class="comment">// push = [].push</span></div><div class="line">  sort: arr.sort, <span class="comment">// arr = []</span></div><div class="line">  splice: arr.splice <span class="comment">// arr = []</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>通过以上方法指定了 <code>jQuery</code> 的原型对象，也可以看到它默认的原型方法。</p>
<h2 id="2、jQuery-fn-init-prototype"><a href="#2、jQuery-fn-init-prototype" class="headerlink" title="2、jQuery.fn.init.prototype?"></a>2、jQuery.fn.init.prototype?</h2><p>看到了 <code>jQuery</code> 的构造和 <code>jQuery.prototype</code> 的申明，可能会有这样一个疑惑，在 <code>jQuery()</code> 中返回的明明是 <code>jQuery.fn.init</code> 的实例，为什么可以使用 <code>jQuery.protptype</code> 呢？</p>
<p>我们先看看 <code>init</code> 函数的实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> init = jQuery.fn.init = <span class="function"><span class="keyword">function</span> (<span class="params">selector, context, root</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> match, elem;</div><div class="line">  <span class="comment">// HANDLE: $(""), $(null), $(undefined), $(false)</span></div><div class="line">  <span class="comment">// 没有给选择器还玩个毛啊</span></div><div class="line">  <span class="keyword">if</span> (!selector) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// Method init() accepts an alternate rootjQuery</span></div><div class="line">  <span class="comment">// so migrate can support jQuery.sub (gh-2101)</span></div><div class="line">  root = root || rootjQuery;</div><div class="line"></div><div class="line">  <span class="comment">// Handle HTML strings</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> selector === <span class="string">"string"</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (selector[<span class="number">0</span>] === <span class="string">"&lt;"</span> &amp;&amp;</div><div class="line">      selector[selector.length - <span class="number">1</span>] === <span class="string">"&gt;"</span> &amp;&amp;</div><div class="line">      selector.length &gt;= <span class="number">3</span>) &#123;</div><div class="line"></div><div class="line">      <span class="comment">// Assume that strings that start and end with &lt;&gt; are HTML and skip the regex check</span></div><div class="line">      match = [<span class="literal">null</span>, selector, <span class="literal">null</span>];</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      match = rquickExpr.exec(selector);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Match html or make sure no context is specified for #id</span></div><div class="line">    <span class="keyword">if</span> (match &amp;&amp; (match[<span class="number">1</span>] || !context)) &#123;</div><div class="line"></div><div class="line">      <span class="comment">// HANDLE: $(html) -&gt; $(array)</span></div><div class="line">      <span class="keyword">if</span> (match[<span class="number">1</span>]) &#123;</div><div class="line">        context = context <span class="keyword">instanceof</span> jQuery ? context[<span class="number">0</span>] : context;</div><div class="line"></div><div class="line">        <span class="comment">// Option to run scripts is true for back-compat</span></div><div class="line">        <span class="comment">// Intentionally let the error be thrown if parseHTML is not present</span></div><div class="line">        jQuery.merge(<span class="keyword">this</span>, jQuery.parseHTML(</div><div class="line">          match[<span class="number">1</span>],</div><div class="line">          context &amp;&amp; context.nodeType ? context.ownerDocument || context : <span class="built_in">document</span>,</div><div class="line">          <span class="literal">true</span></div><div class="line">        ));</div><div class="line"></div><div class="line">        <span class="comment">// HANDLE: $(html, props)</span></div><div class="line">        <span class="keyword">if</span> (rsingleTag.test(match[<span class="number">1</span>]) &amp;&amp; jQuery.isPlainObject(context)) &#123;</div><div class="line">          <span class="keyword">for</span> (match <span class="keyword">in</span> context) &#123;</div><div class="line"></div><div class="line">            <span class="comment">// Properties of context are called as methods if possible</span></div><div class="line">            <span class="keyword">if</span> (jQuery.isFunction(<span class="keyword">this</span>[match])) &#123;</div><div class="line">              <span class="keyword">this</span>[match](context[match]);</div><div class="line"></div><div class="line">              <span class="comment">// ...and otherwise set as attributes</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              <span class="keyword">this</span>.attr(match, context[match]);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">        <span class="comment">// HANDLE: $(#id)</span></div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        elem = <span class="built_in">document</span>.getElementById(match[<span class="number">2</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (elem) &#123;</div><div class="line"></div><div class="line">          <span class="comment">// Inject the element directly into the jQuery object</span></div><div class="line">          <span class="keyword">this</span>[<span class="number">0</span>] = elem;</div><div class="line">          <span class="keyword">this</span>.length = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// HANDLE: $(expr, $(...))</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!context || context.jquery) &#123;</div><div class="line">      <span class="keyword">return</span> (context || root).find(selector);</div><div class="line"></div><div class="line">      <span class="comment">// HANDLE: $(expr, context)</span></div><div class="line">      <span class="comment">// (which is just equivalent to: $(context).find(expr)</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.constructor(context).find(selector);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// HANDLE: $(DOMElement)</span></div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (selector.nodeType) &#123;</div><div class="line">    <span class="keyword">this</span>[<span class="number">0</span>] = selector;</div><div class="line">    <span class="keyword">this</span>.length = <span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">    <span class="comment">// HANDLE: $(function)</span></div><div class="line">    <span class="comment">// Shortcut for document ready</span></div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (jQuery.isFunction(selector)) &#123;</div><div class="line">    <span class="keyword">return</span> root.ready !== <span class="literal">undefined</span> ?</div><div class="line">      root.ready(selector) :</div><div class="line"></div><div class="line">      <span class="comment">// Execute immediately if ready is not present</span></div><div class="line">      selector(jQuery);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> jQuery.makeArray(selector, <span class="keyword">this</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这个不多说，就是根据选择器查找元素。接下来，关键来了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 把jQuery.fn设置为init的原型</span></div><div class="line">init.prototype = jQuery.fn;</div><div class="line"></div><div class="line"><span class="comment">// Initialize central reference</span></div><div class="line"><span class="comment">// 从document开始查找</span></div><div class="line">rootjQuery = jQuery(<span class="built_in">document</span>);</div></pre></td></tr></table></figure>
<h2 id="3、jQuery-extend-jQuery-fn-extend"><a href="#3、jQuery-extend-jQuery-fn-extend" class="headerlink" title="3、jQuery.extend = jQuery.fn.extend"></a>3、jQuery.extend = jQuery.fn.extend</h2><p>有了以上的基础，那么就该扩展 <code>jQuery</code> 的功能了。它的核心就是以下的扩展函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</div><div class="line">    target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</div><div class="line">    i = <span class="number">1</span>,</div><div class="line">    length = <span class="built_in">arguments</span>.length,</div><div class="line">    deep = <span class="literal">false</span>;</div><div class="line">  <span class="comment">// Handle a deep copy situation</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">"boolean"</span>) &#123;</div><div class="line">    deep = target;</div><div class="line">    <span class="comment">// Skip the boolean and the target</span></div><div class="line">    target = <span class="built_in">arguments</span>[i] || &#123;&#125;;</div><div class="line">    i++;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target)) &#123;</div><div class="line">    target = &#123;&#125;;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// Extend jQuery itself if only one argument is passed</span></div><div class="line">  <span class="keyword">if</span> (i === length) &#123;</div><div class="line">    target = <span class="keyword">this</span>;</div><div class="line">    i--;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 将属性扩展到指定的对象上。</span></div><div class="line">  <span class="keyword">for</span> (; i &lt; length; i++) &#123;</div><div class="line">    <span class="comment">// Only deal with non-null/undefined values</span></div><div class="line">    <span class="keyword">if</span> ((options = <span class="built_in">arguments</span>[i]) != <span class="literal">null</span>) &#123;</div><div class="line">      <span class="comment">// Extend the base object</span></div><div class="line">      <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</div><div class="line">        src = target[name];</div><div class="line">        copy = options[name];</div><div class="line">        <span class="comment">// Prevent never-ending loop</span></div><div class="line">        <span class="keyword">if</span> (target === copy) &#123;</div><div class="line">          <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Recurse if we're merging plain objects or arrays</span></div><div class="line">        <span class="keyword">if</span> (deep &amp;&amp; copy &amp;&amp; (jQuery.isPlainObject(copy) ||</div><div class="line">          (copyIsArray = jQuery.isArray(copy)))) &#123;</div><div class="line">          <span class="keyword">if</span> (copyIsArray) &#123;</div><div class="line">            copyIsArray = <span class="literal">false</span>;</div><div class="line">            clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">            clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">// Never move original objects, clone them</span></div><div class="line">          target[name] = jQuery.extend(deep, clone, copy);</div><div class="line">          <span class="comment">// Don't bring in undefined values</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (copy !== <span class="literal">undefined</span>) &#123;</div><div class="line">          target[name] = copy;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// Return the modified object</span></div><div class="line">  <span class="keyword">return</span> target;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>为什么同一个 <code>extend</code> 函数可以扩展 <code>jQuery</code>，也可以扩展 <code>jQuery.fn</code>？这就涉及到另外一个JS的知识点了。</p>
<p><strong>函数中this的指向是谁调用谁就是this</strong>。 </p>
<h2 id="4、小结"><a href="#4、小结" class="headerlink" title="4、小结"></a>4、小结</h2><p>以上就是 <code>jQuery</code> 的核心基础结构，如果我们自己要编写一个 <code>Lib or Framework</code>，也可以参考这样的方式来实现。</p>
<p>之后所有的功能，都是从这里进行扩展。 </p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/JS札记/那些不常见的JavaScript题目（上）/">
        那些不常见的JavaScript题目（上）
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="0、导言"><a href="#0、导言" class="headerlink" title="0、导言"></a>0、导言</h2><p>JavaScript超乎寻常的灵活性，让JavaScript可以有很多特殊的用法，让我们来领略一下它们的风采吧。</p>
<p>此为上篇，下篇请查阅：<a href="那些不常见的JavaScript题目（下）.md">下篇</a></p>
<h2 id="1、那些不常见（好玩）的题目"><a href="#1、那些不常见（好玩）的题目" class="headerlink" title="1、那些不常见（好玩）的题目"></a>1、那些不常见（好玩）的题目</h2><hr>
<h3 id="1-1、"><a href="#1-1、" class="headerlink" title="1.1、"></a>1.1、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>].map(<span class="built_in">parseInt</span>)</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 该题考察数组的 <code>Array.map()</code> 函数和 <code>parseInt()</code>的用法。</p>
<p><code>Array.map()</code>，接受两个两个，第一个是回调函数 <code>function(currentValue, index, array)</code>，第二个是可选参数 <code>thisArg</code>，用来指定回调函数的 <code>this</code> 对象，默认是 <code>window</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue, index, array</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(currentValue, index, array, <span class="keyword">this</span>);</div><div class="line">  <span class="keyword">return</span> <span class="string">'1'</span>;</div><div class="line">&#125;, &#123;&#125;);</div></pre></td></tr></table></figure>
<p>通过上面的代码可以验证 <code>Array.map()</code> 的用法，想更详细了解，请参考 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank" rel="external">MDN Array.map</a>。</p>
<p>接着看 <code>parseInt</code>，<code>parseInt</code> 默认接受两个函数，第一个要是要转化的元素，第二个是进制，默认2~36，0的话，就当成10进制处理。如果超过则会返回 <code>NaN</code>。把它作为map的回调函数时，相当于给parseInt传递了三个参数。多余的参数对结果不影响，所以问题可以变形为：<code>[parseInt(&#39;1&#39;, 0), parseInt(&#39;2&#39;, 2), parseInt(&#39;3&#39;,2)]</code>，所以就能得出答案了。</p>
<p><strong>答案：</strong> <code>[1, NaN, NaN]</code></p>
<hr>
<h3 id="1-2、"><a href="#1-2、" class="headerlink" title="1.2、"></a>1.2、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">typeof</span> <span class="literal">null</span>, <span class="literal">null</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>]</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 该题考察了对<code>null</code>的认识。 <code>null</code> 本身是一个类型（并不是Object的实例），但对它进行 <code>typeof</code> 会返回 <code>object</code>。</p>
<p><strong>答案：</strong> <code>[&#39;object&#39;, false]</code></p>
<hr>
<h3 id="1-3、"><a href="#1-3、" class="headerlink" title="1.3、"></a>1.3、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[ [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>].reduce(<span class="built_in">Math</span>.pow), [].reduce(<span class="built_in">Math</span>.pow)] ]</div></pre></td></tr></table></figure>
<p><strong>解析：</strong>此题和1.1比较类似，考察 <code>Array.reduce()</code> 和 <code>Math.pow()</code> 方法的使用。</p>
<p><code>Array.reduce()</code> 用于将数组的多个值根据指定的处理函数，合并为一个值。它的回调函数定义为 <code>function(previousValue, currentValue, currentIndex, array){}</code>，其中：</p>
<ol>
<li>previousValue // 上一次的运算结果（注意：该变量的初始值为数组的第一个元素）</li>
<li>currentValue // 当前数组元素</li>
<li>currentIndex // 当前数组索引</li>
<li>array //数组本身</li>
</ol>
<p>另外，需要注意，由于默认 <code>previousValue</code> 的初始值是第一个数组元素，那么实际的回调函数调用次数为：<code>arr.length - 1</code>。如果数组元素小于1，就会因为无法提供初始值，而导致方法异常（报错）。想了解更多，参考：<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce" target="_blank" rel="external">MDN Array.reduce()</a>。</p>
<p><code>Math.pow()</code> 用于计算指定值的次方，接受两个参数，前者为基数，后者为几次方，如：<code>Math.pow(2, 3) // 8</code>。</p>
<p><strong>答案：</strong> <code>[9, error]</code></p>
<hr>
<h3 id="1-4、"><a href="#1-4、" class="headerlink" title="1.4、"></a>1.4、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> val = <span class="string">'smtg'</span>;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Value is '</span> + (val === <span class="string">'smtg'</span>) ? <span class="string">'Something'</span> : <span class="string">'Nothing'</span>);</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题比较简单，考察+号运算符和?号运算符的优先级问题，+优先级大于?。</p>
<p><strong>答案：</strong> <code>&#39;Something&#39;</code></p>
<hr>
<h3 id="1-5、"><a href="#1-5、" class="headerlink" title="1.5、"></a>1.5、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">'World!'</span>;</div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'undefined'</span>) &#123;</div><div class="line">    <span class="keyword">var</span> name = <span class="string">'Jack'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Goodbye '</span> + name);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + name);</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察函数作用域、变量提前、全局变量和局部变量相关的知识点。JS默认是函数作用域，并且函数申明，变量申明会提前到函数体开头。所以题目代码等价于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">'World!'</span>;</div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> name;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'undefined'</span>) &#123;</div><div class="line">    name = <span class="string">'Jack'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Goodbye '</span> + name);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + name);</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>再结合局部变量，会隐藏全局变量，所以答案就出来。</p>
<p><strong>答案：</strong> <code>Goodbye Jack</code></p>
<hr>
<h3 id="1-6、"><a href="#1-6、" class="headerlink" title="1.6、"></a>1.6、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> END = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>);</div><div class="line"><span class="keyword">var</span> START = END - <span class="number">100</span>;</div><div class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = START; i &lt;= END; i++) &#123;</div><div class="line">  count++;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(count);</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察的知识比较偏门，考察了JS中<strong>能正确计算且不失精度的最大整数</strong>，当达到这个数之后，++（自加）操作将不会产生变化了。所以&lt;=将永远满足条件。</p>
<p><strong>答案：</strong> <code>死循环</code></p>
<hr>
<h3 id="1-7、"><a href="#1-7、" class="headerlink" title="1.7、"></a>1.7、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ary = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>];</div><div class="line">ary[<span class="number">10</span>] = <span class="number">10</span>;</div><div class="line">ary.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x === <span class="literal">undefined</span>;&#125;);</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察了数组自动补齐元素和 <code>Array.filter()</code> 的用法。</p>
<p>数组自动补齐的元素为 <code>undefined</code>，示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [];</div><div class="line">arr[<span class="number">9</span>] = <span class="number">1</span>;</div><div class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [undefined * 9, 1]</span></div></pre></td></tr></table></figure>
<p><code>Array.filter()</code> 用于筛选满足条件的数组元素，接受回调函数 <code>function(currentValue, currentIndex, array){}</code>。但是一定要注意：<strong>它会忽略自动填充的undefined的元素</strong></p>
<p><strong>再次警告：是仅仅忽略自动填充的undefined元素，如果不是自动填充的undefined，是不会被忽略的。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="string">'str'</span>, <span class="literal">undefined</span>, <span class="literal">null</span>];</div><div class="line">arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;<span class="built_in">console</span>.log(item)&#125;); <span class="comment">//执行四次，没有忽略</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> arr = [];</div><div class="line">arr[<span class="number">9</span>] = <span class="number">1</span>;</div><div class="line">arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;<span class="built_in">console</span>.log(item)&#125;); <span class="comment">//执行1次，忽略了自动填充的9个元素</span></div></pre></td></tr></table></figure>
<p><strong>为什么有这种现象呢？</strong></p>
<p>因为filter在判断的时候，是通过key来进行的，对比一下一下两种方式的key：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="string">'str'</span>, <span class="literal">undefined</span>, <span class="literal">null</span>];</div><div class="line"><span class="built_in">Object</span>.keys(arr); <span class="comment">//一共有四个。</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> arr = [];</div><div class="line">arr[<span class="number">9</span>] = <span class="number">1</span>;</div><div class="line"><span class="built_in">Object</span>.keys(arr); <span class="comment">//一共只有一个。</span></div></pre></td></tr></table></figure>
<p><strong>引申：该判断逻辑也适合大多数数组方法，如reduce，map等等。</strong></p>
<p><strong>答案：</strong> <code>[]</code></p>
<hr>
<h3 id="1-8、"><a href="#1-8、" class="headerlink" title="1.8、"></a>1.8、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> two   = <span class="number">0.2</span></div><div class="line"><span class="keyword">var</span> one   = <span class="number">0.1</span></div><div class="line"><span class="keyword">var</span> eight = <span class="number">0.8</span></div><div class="line"><span class="keyword">var</span> six   = <span class="number">0.6</span></div><div class="line">[two - one == one, eight - six == two]</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 该题考察了JS中的浮点数运算有误差的知识点。这个到底规则是什么，I don’t know.</p>
<p><strong>答案：</strong> <code>[true, false]</code></p>
<hr>
<h3 id="1-9、"><a href="#1-9、" class="headerlink" title="1.9、"></a>1.9、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showCase</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span>(value) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'Case A'</span>);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'Case B'</span>);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="literal">undefined</span>:</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'undefined'</span>);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'Do not know!'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">showCase(<span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'A'</span>));</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察 <code>new String(&#39;A&#39;)</code> 产生的结果为 <code>object</code>，另外switch判断分支是使用 <code>===</code>，所以只能到default分支。</p>
<p><strong>答案：</strong> <code>&#39;Do not know!&#39;</code></p>
<hr>
<h3 id="1-10、"><a href="#1-10、" class="headerlink" title="1.10、"></a>1.10、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showCase2</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span>(value) &#123;</div><div class="line">  <span class="keyword">case</span> <span class="string">'A'</span>:</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Case A'</span>);</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="string">'B'</span>:</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Case B'</span>);</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="literal">undefined</span>:</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'undefined'</span>);</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Do not know!'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">showCase(<span class="built_in">String</span>(<span class="string">'A'</span>));</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题和1.9考察点类似，不过不适用new的 <code>String(&#39;A&#39;)</code>，返回的是字符串的 <code>&#39;A&#39;</code>。</p>
<p><strong>注意，以此类推，Number(1), 也返回数字 1 。</strong></p>
<p><strong>答案：</strong> <code>&#39;Case A&#39;</code></p>
<hr>
<h3 id="1-11、"><a href="#1-11、" class="headerlink" title="1.11、"></a>1.11、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isOdd</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEven</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSane</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> isEven(num) || isOdd(num);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> values = [<span class="number">7</span>, <span class="number">4</span>, <span class="string">'13'</span>, <span class="number">-9</span>, <span class="literal">Infinity</span>];</div><div class="line">values.map(isSane);</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题没有什么难点，只需要记得 <code>Infinity % 2 //NaN</code>就可以了。其他直接根据传入的值，运算即可。</p>
<p><strong>答案：</strong> <code>[true, true, true, false, false]</code></p>
<hr>
<h3 id="1-12、"><a href="#1-12、" class="headerlink" title="1.12、"></a>1.12、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">8</span>)</div><div class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">2</span>)</div><div class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题的考察点，在1.1就考察过了。</p>
<p><strong>答案：</strong> <code>3, NaN, 3</code></p>
<hr>
<h3 id="1-13、"><a href="#1-13、" class="headerlink" title="1.13、"></a>1.13、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Array</span>.isArray(<span class="built_in">Array</span>.prototype)</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察Array的原型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Array</span>.prototype <span class="comment">// []</span></div></pre></td></tr></table></figure>
<p><strong>答案：</strong> <code>true</code></p>
<hr>
<h3 id="1-14、"><a href="#1-14、" class="headerlink" title="1.14、"></a>1.14、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = [<span class="number">0</span>];</div><div class="line"><span class="keyword">if</span> ([<span class="number">0</span>]) &#123; </div><div class="line">  <span class="built_in">console</span>.log(a == <span class="literal">true</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123; </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"wut"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>解析：</strong>  死记硬背吧。<a href="https://dorey.github.io/JavaScript-Equality-Table/" target="_blank" rel="external">参考图</a></p>
<p><strong>答案：</strong> <code>false</code></p>
<hr>
<h3 id="1-15、"><a href="#1-15、" class="headerlink" title="1.15、"></a>1.15、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[]==[]</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题如上，也可以理解没有类型转换，引用不同。</p>
<p><strong>答案：</strong> <code>false</code></p>
<hr>
<h3 id="1-16、"><a href="#1-16、" class="headerlink" title="1.16、"></a>1.16、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">'5'</span> + <span class="number">3</span>  </div><div class="line"><span class="string">'5'</span> - <span class="number">3</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察类型转换，和 + 号的作用。当有字符串操作数时，+ 表示字符串连接。</p>
<p><strong>答案：</strong> <code>&#39;53&#39;, 2</code></p>
<hr>
<h3 id="1-17、"><a href="#1-17、" class="headerlink" title="1.17、"></a>1.17、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> + - + + + - + <span class="number">1</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题，个人根据结果归纳了一套规则：</p>
<ol>
<li>首先，忽略所有的+号， 得到： <code>1 - - 1</code></li>
<li>然后 - - 得正，成为 + 号，得到：<code>1 1</code></li>
<li>把最后的操作数相加，即为结果</li>
</ol>
<p>测试代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">5</span> + <span class="number">1</span> - <span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span> + <span class="number">1</span> <span class="comment">// 11</span></div><div class="line"><span class="number">5</span> - <span class="number">1</span> - <span class="number">1</span> - <span class="number">1</span> - <span class="number">1</span> - <span class="number">10</span> - <span class="number">5</span> - <span class="number">20</span> <span class="comment">// -34</span></div><div class="line"><span class="number">1</span> - - - - - - <span class="number">1</span> <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p><strong>答案：</strong> <code>2</code></p>
<hr>
<h3 id="1-18、"><a href="#1-18、" class="headerlink" title="1.18、"></a>1.18、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ary = <span class="built_in">Array</span>(<span class="number">3</span>);</div><div class="line">ary[<span class="number">0</span>]=<span class="number">2</span></div><div class="line">ary.map(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>) </span>&#123; <span class="keyword">return</span> <span class="string">'1'</span>; &#125;);</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题的考察点在1.7就考察过了。但是需要注意，map函数，并不改变结果数组的长度。</p>
<p><strong>答案：</strong> <code>[&#39;1&#39;, undefined*2]</code></p>
<hr>
<h3 id="1-19、"><a href="#1-19、" class="headerlink" title="1.19、"></a>1.19、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sidEffecting</span>(<span class="params">ary</span>) </span>&#123; </div><div class="line">  ary[<span class="number">0</span>] = ary[<span class="number">2</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a,b,c</span>) </span>&#123; </div><div class="line">  c = <span class="number">10</span></div><div class="line">  sidEffecting(<span class="built_in">arguments</span>);</div><div class="line">  <span class="keyword">return</span> a + b + c;</div><div class="line">&#125;</div><div class="line">bar(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 此题考察改变 <code>arguments</code>的属性值，会不会影响该对象。由于 <code>arguments</code> 是个对象，实际上是会影响的。<strong>注意：使用 <code>use strict</code> 可以避免此种情况。</strong></p>
<p><strong>答案：</strong> <code>21</code></p>
<p><strong>注意：当使用ES6语法，参数有rest parameters的时候，结果就不在一样了。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sidEffecting</span>(<span class="params">ary</span>) </span>&#123;</div><div class="line">  ary[<span class="number">0</span>] = ary[<span class="number">2</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a, b, c=<span class="number">3</span></span>) </span>&#123;</div><div class="line">  c = <span class="number">10</span>;</div><div class="line">  sidEffecting(<span class="built_in">arguments</span>);</div><div class="line">  <span class="keyword">return</span> a + b + c;</div><div class="line">&#125;</div><div class="line">bar(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>); <span class="comment">// 12</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="1-20、"><a href="#1-20、" class="headerlink" title="1.20、"></a>1.20、</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">111111111111111110000</span>,</div><div class="line">b = <span class="number">1111</span>;</div><div class="line">a + b;</div></pre></td></tr></table></figure>
<p><strong>解析：</strong> 当数值超过<strong>JS能正确计算且不失精度的最大整数</strong>时，会产生缺少精度问题。导致结果不太可预料。</p>
<p>基本上，超过16位数的整数都有这个问题了。很多时候，超过16位之后的数字会被补0。如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 一共20个2，超过16位之后的，将会为0。</span></div><div class="line"><span class="number">22222222222222222222</span> <span class="comment">// 22222222222222220000</span></div><div class="line"></div><div class="line"><span class="number">98765432109876543210</span> <span class="comment">// 98765432109876540000</span></div><div class="line"></div><div class="line"><span class="comment">//当从1开始时，超过17位才为0。</span></div><div class="line"><span class="number">12345678901234567890</span> <span class="comment">// 12345678901234567000</span></div></pre></td></tr></table></figure>
<p><strong>答案：</strong> <code>111111111111111110000</code></p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/JS札记/JavaScript的深拷贝的实现/">
        JavaScript的深拷贝的实现
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="JavaScript的数据类型"><a href="#JavaScript的数据类型" class="headerlink" title="JavaScript的数据类型"></a>JavaScript的数据类型</h2><h3 id="简单数据类型"><a href="#简单数据类型" class="headerlink" title="简单数据类型"></a>简单数据类型</h3><ol>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>function</li>
<li>null</li>
<li>undefined</li>
</ol>
<h3 id="复杂数据类型"><a href="#复杂数据类型" class="headerlink" title="复杂数据类型"></a>复杂数据类型</h3><ol>
<li>String</li>
<li>Number</li>
<li>Boolean</li>
<li>Function</li>
<li>Date</li>
<li>Array</li>
<li>RegExp </li>
<li>Object </li>
</ol>
<h2 id="各种类型的深复制方式："><a href="#各种类型的深复制方式：" class="headerlink" title="各种类型的深复制方式："></a>各种类型的深复制方式：</h2><p>先来看看简单类型的复制方式：</p>
<pre><code>//string
var s1 = &apos;abc&apos;;
var s2 = s1;
s2 = &apos;ccc&apos;;
console.log(s1);

//number
var n1 = 12.1;
var n2 = n1;
n2 = 7410;
console.log(n1);

//boolean
var b1 = true;
var b2 = b1;
b2 = false;
console.log(b1);

//null
var nu1 = null;
var nu2 = nu1;
nu2 = &apos;abc&apos;;
console.log(nu1);

//undefined
var u1 = undefined;
var u2 = u1;
u2 = &apos;abc&apos;;
console.log(u1);
</code></pre><p>从以上的代码可以看出，简单类型，只需要直接赋值就是深复制了。但是也有一个例外，那就是function。</p>
<p>接着来看看String、Number、Boolean、Date的深复制：</p>
<pre><code>//String
var s1 = new String(&apos;s1&apos;);
var s2 = new String(s1);
console.log(s2);

//Number
var n1 = new Number(&apos;1&apos;);
var n2 = new Number(n1);
console.log(n2);

//Boolean
var b1 = new Boolean(1);
var b2 = new Boolean(b1);
console.log(b2);

//Date
var d1 = new Date();
var d2 = new Date(d1);
console.log(d2);
</code></pre><p>除以上的做法之外，还需要对实例属性进行拷贝。那么剩下的Function、function、RegExp和Array还有Object又该怎么拷贝呢？这几个比较特殊，我们一个一个来：</p>
<p>对于Function和function的深拷贝，我们可以按照如下的方式来做：</p>
<pre><code>var f1 = new Function(&apos;a&apos;, &apos;console.log(&quot;f1&quot; + a);&apos;);
var f2 = function(b){console.log(&apos;f2&apos; + b);};

//通过toString获取源代码(有浏览器兼容问题)
var code = f1.toString();
//利用eval进行复制
var f1_copy = (function(functionCode){
  eval(&apos;var f = &apos; + functionCode);
  return f;
})(code);

f1_copy(&apos;abc&apos;);

//当然f2也可以用同样的方式来复制。
</code></pre><p>接着，我们来看下RegExp，可以同样同时eval来执行拷贝，也可以使用如下方式：</p>
<pre><code>var reg1 = /abc/g;
var reg2 = new RegExp(&apos;abc&apos;, &apos;gmi&apos;);

var reg1_copy = (function(reg){
  var pattern = reg.valueOf();
  var flags = (pattern.global ? &apos;g&apos; : &apos;&apos;) + 
    (pattern.ignorecase ? &apos;i&apos; : &apos;&apos;) + (pattern.multiline ? &apos;m&apos; : &apos;&apos;);
  return new RegExp(pattern.source, flags);
})(reg1);
</code></pre><p>最后，我们来说一说Array的复制，有的人可以说，直接用slice复制一份出来就是了，那我们来看看，是否真的达到效果的呢？</p>
<pre><code>var o = {name: &apos;Jay&apos;};
var arr1 = [o, &apos;22&apos;, 1];
var arr2 = arr1.slice(0);
arr2[0].name = &apos;Arr2&apos;;
console.log(arr1[0].name);
</code></pre><p>很简短的代码，直接就把slice抛弃了，slice只能保证Array是新的，并不意味着内部的元素是深拷贝的，那么如何做呢？就是遍历元素，对每个元素进行深拷贝了。代码如下：</p>
<pre><code>var o = {name: &apos;Jay&apos;};
var arr1 = [o, &apos;22&apos;, 1];

var arr2 = [];
for(var i = 0, len = arr1.length; i &lt; len; i++){
  //注意，deepClone还未实现
  arr2.push(deepClone(arr1[i]));
}
</code></pre><p>以上对针对不同的类型，特殊的代码，那么如何来拷贝实例属性呢？代码如下：</p>
<pre><code>var o = {p1: &apos;1&apos;, p2: 2, p3: function(){}};

var copy = {};
for(var p in o){
  //注意deepClone还未实现
  copy[p] = deepClone(o[p]);
}
</code></pre><p><strong>注意：针对复杂类型，还需要同时copy.constructor = source.constructor来保证构造函数一致。</strong></p>
<h2 id="最终的深复制代码"><a href="#最终的深复制代码" class="headerlink" title="最终的深复制代码"></a>最终的深复制代码</h2><p>通过以上的分析与代码示例，那么我们最终的代码又是怎样的呢？详细代码如下：</p>
<pre><code>//自调用函数，防御性编程
;
(function (window) {
  &apos;use strict&apos;;

  function getCustomType(obj) {
    var type = typeof obj,
      resultType = &apos;object&apos;;
    //简单类型
    if (type !== &apos;object&apos; || obj === null) {
      resultType = &apos;simple&apos;;
    } else if (obj instanceof String || obj instanceof Number || obj instanceof Boolean || obj instanceof Date) {
      resultType = &apos;complex&apos;;
    } else if (obj instanceof Function) {
      resultType = &apos;function&apos;;
    } else if (obj instanceof RegExp) {
      resultType = &apos;regexp&apos;;
    } else if (obj instanceof Array) {
      resultType = &apos;array&apos;;
    }
    return resultType;
  }

  function cloneProperties(dest, source) {
    dest.constructor = source.constructor;
    for (var p in source) {
      dest[p] = deepClone(source[p]);
    }
    return dest;
  }

  function cloneSimple(obj) {
    return obj;
  }

  function cloneComplex(obj) {
    var result = new obj.constructor(obj);
    return cloneProperties(result);
  }

  function cloneFunction(obj) {
    var funCopy = (function (f) {
      eval(&apos;var abcdefg_$$$$ = &apos; + obj.toString());
      return abcdefg_$$$$;
    })(obj);
    return cloneProperties(funCopy);
  }

  function cloneRegExp(obj) {
    var pattern = obj.valueOf();
    var flags = (pattern.global ? &apos;g&apos; : &apos;&apos;) +
      (pattern.ignorecase ? &apos;i&apos; : &apos;&apos;) + (pattern.multiline ? &apos;m&apos; : &apos;&apos;);
    var reg = new RegExp(pattern.source, flags);
    return cloneProperties(reg);
  }

  function cloneArray(obj) {
    var resultArr = [];
    for (var i = 0, len = obj.length; i &lt; len; i++) {
      resultArr.push(deepClone(obj[i]));
    }
    for (var p in obj) {
      if (typeof p === &apos;number&apos; &amp;&amp; p &lt; len) {
        continue;
      }
      resultArr[p] = deepClone(obj[p]);
    }
    return resultArr;
  }

  function cloneObject(obj) {
    var result = {};
    result.constructor = obj.constructor;
    for (var p in obj) {
      result[p] = deepClone(obj[p]);
    }
    return result;
  }

  function deepClone(obj) {
    var f = undefined;
    switch (getCustomType(obj)) {
    case &apos;simple&apos;:
      f = cloneSimple;
      break;
    case &apos;complex&apos;:
      f = cloneComplex;
      break;
    case &apos;function&apos;:
      f = cloneFunction;
      break;
    case &apos;regexp&apos;:
      f = cloneRegExp;
      break;
    case &apos;array&apos;:
      f = cloneArray;
      break;
    case &apos;object&apos;:
      f = cloneObject;
      break;
    }
    return f.call(undefined, obj);
  }

  //挂载到window对象上
  window.deepClone = deepClone;
})(window);
</code></pre>

    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Other/Go Go/">
        Go Go
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h1 id="题记"><a href="#题记" class="headerlink" title="题记"></a>题记</h1><blockquote>
<p>学习是进步的源泉</p>
</blockquote>
<p>在这个云计算、多核盛行的时代，学习一门与之相配合的语言也就无可厚非了。那么对多核与并行计算原生支持的Go就是我的选择了…</p>
<p>关于GO的好坏，我不会去深究，在每个人眼中，这都是主观的。喜欢就会觉得好，不喜欢好也是坏。当然，它本身的优势与劣势是值得我们关注了，这决定了它的适用性。</p>
<p>工欲善其事必先利其器，本人学习一门语言之前，喜欢先寻找趁手的兵器。搜索之，继而找到了LiteIDE。由于偏爱集成开发环境，那么Sublime也就不是我的首选了。</p>
<p>以上全是废话，下面开始搭建开发环境。</p>
<h1 id="1、准备工作"><a href="#1、准备工作" class="headerlink" title="1、准备工作"></a>1、准备工作</h1><ol>
<li>PC + Windows操作系统（我承认我只会玩Windows…）</li>
<li>你得下载Go语言：<a href="https://golang.org/" target="_blank" rel="external">https://golang.org/</a> BTW：我下载的文件名是：go1.4.1.windows-amd64.msi</li>
<li>LiteIDE：<a href="https://github.com/visualfc/liteide" target="_blank" rel="external">https://github.com/visualfc/liteide</a></li>
</ol>
<h1 id="2、搭建环境"><a href="#2、搭建环境" class="headerlink" title="2、搭建环境"></a>2、搭建环境</h1><p><span style="font-size:25px;font-weight:bold;">首</span>先，你需要安装Go语言。什么？你不会？双击msi(或者exe)，Next到手软就可以了。当然，最后应该是Finish。经过这个步骤，go就安装上了，什么环境变量啥的都给你配置好了。当然，安装成功不成功不是你说了算，那么打开cmd，输入一个go试试？如果报错，那么狠抱歉，请重试该步骤，或者检查环境变量。如果提示Go is a tool for managing Go source code ,那么恭喜你，安装已成功！</p>
<p><span style="font-size:25px;font-weight:bold;">接</span>下面，安装LiteIDE，这货的下载地址在<a href="http://sourceforge.net/projects/liteide/files" target="_blank" rel="external">http://sourceforge.net/projects/liteide/files</a>，如果你爱折腾，那么直接下载源码编译也是OK的，请参考<a href="https://github.com/visualfc/liteide/blob/master/liteidex/deploy/welcome/en/install.md" target="_blank" rel="external">https://github.com/visualfc/liteide/blob/master/liteidex/deploy/welcome/en/install.md</a>。此处熊出没！liteide下载下来可不是exe或者msi文件哦。我下载的文件名是：liteidex27-1.windows.7z。既然这样，那么解压缩，找个地儿一扔就搞定，是不是更简单？</p>
<h1 id="3、永远的经典：Hello-World"><a href="#3、永远的经典：Hello-World" class="headerlink" title="3、永远的经典：Hello World"></a>3、永远的经典：Hello World</h1><p>既然到了这里，想必以上两个小玩意已经安装好了。那么就应该开始写代码。据说程序员爱代码不爱妹子，这是真的么？</p>
<p>找到liteIDE的安装目录，进行/bin目录，双击“liteide.exe”（PS：一看到这个丑丑的太极图标，我就在想，这货应该是一个国人开发的吧，呵呵，果真是！）。和一般IDE无异，File-&gt;New-&gt;Go1 Command Project(Not Use GOPATH)，当然其他也是可以选的，惊喜在等着你。输入必要的信息，那么一个项目就创建好了。</p>
<p>打开main.go文件，输入代码（这段代码我是借鉴的，肯定不是copy的）：</p>
<pre><code>// demo1 project main.go
package main

import (
    &quot;fmt&quot;
)

func main() {
    fmt.Println(&quot;Hello World!&quot;)
}
</code></pre><p>然后点击工具栏上的FR(File Run),这坑爹的按钮，简直反人类。。我点了N次Go按钮之后，才发现这货才是运行。。在右下方区域就能看到输出了。。Hello World~</p>
<p><strong>后记：</strong> 至此，一个简单的Go开发环境已经搭建好了。</p>
<h2 id="或许你还有疑问"><a href="#或许你还有疑问" class="headerlink" title="或许你还有疑问"></a>或许你还有疑问</h2><ol>
<li>如果生成可执行文件呢？ <strong>可以利用LiteIDE的Build按钮，或者是控制台命令 <code>go build</code></strong></li>
<li>如果我是64位系统，如何生成32位可执行程序呢？ <strong>我也不知道，只能给你关键字“交叉编译”</strong></li>
<li>更多，就留给你慢慢发掘吧。Over！</li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Other/NPM使用详解（上）/">
        NPM使用详解（上）
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="1、NPM是什么？"><a href="#1、NPM是什么？" class="headerlink" title="1、NPM是什么？"></a>1、NPM是什么？</h2><p>NPM是JavaScript的包管理工具，在安装NodeJS（什么？你不知道node？来，我们合计合计：<a href="https://nodejs.org/" target="_blank" rel="external">https://nodejs.org/</a>）的时候,会自动安装上npm。</p>
<p>要查看安装的npm版本，只需要打开cmd控制台，输入<code>npm -v</code></p>
<p>NPM使得JavaScript开发者分享和重用代码非常容易，同时也让你能否非常方便的更新你分享的代码。</p>
<p>NPM能够自己升级自己，使用命令如下： <code>npm install npm -g</code></p>
<h2 id="2、NPM的使用"><a href="#2、NPM的使用" class="headerlink" title="2、NPM的使用"></a>2、NPM的使用</h2><p>以下代码示例中：&lt;&gt;表示必选参数，[]表示可选参数</p>
<h3 id="最常用命令"><a href="#最常用命令" class="headerlink" title="#最常用命令"></a>#最常用命令</h3><h4 id="2-1、-init：用于初始化项目"><a href="#2-1、-init：用于初始化项目" class="headerlink" title="2.1、 init：用于初始化项目"></a>2.1、 init：用于初始化项目</h4><pre><code>/*
 * npm init [-f|--force|-y|--yes]
 */

//在文件夹中打开cmd，然后输入npm init，打开项目初始化向导
npm init 

//如果文件夹名称满足npm的module name,
//那么使用如下方式，可以直接生成一个默认的package.json
//如果文件夹名称不满足要求，那么会出错
npm init -f
npm init --force
npm init --force=true 
npm init -y
npm init --yes
npm init --yes=true
</code></pre><h4 id="2-2、install：用于安装模块"><a href="#2-2、install：用于安装模块" class="headerlink" title="2.2、install：用于安装模块"></a>2.2、install：用于安装模块</h4><pre><code>/*
 * npm install (with no args in a package dir)
 * npm install &lt;tarball file&gt;
 * npm install &lt;tarball url&gt;
 * npm install &lt;folder&gt;
 * npm install [@&lt;scope&gt;/]&lt;name&gt; [--save|--save-dev|--save-optional] [--save-exact]
 * npm install [@&lt;scope&gt;/]&lt;name&gt;@&lt;tag&gt;
 * npm install [@&lt;scope&gt;/]&lt;name&gt;@&lt;version&gt;
 * npm install [@&lt;scope&gt;/]&lt;name&gt;@&lt;version range&gt;
 * npm i (with any of the previous argument usage)
 */

//直接使用npm install 或者是npm i，表示根据package.json，安装所有依赖
npm install
npm i

//如果加上--production参数，那么只会安装dependencies的模块，
//而不会安装devDependencies的内模块
npm install --production
npm i --production

//使用全局上下文来初始化
npm install -g
npm i -g

//安装指定模块
npm install &lt;packageName&gt;
npm install &lt;packageName&gt; -g //全局安装
npm install &lt;packageName&gt;@&lt;version&gt; //指定要安装的模块版本
npm install &lt;packageName&gt;@&lt;version_start-version_end&gt; //指定要安装的模块版本
npm install &lt;packageName&gt; --registry=&lt;url&gt; //指定零食的仓库地址
npm install &lt;packageName&gt; --msvs_version=&lt;vs_version&gt; //指定编译使用的VS版本
npm install &lt;packageName&gt; --save // 安装模块并修改package.json的dependencies
npm install &lt;packageName&gt; --save-dev //安装模块并修改package.json的devDependencies

npm install &lt;tarball url&gt; //从指定的压缩包地址安装，示例如下：
npm install https://github.com/indexzero/forever/tarball/v0.5.6

npm install &lt;tarball file&gt; //从指定的压缩包安装，如下(注意压缩包格式)：
npm install del-1.2.0.tar.gz //使用.tgz和.tar.gz格式

npm install @&lt;scope&gt;/&lt;packageName&gt; //安装私有包
</code></pre><h4 id="2-3、uninstall：用于卸载模块"><a href="#2-3、uninstall：用于卸载模块" class="headerlink" title="2.3、uninstall：用于卸载模块"></a>2.3、uninstall：用于卸载模块</h4><pre><code>/*
 * npm uninstall [@&lt;scope&gt;/]&lt;package&gt; [--save|--save-dev|--save-optional]
 */

//直接卸载模块，加上-g参数，表示卸载全局的模块
npm uninstall &lt;packageName&gt; 
npm uninstall &lt;packageName&gt; -g

//卸载时同时修改package.json文件
npm uninstall &lt;packageName&gt; --save-dev
npm uninstall &lt;packageName&gt; --save
</code></pre><h4 id="2-4、update：用于更新模块"><a href="#2-4、update：用于更新模块" class="headerlink" title="2.4、update：用于更新模块"></a>2.4、update：用于更新模块</h4><pre><code>/*
 * npm update [-g] [&lt;name&gt; [&lt;name&gt; ...]]
 */

//更新一个或多个模块，加上-g参数，表示更新全局的模块
npm update &lt;packageName&gt; [packageName2...]
npm update &lt;packageName&gt; [packageName2...] -g

//更新时同时修改package.json文件
npm update &lt;packageName&gt; [packageName2...] --save-dev
npm update &lt;packageName&gt; [packageName2...] --save
</code></pre><h4 id="2-5、config：用于设置npm参数"><a href="#2-5、config：用于设置npm参数" class="headerlink" title="2.5、config：用于设置npm参数"></a>2.5、config：用于设置npm参数</h4><pre><code>//设置指定参数
npm config set &lt;key&gt; &lt;value&gt; [--global]
npm set &lt;key&gt; &lt;value&gt; [--global] //可以省略config
//获取现有参数值
npm config get &lt;key&gt;
npm get &lt;key&gt; //可以省略config
//删除指定参数，此时参数值会变为默认值
npm config delete &lt;key&gt;
//查看npm信息；注意：此命令不是查看所有参数配置
npm config list
//编辑全量的npm配置文件（.npmrc）
npm config edit
//可以将config使用c代替，执行以上所有命令
npm c [set|get|delete|list]
</code></pre><h4 id="2-6、cache：管理包缓存"><a href="#2-6、cache：管理包缓存" class="headerlink" title="2.6、cache：管理包缓存"></a>2.6、cache：管理包缓存</h4><pre><code>//将指定的包加入npm缓存
npm cache add &lt;tarball file&gt;
npm cache add &lt;folder&gt;
npm cache add &lt;tarball url&gt;
npm cache add &lt;name&gt;@&lt;version&gt;
//查看现有的npm包缓存，如果加上path参数，则查看该路径下的文件
npm cache ls [&lt;path&gt;] 
eg: npm cache ls gulp
//清空缓存。如果加上path，则清理指定路径下的包缓存
npm cache clean [&lt;path&gt;]
eg: npm cache clean gulp
</code></pre>

    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/GoLang学习笔记/01_开始GO/">
        01_开始GO
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h1 id="0、前言"><a href="#0、前言" class="headerlink" title="0、前言"></a>0、前言</h1><p>Go是啥？看<a href="https://golang.org" target="_blank" rel="external">这里</a>。简而言之，就是一门系统级的编程语言。</p>
<p>为嘛要学/用它？</p>
<ol>
<li>追个潮流，体验下不同风格的语言设计思想</li>
<li>跨平台部署，单文件部署</li>
<li>强大的功能（系统级）</li>
<li>对分布式的友好支持</li>
</ol>
<p>上手有啥问题？</p>
<ol>
<li>不友好的语法（也有一部分人觉得语法很优雅，对我来说，这语法可算不上友好）</li>
<li>和大多数语言不一样的设计风格（需要慢慢消化）</li>
<li>没有趁手的IDE（LiteIDE, Sublime Text, VsCode这几个可以自己优化得比较好用）</li>
</ol>
<h1 id="1、开干"><a href="#1、开干" class="headerlink" title="1、开干"></a>1、开干</h1><p>虽然比较恶心语法，但是其他优秀的点，也是比较吸引人的，再加上项目需要，那就开干。</p>
<p>因为有其他前/后端语言的经验，就跳过常规学习过程，直接上手做项目。</p>
<p><strong>注意：虽然跳过了不少步骤，但是语法还是要学习的，书还是要看的，先来一本《Go语言编程》</strong></p>
<h3 id="1-1、创建项目基架"><a href="#1-1、创建项目基架" class="headerlink" title="1.1、创建项目基架"></a>1.1、创建项目基架</h3><p><code>Go</code> 是一个有很多规范的语法，就连创建目录结构也有一定的约束。之前的版本略过，我本地安装的是 <code>go1.7.3</code> 版本，通过 <code>go version</code> 可查看。</p>
<p>接下来就为该版本，创建一个相对较为标准的项目结构。</p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Other/开发者讨厌你API的十个原因/">
        开发者讨厌你API的十个原因
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <p>##1、文档的吸引力太弱##</p>
<p>###解决之道###</p>
<ol>
<li>采用大图片：<a href="https://www.twilio.com/docs" target="_blank" rel="external">示例站点</a></li>
<li>文档清晰度：<a href="https://stripe.com/docs/api" target="_blank" rel="external">示例站点</a></li>
<li>文档易于查找：<a href="https://stripe.com/docs/" target="_blank" rel="external">示例站点</a></li>
<li>生动的文档：<ol>
<li><a href="https://github.com/wordnik/swagger-core" target="_blank" rel="external">Swagger</a></li>
<li><a href="https://github.com/mashery/iodocs" target="_blank" rel="external">I/O Docs</a></li>
<li>采用RAML(RESTful API 模型语言) <a href="raml.org">RAML官网</a></li>
</ol>
</li>
</ol>
<p>##2、您的沟通技能需要工作（你不能保证开发者始终被通知到）</p>
<p>###解决之道###</p>
<ol>
<li>使用变更日志：<a href="http://developer.github.com/changes/" target="_blank" rel="external">http://developer.github.com/changes/</a></li>
<li>使用路线图：<a href="https://developers.facebook.com/roadmap/" target="_blank" rel="external">https://developers.facebook.com/roadmap/</a></li>
<li>采用发布日志：<a href="http://techblog.constantcontact.com/api/release-updates" target="_blank" rel="external">http://techblog.constantcontact.com/api/release-updates</a></li>
<li>使用博客（Blog）：<a href="http://aws.typepad.com/" target="_blank" rel="external">http://aws.typepad.com/</a></li>
<li>使用论坛（Forum）：<a href="http://stackoverflow.com/questions/tagged/soundcloud" target="_blank" rel="external">http://stackoverflow.com/questions/tagged/soundcloud</a></li>
<li>邮件通知</li>
</ol>
<p>##3、你不能使API使用简单##</p>
<p>###解决之道###</p>
<ol>
<li>说明你是做什么的：<a href="https://www.twilio.com/voice/api" target="_blank" rel="external">https://www.twilio.com/voice/api</a></li>
<li>支持快速注册：<a href="https://manage.stripe.com/register" target="_blank" rel="external">https://manage.stripe.com/register</a></li>
<li>使用step1-step2-step3说明使用步骤：<a href="http://developer.constantcontact.com/get-started.html" target="_blank" rel="external">示例站点</a></li>
<li>提供快速入门手册：<a href="https://www.twilio.com/docs/quickstart" target="_blank" rel="external">https://www.twilio.com/docs/quickstart</a></li>
<li>提供免费版或者免费试用版：<a href="https://parse.com/plans" target="_blank" rel="external">https://parse.com/plans</a></li>
<li>提供丰富的SDK（支持多种开发语言）</li>
<li>使用GitHub ：<a href="https://github.com/OneNoteDev" target="_blank" rel="external">https://github.com/OneNoteDev</a></li>
</ol>
<p>##4、没有提供法律申明##</p>
<p>###解决之道###</p>
<ol>
<li>要明确权利与义务：<a href="http://500px.com/terms" target="_blank" rel="external">http://500px.com/terms</a></li>
<li>编写使用协议：<a href="https://www.etsy.com/developers/terms-of-use" target="_blank" rel="external">https://www.etsy.com/developers/terms-of-use</a></li>
<li>申明越短越好：<a href="http://googledevelopers.blogspot.com" target="_blank" rel="external">http://googledevelopers.blogspot.com</a></li>
<li>申明要想长远：<a href="https://developers.google.com/youtube/terms" target="_blank" rel="external">https://developers.google.com/youtube/terms</a></li>
<li>分享你的财富：<a href="http://slideshare.net/jmusser" target="_blank" rel="external">http://slideshare.net/jmusser</a></li>
</ol>
<p>##5、你的API不可靠（慢、错误、不可靠）##<br>API会被停运(Outage)、Bug、速率(Rate limit)、变更(包含有计划的变更和未被文档跟踪的变更)、ToS违规、Provider biz change、网络等原因影响。</p>
<p>不要让API返回未知的错误信息，让用户迷惑。</p>
<p>###解决之道###</p>
<ol>
<li>使用状态页：<a href="http://status.aws.amazon.com/" target="_blank" rel="external">http://status.aws.amazon.com/</a></li>
<li>监控API：<a href="http://www.apiscience.com" target="_blank" rel="external">http://www.apiscience.com</a></li>
<li>不要隐藏API的变化，如停运：<a href="http://blog.akismet.com" target="_blank" rel="external">http://blog.akismet.com</a></li>
</ol>
<p>##6、没有提供能帮助我调用成功的工具##</p>
<p>###解决之道###</p>
<ol>
<li>提供开发者仪表板：<a href="https://manage.stripe.com/test/dashboard" target="_blank" rel="external">https://manage.stripe.com/test/dashboard</a></li>
<li>提供 Debug/Log 等日志：<a href="www.twilio.com/user/account/developer-tools/app-monitor">示例站点</a></li>
<li>提供用于测试的沙盒环境：<a href="https://www.twilio.com/user/account" target="_blank" rel="external">https://www.twilio.com/user/account</a></li>
<li>提供Playground：<a href="https://developers.google.com/oauthplayground" target="_blank" rel="external">https://developers.google.com/oauthplayground</a></li>
<li>提供测试控制台：<a href="https://apigee.com/providers" target="_blank" rel="external">https://apigee.com/providers</a></li>
</ol>
<p>##7、只管销售，但不提供售后服务##</p>
<p>###解决之道###</p>
<ol>
<li>Evangelists：<a href="http://sendgrid.com/developers" target="_blank" rel="external">http://sendgrid.com/developers</a></li>
<li>Events：<a href="https://www.twilio.com/conference" target="_blank" rel="external">https://www.twilio.com/conference</a></li>
<li>Hackathons</li>
<li>PS：不知道如何翻译，so总结一点，就是提供售后支持。</li>
</ol>
<p>##8、API太复杂了（你使用你自己定制的授权、协议、格式）##</p>
<p>###解决之道###</p>
<ol>
<li>使用REST（当前最流行的风格）</li>
<li>使用JSON格式（XML也还好）</li>
<li>保持务实：<a href="http://apigee.com/about/content/web-api-design" target="_blank" rel="external">http://apigee.com/about/content/web-api-design</a></li>
</ol>
<p>##9、你的TTFHW（Time to <em>(your)</em> First Hello World）太长##</p>
<p>###解决之道###</p>
<ol>
<li>极好的开发者体验：<a href="http://developerexperience.org" target="_blank" rel="external">http://developerexperience.org</a></li>
<li>在所有问题修正前，先说“Sorry”</li>
</ol>
<p>##10、你还没有从最好的学习到的##</p>
<ol>
<li>学习榜样的做法（Twilio,Stripe,GitHub.SendGrid）</li>
<li>保持进步</li>
<li>记住一句话：API是旅程，不是目的地</li>
</ol>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Other/浅析12306前端优化点/">
        浅析12306前端优化点
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="关于12306"><a href="#关于12306" class="headerlink" title="关于12306"></a>关于12306</h2><p>中国铁路客户服务中心(<a href="https://kyfw.12306.cn/" target="_blank" rel="external">12306.cn</a>)，相信大家都不陌生。作为一个超大型的类电商网站，具体业务不予置评，但从前端设计来看，却有诸多的不足。</p>
<h2 id="12306订票首页分析"><a href="#12306订票首页分析" class="headerlink" title="12306订票首页分析"></a>12306订票首页分析</h2><p>12306首页(<a href="https://kyfw.12306.cn/otn/" target="_blank" rel="external">https://kyfw.12306.cn/otn/</a>)请求达到32个，累计文件大小近800k。</p>
<p>其中有一半是图片资源，大小达到444kb。</p>
<p><img src="http://images.cnblogs.com/cnblogs_com/humin/771181/o_1.jpg" alt="12306首页图片资源"></p>
<p>另外有6个css文件请求，特别的是有2次css请求完全指向同一个css文件。</p>
<p><img src="http://images.cnblogs.com/cnblogs_com/humin/771181/o_2.jpg" alt="12306首页CSS请求"></p>
<p>还有8个js请求</p>
<p><img src="http://images.cnblogs.com/cnblogs_com/humin/771181/o_3.jpg" alt="12306首页JS请求"></p>
<p>这就是首页初次打开所需要的内容，当然还有两个html页面，就不计算了。可以看到，打开整个页面文件大小达到800k，和taobao，jd之类的比起来，这个大小是很小的，但是为什么给用户的体验就是卡顿、加载中、加载中呢？</p>
<p>接下来，就从前端的角度来看下，有没有可以优化的地方呢？</p>
<h2 id="优化1、使用浏览器缓存"><a href="#优化1、使用浏览器缓存" class="headerlink" title="优化1、使用浏览器缓存"></a>优化1、使用浏览器缓存</h2><p>在页面加载中，12306请求了如此多的资源，很多资源看起来，根本就是不太容易变化的，应在HTTP标头中设置有效期，尽可能多的使用浏览器缓存。</p>
<h2 id="优化2、图片优化"><a href="#优化2、图片优化" class="headerlink" title="优化2、图片优化"></a>优化2、图片优化</h2><p>数据传输时间，在访问网站的过程中，是一个耗时比较大的过程，其中又以图片传输为最，如果网站上有较多的图片，那么就要想办法减少体积，延迟加载等等。在12306的页面上，logo（<a href="https://kyfw.12306.cn/otn/resources/images/logo.png" target="_blank" rel="external">https://kyfw.12306.cn/otn/resources/images/logo.png</a> ），icon（<a href="https://kyfw.12306.cn/otn/resources/images/logo.png" target="_blank" rel="external">https://kyfw.12306.cn/otn/resources/images/logo.png</a> ）等等图片都是可以优化的。</p>
<h2 id="优化3、图片组合为CSS贴图"><a href="#优化3、图片组合为CSS贴图" class="headerlink" title="优化3、图片组合为CSS贴图"></a>优化3、图片组合为CSS贴图</h2><p>浏览器一般都有并发连接数限制，也就是同时请求的资源数量是有效的，前端优化点之一就是减少请求数量，那么12306中的诸多小图片完全可以合并到一个大图之中，采用贴图定位的方式，降低请求数量。</p>
<h2 id="优化4、暂缓JS解析"><a href="#优化4、暂缓JS解析" class="headerlink" title="优化4、暂缓JS解析"></a>优化4、暂缓JS解析</h2><p>由于JS是阻塞加载的，一般来说，把js放在head中会影响页面的渲染速度，很多时候，我们都推荐把js放在body结束标记之前。但12306偏偏没有这么做，把大把的js放在head中。</p>
<h2 id="优化5、使用css而不是图片控制背景"><a href="#优化5、使用css而不是图片控制背景" class="headerlink" title="优化5、使用css而不是图片控制背景"></a>优化5、使用css而不是图片控制背景</h2><p>这个似乎是大家都知道的常识，就算为了兼容老版本的浏览器，也可以考虑做优雅降级。但12306偏偏就大量使用背景图。</p>
<h2 id="优化6、CSS合并"><a href="#优化6、CSS合并" class="headerlink" title="优化6、CSS合并"></a>优化6、CSS合并</h2><p>同样为了减少请求数，应该尽量将CSS压缩合并。分析12306的站点css，发现部分合并了，部分没有，而且有些css连压缩都没做，很难想象是怎么打算的。另外，外部控件的样式（不会变的样式）完全可以打包放到cdn上。</p>
<h2 id="优化7、JS合并"><a href="#优化7、JS合并" class="headerlink" title="优化7、JS合并"></a>优化7、JS合并</h2><p>JS同上，该打包就打包，不要搞一堆js出来，加载还慢。。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>抢票还是每年的一个老大难的问题。12306，你可以推说你的核心逻辑复杂，这个我接受。但你完全可以把前端的一些基本优化点做到吧。就算我买不到票，至少我抢票的时候心情不至于太差。。</p>
<p>以上，抢票之余作为一个伪前端的发泄。</p>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/blog/2017/02/21/Other/程序集强签名/">
        程序集强签名
      </a>
    </h2>
    
    <time>
      Feb 21, 2017
    </time>
		
  </section>
  <section class="article typo">
	  <h2 id="1、特点"><a href="#1、特点" class="headerlink" title="1、特点"></a>1、特点</h2><p>1.1、强签名的程序集可以注册到GAC（全局应用程序集缓存）,不同的应用程序可以共享同一个dll。</p>
<p>1.2、强签名的库（应用程序）只能引用强签名的库。非强签名的库（应用程序）没有限制，既可以引用强签名的库，也可以引用非强签名的库。（实际测试，强签名的应用只引用非强签名的程序集但不使用是可以的，只要使用了引入库的东西，那就会报：引用的程序集没有强签名）</p>
<p>1.3、强签名无法保护源代码，但能防止dll被第三方篡改。</p>
<p>1.4、能防止dll冲突。</p>
<h2 id="2、方法"><a href="#2、方法" class="headerlink" title="2、方法"></a>2、方法</h2><p><strong>–如果有源代码</strong></p>
<p>项目 -&gt; 右键 -&gt; 属性 -&gt; 签名：</p>
<p><img src="http://7ximjo.com1.z0.glb.clouddn.com/1.png" alt="Signing panel"></p>
<p>勾选 Sign the assembly（签名程序集）</p>
<p><img src="http://7ximjo.com1.z0.glb.clouddn.com/2.png" alt="Signing panel"></p>
<p>填写 key file name，如果勾选了密码保护key file，那么就输入密码。点击OK就创建好了签名文件。</p>
<p>将属性保存，然后再次编译，程序集就是强签名程序集了。</p>
<p><strong>–如果没有源代码</strong></p>
<p>1、首先创建一个签名key file，可以通过有源代码的方式，创建key file备用；也可以通过VS 控制台执行<code>sn.exe -k D:\sn.snk</code> 生成key。</p>
<p>2、将无源代码的dll，通过 <code>ILDASM.exe MagicOrm.dll /OUTPUT=D:\MagicOrm.il</code>进行反汇编</p>
<p><strong>注意：如果dll有资源文件，同时会生成MagicOrm.res文件</strong></p>
<p>3、带上签名文件重新汇编为dll，如果有资源文件生成，也需要带上，命令：<code>ILASM.exe MagicOrm.il /dll /output=D:\MagicOrm.dll /Key=sn.snk /Resource=MagicOrm.res</code></p>
<h2 id="Over"><a href="#Over" class="headerlink" title="Over"></a>Over</h2>

    
    
    
  </section>
</article>
    </div>
  
</section>


  <nav id="page-nav">
    
    <a class="prev" rel="prev" href="/blog/archives/2017/page/4/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/blog/archives/2017/page/6/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>
  


      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='https://avatars1.githubusercontent.com/u/4043284?v=3&amp;s=460' />

<div class='header'>Jay.M.Hu</div>
<div class='content'>
<div></div>
</div>
</section>

  <section class='m_widget friendly-links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://humin.cnblogs.com/">
            <div class='name'>幻天芒 - 博客园</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
</div>
</section>

  


      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/hstarorg" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/blog/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/blog/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/blog/js/search.js"></script>
<script src="/blog/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
